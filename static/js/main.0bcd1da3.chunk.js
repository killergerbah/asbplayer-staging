(this["webpackJsonp@project/client"]=this["webpackJsonp@project/client"]||[]).push([[0],{218:function(e,t){},220:function(e,t){},235:function(e,t){},237:function(e,t){},263:function(e,t,n){"use strict";n.r(t);n(204);var a=n(142),r=n(10),i=n(23),o=n(27),c=n(8),s=n(3),u=n(18),l=n(4),d=n.n(l),b=n(0),f=n.n(b),h=n(17),v=n(91),p=n(316),g=n(184),j=n(348);function m(e){var t=Object(b.useState)([0,0]),n=Object(s.a)(t,2),a=n[0],r=n[1];return Object(b.useLayoutEffect)((function(){function t(){e&&r([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[e]),a}var O,k=n(93),x=n(13),y=n(12),w=function(){function e(){Object(x.a)(this,e)}return Object(y.a)(e,null,[{key:"detectCopy",value:function(e){return e.ctrlKey&&e.shiftKey&&"a"===e.key.toLowerCase()}},{key:"detectDecreaseOffset",value:function(e){return e.ctrlKey&&e.shiftKey&&"ArrowRight"===e.key}},{key:"detectAnkiExport",value:function(e){return e.ctrlKey&&e.shiftKey&&"q"===e.key.toLowerCase()}},{key:"detectUpdateLastCard",value:function(e){return e.ctrlKey&&e.shiftKey&&"y"===e.key.toLowerCase()}},{key:"detectIncreaseOffset",value:function(e){return e.ctrlKey&&e.shiftKey&&"ArrowLeft"===e.key}},{key:"detectDecreaseOffsetToNextSubtitle",value:function(t){return!e.detectDecreaseOffset(t)&&(t.ctrlKey||t.shiftKey)&&"ArrowRight"===t.key}},{key:"detectIncreaseOffsetToPreviousSubtitle",value:function(t){return!e.detectIncreaseOffset(t)&&(t.ctrlKey||t.shiftKey)&&"ArrowLeft"===t.key}},{key:"detectPreviousSubtitle",value:function(t){return!e.detectIncreaseOffset(t)&&!e.detectIncreaseOffsetToPreviousSubtitle(t)&&"ArrowLeft"===t.key}},{key:"detectNextSubtitle",value:function(t){return!e.detectDecreaseOffset(t)&&!e.detectDecreaseOffsetToNextSubtitle(t)&&"ArrowRight"===t.key}},{key:"detectCurrentSubtitle",value:function(e){return"ArrowDown"===e.key}},{key:"detectSeekBackward",value:function(t){return!e.detectCopy(t)&&"a"===t.key.toLowerCase()}},{key:"detectSeekForward",value:function(e){return"d"===e.key.toLowerCase()}},{key:"detectPlay",value:function(e){return" "===e.key}},{key:"detectAutoPause",value:function(e){return e.shiftKey&&"p"===e.key.toLowerCase()}}]),e}();!function(e){e[e.REJECTED=0]="REJECTED",e[e.CANCELED=1]="CANCELED",e[e.ADVANCED=2]="ADVANCED",e[e.COMPLETE=3]="COMPLETE"}(O||(O={}));var S=function(){function e(t){var n=t.up,a=t.holding,r=t.canceledBy,i=t.map;Object(x.a)(this,e),this.up=void 0,this.holding=void 0,this.canceledBy=void 0,this.map=void 0,this.currentlyHolding=void 0,this.canceled=void 0,this.up=n||[],this.holding=a||[],this.canceledBy=r||[],this.map=i||function(e){return!0},this.currentlyHolding={},this.canceled=!1}return Object(y.a)(e,[{key:"reset",value:function(){this.currentlyHolding={},this.canceled=!1}},{key:"accept",value:function(e){var t=O.REJECTED,n=null;if("keydown"===e.type){var a=e.key.toLowerCase();this.holding.includes(a)&&(this.currentlyHolding[a]=!0,this.canceled=!1,t=O.ADVANCED),this.canceledBy.includes(a)&&(this.canceled=!0,t=O.CANCELED),this.up.includes(a)&&(this.canceled=!1,t=O.ADVANCED)}if("keyup"===e.type){var r=e.key.toLowerCase();delete this.currentlyHolding[r],this.up.includes(r)&&this._holdingAll()&&!this.canceled&&(n=this.map(e),t=O.COMPLETE)}return{result:t,extra:n}}},{key:"_holdingAll",value:function(){var e,t=Object(r.a)(this.holding);try{for(t.s();!(e=t.n()).done;){if(!(e.value in this.currentlyHolding))return!1}}catch(n){t.e(n)}finally{t.f()}return!0}}]),e}(),C=function(){function e(){Object(x.a)(this,e)}return Object(y.a)(e,null,[{key:"toggleSubtitles",value:function(){return new S({up:["s"],canceledBy:["1","2","3","4","5","6","7","8","9"]})}},{key:"toggleSubtitleTrack",value:function(){return new S({holding:["s"],up:["1","2","3","4","5","6","7","8","9"],map:function(e){return Number(e.key)-1}})}},{key:"toggleSubtitleTrackInList",value:function(){return new S({holding:["w"],up:["1","2","3","4","5","6","7","8","9"],map:function(e){return Number(e.key)-1}})}},{key:"togglePlay",value:function(){return new S({up:[" "],canceledBy:["a","d"]})}}]),e}(),T=function(){function e(){Object(x.a)(this,e)}return Object(y.a)(e,null,[{key:"bindCopy",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e._bindDown((function(e){if(!n()&&w.detectCopy(e)){var r=a();r&&t(e,r)}}),r)}},{key:"bindAnkiExport",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e._bindDown((function(e){n()||w.detectAnkiExport(e)&&t(e)}),a)}},{key:"bindUpdateLastCard",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e._bindDown((function(e){n()||w.detectUpdateLastCard(e)&&t(e)}),a)}},{key:"bindSeekToSubtitle",value:function(t,n,a,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return e._bindDown((function(i){if(!n()){var o=r();if(o&&0!==o.length){var c;if(w.detectPreviousSubtitle(i))c=!1;else{if(!w.detectNextSubtitle(i))return;c=!0}var s=e._adjacentSubtitle(c,a(),o);null!==s&&s.start>=0&&s.end>=0&&t(i,s)}}}),i)}},{key:"bindSeekToBeginningOfCurrentSubtitle",value:function(t,n,a,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return e._bindDown((function(i){if(!n()&&w.detectCurrentSubtitle(i)){var o=r();if(o&&0!==o.length){var c=e._currentSubtitle(a(),o);void 0!==c&&c.start>=0&&c.end>=0&&t(i,c)}}}),i)}},{key:"_currentSubtitle",value:function(e,t){for(var n,a=e,r=Number.MAX_SAFE_INTEGER,i=0;i<t.length;++i){var o=t[i];if(!(o.start<0||o.end<0)){var c=a-o.start;a>=o.start&&a<o.end&&c<r&&(n=o,r=c)}}return n}},{key:"bindSeekBackwardOrForward",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e._bindDown((function(e){if(!n()){var a;if(w.detectSeekBackward(e))a=!1;else{if(!w.detectSeekForward(e))return;a=!0}t(e,a)}}),a)}},{key:"bindOffsetToSubtitle",value:function(t,n,a,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return e._bindDown((function(i){if(!n()){var o=r();if(o&&0!==o.length){var c;if(w.detectIncreaseOffsetToPreviousSubtitle(i))c=!1;else{if(!w.detectDecreaseOffsetToNextSubtitle(i))return;c=!0}var s=a(),u=e._adjacentSubtitle(c,s,o);if(null!==u){var l=u.originalStart;t(i,s-l)}}}}),i)}},{key:"_adjacentSubtitle",value:function(e,t,n){for(var a=t,r=-1,i=Number.MAX_SAFE_INTEGER,o=0;o<n.length;++o){var c=n[o],s=e?c.start-a:a-c.start;i<=s||(e&&a<c.start?(i=s,r=o):!e&&a>c.start&&(i=s,r=a<c.end?Math.max(0,o-1):o))}return-1!==r?n[r]:null}},{key:"bindAdjustOffset",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e._bindDown((function(e){if(!n()){var r=a();if(r&&0!==r.length){var i;if(w.detectDecreaseOffset(e))i=!1;else{if(!w.detectIncreaseOffset(e))return;i=!0}var o=r[0].start-r[0].originalStart;t(e,o+(i?100:-100))}}}),r)}},{key:"bindToggleSubtitles",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=C.toggleSubtitles(),o=function(e){if(a())i.reset();else{var r=i.accept(e);r.result===O.ADVANCED?n(e):r.result===O.COMPLETE&&t(e)}},c=e._bindDown(o,r),s=e._bindUp(o,r);return function(){c(),s()}}},{key:"bindToggleSubtitleTrackInVideo",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=C.toggleSubtitleTrack(),o=function(e){if(a())i.reset();else{var r=i.accept(e);r.result===O.ADVANCED?n(e):r.result===O.COMPLETE&&t(e,r.extra)}},c=e._bindDown(o,r),s=e._bindUp(o,r);return function(){c(),s()}}},{key:"bindToggleSubtitleTrackInList",value:function(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=C.toggleSubtitleTrackInList(),o=function(e){if(a())i.reset();else{var r=i.accept(e);r.result===O.ADVANCED?n(e):r.result===O.COMPLETE&&t(e,r.extra)}},c=e._bindDown(o,r),s=e._bindUp(o,r);return function(){c(),s()}}},{key:"bindPlay",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e._bindDown((function(e){n()||w.detectPlay(e)&&t(e)}),a)}},{key:"bindAutoPause",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e._bindDown((function(e){n()||w.detectAutoPause(e)&&t(e)}),a)}},{key:"_bindDown",value:function(e,t){return window.addEventListener("keydown",e,t),function(){return window.removeEventListener("keydown",e,t)}}},{key:"_bindUp",value:function(e,t){return window.addEventListener("keyup",e,t),function(){return window.removeEventListener("keyup",e,t)}}}]),e}(),F=function(){function e(){Object(x.a)(this,e)}return Object(y.a)(e,null,[{key:"encode",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(a,r){var i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(i=new FileReader).onload=function(){var e=Object(c.a)(d.a.mark((function e(t){var i,o,c,s,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,i=new AudioContext,null!==t.target){e.next=5;break}return r(new Error("Could not obtain buffer to encode")),e.abrupt("return");case 5:return e.next=7,i.decodeAudioData(t.target.result);case 7:for(o=e.sent,c=[],s=0;s<o.numberOfChannels;++s)c.push(o.getChannelData(s));(u=n()).postMessage({command:"encode",audioBuffer:{channels:c,numberOfChannels:o.numberOfChannels,length:o.length,sampleRate:o.sampleRate}}),u.onmessage=function(e){a(new Blob(e.data.buffer,{type:"audio/mp3"})),u.terminate()},u.onerror=function(e){var t,n=null!==(t=null===e||void 0===e?void 0:e.error)&&void 0!==t?t:new Error("MP3 encoding failed: "+(null===e||void 0===e?void 0:e.message));r(n),u.terminate()},e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),r(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),i.readAsArrayBuffer(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function E(){return new Worker(n.p+"static/js/mp3-encoder.bdda0d32.worker.js")}var P,I,M,R={"audio/ogg;codecs=opus":"ogg","audio/webm;codecs=opus":"webm"},D=Object(s.a)(Object.keys(R).filter(MediaRecorder.isTypeSupported).map((function(e){return[e,R[e]]}))[0],2),A=D[0],_=D[1],B=function(){return new E},N=function(){function e(t,n,a,r,i){Object(x.a)(this,e),this._name=void 0,this.start=void 0,this.end=void 0,this._base64=void 0,this._extension=void 0,this.cachedBlob=void 0,this._name=t+"_"+Math.floor(n)+"_"+Math.floor(a),this.start=n,this.end=a,this._base64=r,this._extension=i}return Object(y.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"base64",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t,n,a=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return t=e.sent,(n=new Audio).src=URL.createObjectURL(t),n.preload="none",n.load(),e.next=9,n.play();case 9:return e.abrupt("return",new Promise((function(e,t){setTimeout((function(){n.pause();var t=n.src;n.src="",URL.revokeObjectURL(t),e(void 0)}),a.end-a.start+1e3)})));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch("data:audio/"+this.extension+";base64,"+this._base64);case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(e,t){return this}},{key:"isSliceable",value:function(e,t){return!1}}]),e}(),L=function(){function e(t,n,a,r){Object(x.a)(this,e),this.file=void 0,this._name=void 0,this.start=void 0,this.end=void 0,this.trackId=void 0,this._extension=void 0,this._blob=void 0,this.file=t,this._name=t.name+"_"+n+"_"+a,this.start=n,this.end=a,this.trackId=r,this._extension=_}return Object(y.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"base64",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new FileReader,e.t0=r,e.next=4,t.blob();case 4:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),r.onloadend=function(){var e=r.result,t=e.substring(e.indexOf(",")+1);n(t)};case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=5;break}return e.next=3,this._clipAudio();case 3:return this._blob=e.sent,e.abrupt("return");case 5:return e.next=7,this._audioElement(this._blob,!1);case 7:return(t=e.sent).currentTime=0,e.next=11,t.play();case 11:return e.next=13,this._stopAudio(t);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=4;break}return e.next=3,this._clipAudio();case 3:this._blob=e.sent;case 4:return e.abrupt("return",this._blob);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_clipAudio",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(n,a){var i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._audioElement(t.file,!0);case 2:(i=e.sent).oncanplay=function(){var e=Object(c.a)(d.a.mark((function e(a){var o,c,s,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.play(),o=t._captureStream(i),c=Object(r.a)(o.getVideoTracks());try{for(c.s();!(s=c.n()).done;)s.value.stop()}catch(a){c.e(a)}finally{c.f()}return u=new MediaRecorder(o,{mimeType:A}),l=[],u.ondataavailable=function(e){l.push(e.data)},u.onstop=function(e){n(new Blob(l))},u.start(),e.next=11,t._stopAudio(i);case 11:u.stop();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_audioElement",value:function(e,t){var n=this,a=new Audio;return a.src=URL.createObjectURL(e),new Promise((function(e,i){a.onloadedmetadata=function(i){if(t&&n.trackId&&a.audioTracks&&a.audioTracks.length>0){var o,c=Object(r.a)(a.audioTracks);try{for(c.s();!(o=c.n()).done;){var s=o.value;s.enabled=n.trackId===s.id}}catch(u){c.e(u)}finally{c.f()}}a.currentTime=n.start/1e3,e(a)}}))}},{key:"_captureStream",value:function(e){if("function"===typeof e.captureStream)return e.captureStream();if("function"===typeof e.mozCaptureStream)return e.mozCaptureStream();throw new Error("Unable to capture stream from audio")}},{key:"_stopAudio",value:function(){var e=Object(c.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){setTimeout((function(){t.pause();var n=t.src;t.src="",URL.revokeObjectURL(n),e(void 0)}),n.end-n.start+100)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"slice",value:function(t,n){return new e(this.file,t,n,this.trackId)}},{key:"isSliceable",value:function(e,t){return!0}}]),e}(),H=function(){function e(t,n){Object(x.a)(this,e),this.data=void 0,this.workerFactory=void 0,this._blob=void 0,this.data=t,this.workerFactory=n}return Object(y.a)(e,[{key:"name",get:function(){return this.data.name}},{key:"extension",get:function(){return"mp3"}},{key:"base64",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new FileReader,e.t0=r,e.next=5,t.blob();case 5:e.t1=e.sent,e.t0.readAsDataURL.call(e.t0,e.t1),r.onloadend=function(){var e=r.result,t=e.substring(e.indexOf(",")+1);n(t)},e.next=13;break;case 10:e.prev=10,e.t2=e.catch(0),a(e.t2);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._blob){e.next=9;break}return e.t0=F,e.next=4,this.data.blob();case 4:return e.t1=e.sent,e.t2=this.workerFactory,e.next=8,e.t0.encode.call(e.t0,e.t1,e.t2);case 8:this._blob=e.sent;case 9:return e.abrupt("return",this._blob);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(t,n){return new e(this.data.slice(t,n),this.workerFactory)}},{key:"isSliceable",value:function(e,t){return this.data.isSliceable(e,t)}}]),e}(),U=function(){function e(t){Object(x.a)(this,e),this.data=void 0,this.data=t}return Object(y.a)(e,[{key:"name",get:function(){return this.data.name+"."+this.data.extension}},{key:"play",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.play();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"base64",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t,n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:t=e.sent,n=window.URL.createObjectURL(t),a=document.createElement("a"),document.body.appendChild(a),a.style.display="none",a.href=n,a.download=this.name,a.click(),URL.revokeObjectURL(n),a.remove();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toMp3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;return this.data instanceof H?this:new e(new H(this.data,t))}},{key:"slice",value:function(t,n){return new e(this.data.slice(t,n))}},{key:"isSliceable",value:function(e,t){return this.data.isSliceable(e,t)}}],[{key:"fromBase64",value:function(t,n,a,r,i){return new e(new N(t.substring(0,t.lastIndexOf(".")),n,a,r,i))}},{key:"fromFile",value:function(t,n,a,r){return new e(new L(t,n,a,r))}}]),e}(),W=function(){function e(){Object(x.a)(this,e)}return Object(y.a)(e,[{key:"resize",value:function(e,t,n,a){return new Promise((function(r,i){var o=n<=0?1:n/e.width,c=a<=0?1:a/e.height,s=Math.min(1,Math.min(o,c));if(s<1){var u=e.width*s,l=e.height*s;createImageBitmap(e,{resizeWidth:u,resizeHeight:l}).then((function(n){e.width=u,e.height=l,t.drawImage(n,0,0),r(e)})).catch((function(e){return i(e)}))}else r(e)}))}}]),e}(),q=function(){function e(t,n,a){Object(x.a)(this,e),this._name=void 0,this._base64=void 0,this._extension=void 0,this.cachedBlob=void 0,this._name=t,this._base64=n,this._extension=a}return Object(y.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return this._extension}},{key:"base64",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._base64);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cachedBlob){e.next=6;break}return e.next=3,fetch(this._dataUrl());case 3:return e.next=5,e.sent.blob();case 5:this.cachedBlob=e.sent;case 6:return e.abrupt("return",this.cachedBlob);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._dataUrl());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_dataUrl",value:function(){return"data:image/"+this.extension+";base64,"+this._base64}}]),e}(),z=function(){function e(t,n,a,r){Object(x.a)(this,e),this.file=void 0,this.timestamp=void 0,this.maxWidth=void 0,this.maxHeight=void 0,this._name=void 0,this.file=t,this._name=t.name+"_"+Math.floor(n)+".jpeg",this.timestamp=n,this.maxWidth=a,this.maxHeight=r}return Object(y.a)(e,[{key:"name",get:function(){return this._name}},{key:"extension",get:function(){return"jpeg"}},{key:"base64",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(n,a){var r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:r=e.sent,i=r.toDataURL("image/jpeg"),n(i.substring(i.indexOf(",")+1));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._canvas();case 2:e.sent.toBlob((function(e){null===e?a(new Error("Could not obtain blob")):n(e)}),"image/jpeg");case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canvas();case 2:return t=e.sent,e.abrupt("return",t.toDataURL());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_canvas",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(n,a){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=t._videoElement(t.file)).oncanplay=function(){var e=Object(c.a)(d.a.mark((function e(a){var i,o,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=document.createElement("canvas")).width=r.videoWidth,i.height=r.videoHeight,(o=i.getContext("2d")).drawImage(r,0,0,i.width,i.height),!(t.maxWidth>0||t.maxHeight>0)){e.next=12;break}return c=new W,e.next=9,c.resize(i,o,t.maxWidth,t.maxHeight);case 9:n(i),e.next=13;break;case 12:n(i);case 13:URL.revokeObjectURL(r.src);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_videoElement",value:function(e){var t=document.createElement("video");return t.src=URL.createObjectURL(e),t.preload="none",t.currentTime=this.timestamp/1e3,t.load(),t}}]),e}(),V=function(){function e(t){Object(x.a)(this,e),this.data=void 0,this.data=t}return Object(y.a)(e,[{key:"name",get:function(){return this.data.name}},{key:"extension",get:function(){return this.data.extension}},{key:"base64",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.base64();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dataUrl",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.dataUrl();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"blob",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pngBlob",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=createImageBitmap,e.next=4,t.blob();case 4:e.t1=e.sent,(0,e.t0)(e.t1).then((function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toBlob((function(e){e?n(e):a("Failed to convert to PNG")}),"image/png")})),e.next=11;break;case 8:e.prev=8,e.t2=e.catch(0),a(e.t2);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"download",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t,n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data.blob();case 2:t=e.sent,n=window.URL.createObjectURL(t),a=document.createElement("a"),document.body.appendChild(a),a.style.display="none",a.href=n,a.download=this.data.name,a.click(),URL.revokeObjectURL(n),a.remove();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"fromBase64",value:function(t,n,a,r){var i=t.substring(0,t.lastIndexOf("."))+"_"+Math.floor(n)+"."+r;return new e(new q(i,a,r))}},{key:"fromFile",value:function(t,n,a,r){return new e(new z(t,n,a,r))}}]),e}(),G=function(){function e(){Object(x.a)(this,e)}return Object(y.a)(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=Object(c.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",body:JSON.stringify(n)});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}]),e}(),K=['"',"*","_","\\",":"],X=[":","/","\\","<",">",'"',"|","?","*","^"],J=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new G;Object(x.a)(this,e),this.settingsProvider=void 0,this.fetcher=void 0,this.settingsProvider=t,this.fetcher=n}return Object(y.a)(e,[{key:"deckNames",value:function(){var e=Object(c.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("deckNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelNames",value:function(){var e=Object(c.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelNames",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modelFieldNames",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("modelFieldNames",{modelName:t},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWord",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("findNotes",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findNotesWithWordGui",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("guiBrowse",{query:this.settingsProvider.wordField+":"+this._escapeQuery(t)},n);case 2:return a=e.sent,e.abrupt("return",a.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_escapeQuery",value:function(e){for(var t="",n=0;n<e.length;++n){var a=e[n];K.includes(a)?t+="\\".concat(a):t+=a}return'"'.concat(t,'"')}},{key:"requestPermission",value:function(){var e=Object(c.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._executeAction("requestPermission",null,t);case 2:return n=e.sent,e.abrupt("return",n.result);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n,a,r,i,o,c,s,u,l,b){var f,h,v,p,g,j,m,O,k,x,y,w,S,C,T;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f={},this._appendField(f,this.settingsProvider.sentenceField,t,!0),this._appendField(f,this.settingsProvider.definitionField,n,!0),this._appendField(f,this.settingsProvider.wordField,i,!1),this._appendField(f,this.settingsProvider.sourceField,o,!1),this._appendField(f,this.settingsProvider.urlField,c,!1),s)for(h=0,v=Object.keys(s);h<v.length;h++)p=v[h],this._appendField(f,this.settingsProvider.customAnkiFields[p],s[p],!0);if(g={note:{deckName:this.settingsProvider.deck,modelName:this.settingsProvider.noteType,tags:u,options:{allowDuplicate:!1,duplicateScope:"deck",duplicateScopeOptions:{deckName:this.settingsProvider.deck,checkChildren:!1}}}},j="gui"===l,!this.settingsProvider.audioField||!a){e.next=30;break}if(m=this._sanitizeFileName(a.name),!j){e.next=24;break}return e.t0=this,e.t1=m,e.next=16,a.base64();case 16:return e.t2=e.sent,e.t3=b,e.next=20,e.t0._storeMediaFile.call(e.t0,e.t1,e.t2,e.t3);case 20:O=e.sent.result,this._appendField(f,this.settingsProvider.audioField,"[sound:".concat(O,"]"),!1),e.next=30;break;case 24:return e.t4=m,e.next=27,a.base64();case 27:e.t5=e.sent,e.t6=[this.settingsProvider.audioField],g.note.audio={filename:e.t4,data:e.t5,fields:e.t6};case 30:if(!this.settingsProvider.imageField||!r){e.next=51;break}if(k=this._sanitizeFileName(r.name),!j){e.next=45;break}return e.t7=this,e.t8=k,e.next=37,r.base64();case 37:return e.t9=e.sent,e.t10=b,e.next=41,e.t7._storeMediaFile.call(e.t7,e.t8,e.t9,e.t10);case 41:x=e.sent.result,this._appendField(f,this.settingsProvider.imageField,'<div><img src="'.concat(x,'"></div>'),!1),e.next=51;break;case 45:return e.t11=k,e.next=48,r.base64();case 48:e.t12=e.sent,e.t13=[this.settingsProvider.imageField],g.note.picture={filename:e.t11,data:e.t12,fields:e.t13};case 51:g.note.fields=f,e.t14=l,e.next="gui"===e.t14?55:"updateLast"===e.t14?58:"default"===e.t14?79:82;break;case 55:return e.next=57,this._executeAction("guiAddCards",g,b);case 57:return e.abrupt("return",e.sent.result);case 58:return e.next=60,this._executeAction("findNotes",{query:"added:1"},b);case 60:if(0!==(y=e.sent.result.sort()).length){e.next=63;break}throw new Error("Could not find note to update");case 63:return w=y[y.length-1],g.note.id=w,e.next=67,this._executeAction("notesInfo",{notes:[w]});case 67:if(!((S=e.sent).result.length>0&&S.result[0].noteId===w)){e.next=78;break}return C=S.result[0],e.next=72,this._executeAction("updateNoteFields",g,b);case 72:if(this.settingsProvider.wordField&&C.fields){e.next=74;break}return e.abrupt("return",C.noteId);case 74:if((T=C.fields[this.settingsProvider.wordField])&&T.value){e.next=77;break}return e.abrupt("return",C.noteId);case 77:return e.abrupt("return",T.value);case 78:throw new Error("Could not update last card because the card info could not be fetched");case 79:return e.next=81,this._executeAction("addNote",g,b);case 81:return e.abrupt("return",e.sent.result);case 82:throw new Error("Unknown export mode: "+l);case 83:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r,i,o,c,s,u,l,d){return e.apply(this,arguments)}}()},{key:"_appendField",value:function(e,t,n,a){if(t&&n){var r=a?n.split("\n").join("<br>"):n,i=e[t];i&&(r=i+"<br>"+r),e[t]=r}}},{key:"_sanitizeFileName",value:function(e){for(var t="",n=0;n<e.length;++n){var a=e[n];X.includes(a)?t+="_":t+=a}return t}},{key:"_storeMediaFile",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAction("storeMediaFile",{filename:t,data:n},a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"_executeAction",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n,a){var r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={action:t,version:6},n&&(r.params=n),e.next=4,this.fetcher.fetch(a||this.settingsProvider.ankiConnectUrl,r);case 4:if(!(i=e.sent).error){e.next=7;break}throw new Error(i.error);case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()}]),e}();function Y(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=Math.floor(e/1e3);t=n?Math.round(e/1e3%60*10)/10:a%60;var r=Math.floor(a/60)%60,i=Math.floor(a/3600);return i>0?i+"h"+String(r).padStart(2,"0")+"m"+String(t).padStart(2,"0")+"s":r+"m"+String(t).padStart(2,"0")+"s"}function Q(e,t,n,a){for(var r=t,i=t;i>=0&&!Z(e,r=i,t,n,a,!1);--i);for(var o=r,c=t;c<=e.length-1&&!Z(e,o=c,t,n,a,!0);++c);return e.slice(r,o+1)}function $(e,t,n){var a=[e],r=e.start-e.originalStart;if(e.end<t){var i=Math.min(t,e.end+n);a.push({text:"",start:e.end,end:i,originalStart:e.end-r,originalEnd:i-r,track:e.track})}if(e.start>0){var o=Math.max(0,e.start-n);a.unshift({text:"",start:o,end:e.start,originalStart:o-r,originalEnd:e.start-r,track:e.track})}return a}function Z(e,t,n,a,r,i){var o;return o=i?t+1<e.length?e[t+1]:null:t-1>=0?e[t-1]:null,Math.abs(n-t)>=a&&(null===o||Math.abs(o.start-e[n].start)>=r)}!function(e){e[e.none=0]="none",e[e.showAnkiDialog=1]="showAnkiDialog",e[e.updateLastCard=2]="updateLastCard"}(P||(P={})),function(e){e[e.atStart=1]="atStart",e[e.atEnd=2]="atEnd"}(I||(I={})),function(e){e[e.normal=1]="normal",e[e.condensed=2]="condensed",e[e.autoPause=3]="autoPause"}(M||(M={}));var ee=n(353),te=n(6),ne=n(351),ae=n(264),re=n(1),ie=Object(p.a)({root:{display:"flex",justifyContent:"center",position:"fixed",top:80,width:"100%",pointerEvents:"none",zIndex:2e3}});function oe(e){var t=ie();return Object(b.useEffect)((function(){if(e.open){var t=setTimeout(e.onClose,e.autoHideDuration);return function(){return clearTimeout(t)}}}),[e.open,e.autoHideDuration,e.onClose]),Object(re.jsx)("div",{className:t.root,children:Object(re.jsx)(ae.a,{in:e.open,children:Object(re.jsx)(ne.a,{severity:e.severity,children:e.children})})})}var ce=n(5),se=n(320),ue=["tags","onTagsChange"];function le(e){var t=e.tags,n=e.onTagsChange,a=Object(ce.a)(e,ue),i=Object(b.useState)(""),c=Object(s.a)(i,2),u=c[0],l=c[1];Object(b.useEffect)((function(){t.join(", ")!==u&&l(t.join(", "))}),[u,t]);var d=Object(b.useCallback)((function(e){var t=e.target.value;u.length>t.length&&u.includes(t)&&t.endsWith(",")&&(t=t.substring(0,t.length-1));var a=function(e){var t,n=e.split(" ").join("").split(","),a=[],i=Object(r.a)(n);try{for(i.s();!(t=i.n()).done;){var o=t.value;a.push(o.trim())}}catch(c){i.e(c)}finally{i.f()}return a}(t);l(a.join(", ")),n(a)}),[u,n]);return Object(re.jsx)(se.a,Object(o.a)(Object(o.a)({},a),{},{value:u,onChange:d}))}var de=n(274),be=n(325),fe=n(326),he=n(324),ve=Object(de.a)((function(e){return{image:function(e){return{width:e.width,height:e.height,backgroundSize:"contain"}}}}));function pe(e){var t,n=e.open,a=e.image,r=e.onClose,i=Object(b.useState)(),o=Object(s.a)(i,2),u=o[0],l=o[1],f=Object(b.useState)(0),h=Object(s.a)(f,2),v=h[0],p=h[1],g=Object(b.useState)(0),j=Object(s.a)(g,2),m=j[0],O=j[1],k=function(){var e=Object(b.useState)([0,0]),t=Object(s.a)(e,2),n=t[0],a=t[1];return Object(b.useLayoutEffect)((function(){function e(){a([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),x=Object(s.a)(k,2),y=x[0],w=x[1];t=v>0&&m>0?Math.min(1,Math.min(y/(2*v),w/(2*m))):1;var S=ve({width:v*t,height:m*t});return Object(b.useEffect)((function(){function e(){return e=Object(c.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,a.dataUrl();case 4:t=e.sent,(n=new Image).onload=function(){p(n.width),O(n.height),l(t)},n.src=t;case 8:case"end":return e.stop()}}),e)}))),e.apply(this,arguments)}l(void 0),function(){e.apply(this,arguments)}()}),[a]),a&&u?Object(re.jsx)(he.a,{open:n,onClose:r,maxWidth:"lg",children:Object(re.jsx)(be.a,{children:Object(re.jsx)(fe.a,{className:S.image,image:u,title:a.name,style:{width:v*t,height:m*t}})})}):null}var ge=n(7),je=n(332),me=n(86),Oe=n.n(me),ke=n(331),xe=n(329),ye=n(94),we=n.n(ye),Se=n(330),Ce=n(265),Te=n(327),Fe=n(95),Ee=n(150),Pe=n.n(Ee),Ie=n(149),Me=n.n(Ie),Re=n(85),De=n.n(Re),Ae=n(357),_e=n(328),Be=n(355),Ne=n(50),Le=n(151),He=n.n(Le);function Ue(e){var t=e.subtitle,n=e.availableWidth,a=e.scale;if(void 0===t.textImage)return null;var r=a*n/t.textImage.screen.width*t.textImage.image.width;return Object(re.jsx)("div",{style:{maxWidth:r},children:Object(re.jsx)("img",{style:{width:"100%"},alt:"subtitle",src:t.textImage.dataUrl})})}var We=Object(p.a)((function(e){return{root:{"& .MuiTextField-root":{marginBottom:e.spacing(1)}},title:{flexGrow:1},mediaField:{cursor:"pointer","& input":{cursor:"pointer"}},rangeSelectSlider:{"& .MuiSlider-markLabel":{transform:"translateX(-3%)"}}}}));function qe(e,t){var n={};return e.subtitles.filter((function(e){return""!==e.text.trim()||void 0!==e.textImage})).map((function(e){return e.start in n?null:(n[e.start]=!0,{value:e.start,label:"".concat(e.text.trim().substring(0,Math.min(e.text.length,3)),"...")})})).filter((function(e){return null!==e})).filter((function(e){return e.value>=t[0]&&e.value<=t[1]}))}function ze(e){return Y(e,!0)}function Ve(e,t){return e.start>=t[0]&&e.start<=t[1]||e.end>=t[0]&&e.end<=t[1]||t[0]>=e.start&&t[0]<=e.end||t[1]>=e.start&&t[1]<=e.end}function Ge(e){var t=e.children,n=e.open,a=e.value;return Object(re.jsx)(Be.a,{open:n,enterTouchDelay:0,placement:"top",title:a,children:t})}var Ke=Object(p.a)((function(e){return{root:{marginBottom:e.spacing(1),padding:e.spacing(1),backgroundColor:e.palette.action.disabledBackground}}}));function Xe(e){var t=e.selectedSubtitles,n=e.width,a=Ke();return 0===t.length||n<=0?null:Object(re.jsx)(Fe.a,{elevation:0,className:a.root,children:t.map((function(e,t){return Object(re.jsx)(Ue,{availableWidth:n,subtitle:e,scale:1},t)}))})}var Je=Object(ge.a)({root:{transform:"translateY(-8px)"}})(Te.a);function Ye(e){var t=e.open,n=e.disabled,a=e.text,i=e.onProceed,o=e.onRewind,u=e.onCancel,l=e.onViewImage,f=e.onOpenSettings,h=e.onRerecord,v=e.audioClip,p=e.image,g=e.source,j=e.url,m=e.sliderContext,O=e.customFields,k=e.settingsProvider,x=e.anki,y=e.definition,w=e.word,S=e.customFieldValues,C=e.timestampInterval,T=e.initialTimestampInterval,F=e.lastAppliedTimestampIntervalToText,E=e.lastAppliedTimestampIntervalToAudio,P=e.stateRef,I=We(),M=Object(b.useState)(""),R=Object(s.a)(M,2),D=R[0],A=R[1],_=Object(b.useState)(""),B=Object(s.a)(_,2),N=B[0],L=B[1],H=Object(b.useState)(""),U=Object(s.a)(H,2),W=U[0],q=U[1],z=Object(b.useState)(),V=Object(s.a)(z,2),G=V[0],K=V[1],X=Object(b.useState)(null!==g&&void 0!==g?g:""),J=Object(s.a)(X,2),Y=J[0],Q=J[1],$=Object(b.useState)(k.tags),Z=Object(s.a)($,2),ee=Z[0],te=Z[1],ne=Object(b.useState)(null!==j&&void 0!==j?j:""),ae=Object(s.a)(ne,2),ie=ae[0],oe=ae[1],ce=Object(b.useState)([]),ue=Object(s.a)(ce,2),de=ue[0],be=ue[1],fe=Object(b.useState)(0),ve=Object(s.a)(fe,2),pe=ve[0],ge=ve[1],me=Object(b.useState)({}),ye=Object(s.a)(me,2),Fe=ye[0],Ee=ye[1],Ie=Object(b.useState)(),Re=Object(s.a)(Ie,2),Le=Re[0],Ue=Re[1],Ke=Object(b.useState)([]),Ye=Object(s.a)(Ke,2),Qe=Ye[0],$e=Ye[1],Ze=Object(b.useState)(),et=Object(s.a)(Ze,2),tt=et[0],nt=et[1],at=Object(b.useState)(),rt=Object(s.a)(at,2),it=rt[0],ot=rt[1],ct=Object(b.useState)(),st=Object(s.a)(ct,2),ut=st[0],lt=st[1],dt=Object(b.useState)(),bt=Object(s.a)(dt,2),ft=bt[0],ht=bt[1],vt=Object(b.useState)(),pt=Object(s.a)(vt,2),gt=pt[0],jt=pt[1],mt=Object(b.useState)(),Ot=Object(s.a)(mt,2),kt=Ot[0],xt=Ot[1],yt=Object(b.useState)(0),wt=Object(s.a)(yt,2),St=wt[0],Ct=wt[1],Tt=Object(b.useState)(),Ft=Object(s.a)(Tt,2),Et=Ft[0],Pt=Ft[1],It=Object(b.useCallback)((function(e){var t;Ct(null!==(t=null===e||void 0===e?void 0:e.getBoundingClientRect().width)&&void 0!==t?t:0)}),[]);P&&(P.current={text:N,sliderContext:m,definition:D,word:W,source:Y,url:ie,customFieldValues:Fe,initialTimestampInterval:tt,lastAppliedTimestampIntervalToText:gt,lastAppliedTimestampIntervalToAudio:kt,timestampInterval:Le}),Object(b.useEffect)((function(){L(null!==a&&void 0!==a?a:""),A(null!==y&&void 0!==y?y:""),q(null!==w&&void 0!==w?w:""),Q(null!==g&&void 0!==g?g:""),oe(null!==j&&void 0!==j?j:""),be([]),Ee(null!==S&&void 0!==S?S:{})}),[a,g,y,w,S,j]),Object(b.useEffect)((function(){te(k.tags)}),[k.tags]),Object(b.useEffect)((function(){var e=C||m&&[m.subtitleStart,m.subtitleEnd]||void 0,t=m&&function(e){var t,n=null,a=null,i=Object(r.a)(e.subtitles);try{for(i.s();!(t=i.n()).done;){var o=t.value;(null===n||o.start<n)&&(n=o.start),(null===a||o.end>a)&&(a=o.end)}}catch(c){i.e(c)}finally{i.f()}return null!==n&&null!==a&&[n,a]}(m)||void 0,n=m&&qe(m,t)||void 0,a=void 0===m||void 0===e?[]:m.subtitles.filter((function(t){return Ve(t,e)}));Ue(e),$e(a),nt(T||e),jt(F||e),xt(E||e),lt(t),ot(t),ht(n)}),[m,T,C,F,E]),Object(b.useEffect)((function(){if(v){var e=v;k.preferMp3&&(e=e.toMp3()),kt&&(e=e.slice(Math.max(0,Math.round(kt[0])-k.audioPaddingStart),Math.round(kt[1])+k.audioPaddingEnd)),Pt(e)}else Pt(void 0)}),[v,k.preferMp3,kt,k.audioPaddingStart,k.audioPaddingEnd]),Object(b.useEffect)((function(){ge(Date.now())}),[W]),Object(b.useEffect)((function(){if(W&&k.wordField){var e=W.trim();if(""!==e&&e!==G){var t=setTimeout(Object(c.a)(d.a.mark((function t(){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=be,t.next=4,x.findNotesWithWord(e);case 4:t.t1=t.sent,(0,t.t0)(t.t1),K(e),t.next=12;break;case 9:t.prev=9,t.t2=t.catch(0),console.error(t.t2);case 12:case"end":return t.stop()}}),t,null,[[0,9]])}))),500);return function(){return clearTimeout(t)}}}}),[W,pe,G,x,k.wordField]);var Mt,Rt=Object(b.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),Et.play()}),[Et]),Dt=Object(b.useCallback)((function(e,t){var n={};Object.assign(n,Fe),n[e]=t,Ee(n)}),[Fe]);Mt=W&&W.trim()===G&&k.wordField?de.length>0?"Found ".concat(de.length,' notes with word "').concat(W,'" in field "').concat(k.wordField,'"'):'No notes found with word "'.concat(W.trim(),'" in field "').concat(k.wordField,'"'):"";var At=Object(b.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),l(p)}),[p,l]),_t=Object(b.useCallback)((function(e,t){var n=t;Ue(n);var a=m.subtitles.filter((function(e){return Ve(e,n)}));$e(a)}),[m]),Bt=Object(b.useCallback)((function(){var e=Le,t=m.subtitles.filter((function(t){return Ve(t,e)})).map((function(e){return e.text})).join("\n");L(t),jt(Le)}),[Le,m]),Nt=Object(b.useCallback)((function(e){h?(e.stopPropagation(),h()):xt(Le)}),[h,Le]),Lt=Object(b.useCallback)((function(){if(it){var e=void 0===m||void 0===tt?[]:m.subtitles.filter((function(e){return Ve(e,tt)}));$e(e),Ue(tt),lt(it),ht(m&&qe(m,it))}}),[tt,it,m]),Ht=Object(b.useCallback)((function(){if(ut&&Le){var e=[(ut[0]+Le[0])/2,(ut[1]+Le[1])/2];lt(e),ht(m&&qe(m,e))}}),[ut,Le,m]),Ut=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),p){e.next=3;break}return e.abrupt("return");case 3:return e.t0=navigator.clipboard,e.t1=ClipboardItem,e.next=7,p.pngBlob();case 7:e.t2=e.sent,e.t3={"image/png":e.t2},e.t4=new e.t1(e.t3),e.t5=[e.t4],e.t0.write.call(e.t0,e.t5);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[p]),Wt=!m||0===m.subtitles.filter((function(e){return""!==e.text.trim()})).length;return Object(re.jsxs)(he.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"sm",onClose:u,children:[Object(re.jsxs)(_e.a,{children:[Object(re.jsx)(Ne.a,{variant:"h6",className:I.title,children:"Anki Export"}),f&&Object(re.jsx)(Ce.a,{edge:"end",onClick:function(){return f()},children:Object(re.jsx)(De.a,{})})]}),Object(re.jsx)(xe.a,{ref:It,children:Object(re.jsxs)("form",{className:I.root,children:[m&&Le&&Object(re.jsx)(Xe,{selectedSubtitles:Qe.filter((function(e){return void 0!==e.textImage})),width:St}),Object(re.jsx)(se.a,{variant:"filled",color:"secondary",multiline:!0,fullWidth:!0,maxRows:8,label:"Sentence",value:N,onChange:function(e){return L(e.target.value)},InputProps:{endAdornment:Le&&Object(re.jsx)(Je,{position:"end",children:Object(re.jsx)(Be.a,{title:"Apply Selection",children:Object(re.jsx)("span",{children:Object(re.jsx)(Ce.a,{disabled:!Le||!gt||Le[0]===gt[0]&&Le[1]===gt[1]||Wt,onClick:Bt,edge:"end",children:Object(re.jsx)(we.a,{})})})})})}}),Object(re.jsx)(se.a,{variant:"filled",color:"secondary",multiline:!0,fullWidth:!0,rows:8,label:"Definition",value:D,onChange:function(e){return A(e.target.value)}}),Object(re.jsx)(se.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"Word",value:W,onChange:function(e){return q(e.target.value)},helperText:Mt,InputProps:{endAdornment:Object(re.jsx)(Te.a,{position:"end",children:Object(re.jsx)(Be.a,{title:"Search in Anki",children:Object(re.jsx)("span",{children:Object(re.jsx)(Ce.a,{disabled:n||!k.wordField||!W||""===W.trim(),onClick:function(){return x.findNotesWithWordGui(W.trim())},edge:"end",children:Object(re.jsx)(Me.a,{})})})})})}}),Object.keys(O).map((function(e){return Object(re.jsx)(se.a,{variant:"filled",color:"secondary",fullWidth:!0,multiline:!0,maxRows:8,label:e,value:Fe[e]||"",onChange:function(t){return Dt(e,t.target.value)}},e)})),Et&&Object(re.jsx)("div",{className:I.mediaField,onClick:Rt,children:Object(re.jsx)(se.a,{variant:"filled",color:"secondary",fullWidth:!0,value:Et.name,label:"Audio",InputProps:{endAdornment:Le&&Object(re.jsx)(Te.a,{position:"end",children:h?Object(re.jsx)(Be.a,{title:"Apply Selection (rerecord)",children:Object(re.jsx)("span",{children:Object(re.jsx)(Ce.a,{disabled:!Le||!kt||Le[0]===kt[0]&&Le[1]===kt[1],onClick:Nt,edge:"end",children:Object(re.jsx)(we.a,{})})})}):Object(re.jsx)(Be.a,{title:"Apply Selection",children:Object(re.jsx)("span",{children:Object(re.jsx)(Ce.a,{disabled:!kt||Le[0]===kt[0]&&Le[1]===kt[1]||!Et.isSliceable(Le[0],Le[1]),onClick:Nt,edge:"end",children:Object(re.jsx)(we.a,{})})})})})}})}),p&&Object(re.jsx)("div",{className:I.mediaField,onClick:At,children:Object(re.jsx)(se.a,{variant:"filled",color:"secondary",fullWidth:!0,value:p.name,label:"Image",InputProps:{endAdornment:Object(re.jsx)(Te.a,{position:"end",children:Object(re.jsx)(Be.a,{title:"Copy to Clipboard",children:Object(re.jsx)("span",{children:Object(re.jsx)(Ce.a,{onClick:Ut,edge:"end",children:Object(re.jsx)(Oe.a,{})})})})})}})}),Object(re.jsx)(se.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"Source",value:Y,onChange:function(e){return Q(e.target.value)}}),j&&Object(re.jsx)(se.a,{variant:"filled",color:"secondary",fullWidth:!0,label:"URL",value:ie,onChange:function(e){return oe(e.target.value)}}),k.tags.length>0&&Object(re.jsx)(le,{variant:"filled",label:"Tags",helperText:"Comma-separated list of strings",fullWidth:!0,color:"secondary",tags:ee,onTagsChange:function(e){return te(e)}}),Le&&ut&&ft&&Object(re.jsxs)(Se.a,{container:!0,direction:"row",children:[Object(re.jsx)(Se.a,{item:!0,style:{flexGrow:1},children:Object(re.jsx)(Ae.a,{ValueLabelComponent:Ge,value:Le,valueLabelFormat:ze,onChange:_t,min:ut[0],max:ut[1],marks:ft,step:1,valueLabelDisplay:"auto",className:I.rangeSelectSlider,color:"secondary"})}),Object(re.jsx)(Se.a,{item:!0,children:Object(re.jsx)(Be.a,{title:"Reset",children:Object(re.jsx)("span",{children:Object(re.jsx)(Ce.a,{edge:"end",style:{marginTop:-8},onClick:Lt,children:Object(re.jsx)(Pe.a,{})})})})}),Object(re.jsx)(Se.a,{item:!0,children:Object(re.jsx)(Be.a,{title:"Zoom In",children:Object(re.jsx)("span",{children:Object(re.jsx)(Ce.a,{edge:"end",style:{marginTop:-8},onClick:Ht,children:Object(re.jsx)(He.a,{})})})})})]})]})}),Object(re.jsxs)(ke.a,{children:[Object(re.jsx)(je.a,{disabled:n,onClick:function(){return u()},children:"Cancel"}),m&&Object(re.jsx)(je.a,{disabled:n,onClick:function(){return o()},children:"Rewind"}),Object(re.jsx)(je.a,{disabled:n,onClick:function(){return i(N,D,Et,p,W,null!==Y&&void 0!==Y?Y:"",null!==ie&&void 0!==ie?ie:"",Fe,ee,"gui")},children:"Open in Anki"}),Object(re.jsx)(je.a,{disabled:n,onClick:function(){return i(N,D,Et,p,W,null!==Y&&void 0!==Y?Y:"",null!==ie&&void 0!==ie?ie:"",Fe,ee,"updateLast")},children:"Update Last Card"}),Object(re.jsx)(je.a,{disabled:n,onClick:function(){return i(N,D,Et,p,W,null!==Y&&void 0!==Y?Y:"",null!==ie&&void 0!==ie?ie:"",Fe,ee,"default")},children:"Export"})]})]})}var Qe=n(349),$e=n(187),Ze=n.p+"static/media/background-colored.cbc50e45.png",et=Object(de.a)((function(e){return{root:function(e){var t=e.dragging;return{position:"absolute",height:e.appBarHidden?"100%":"calc(100% - 64px)",width:"100%",zIndex:101,pointerEvents:t?"auto":"none"}},transparentBackground:function(e){return{"&::before":{content:"' '",position:"absolute",height:e.appBarHidden?"100vh":"calc(100vh - 64px)",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",backgroundSize:"300px 300px",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundImage:"url(".concat(Ze,")"),backgroundBlendMode:"overlay",background:"rgba(0, 0, 0, .3)",filter:"drop-shadow(10px 10px 10px rgb(0, 0, 0, .4))"},width:"100%",height:"100%"}}}}));function tt(e){var t=e.dragging,n=e.appBarHidden,a=e.loading,r=et({dragging:t,appBarHidden:n});return Object(re.jsx)("div",{className:r.root,children:Object(re.jsx)($e.a,{in:t||a,children:Object(re.jsx)("div",{className:r.transparentBackground})})})}var nt,at=n(87),rt=n(350),it=n(152),ot=n(104),ct=n(156),st=n(72),ut=n(92),lt=function(){function e(t){Object(x.a)(this,e),this.buffer=void 0,this.buffer=t}return Object(y.a)(e,[{key:"length",get:function(){return this.buffer.length}},{key:"at",value:function(e){return this.buffer[e]}},{key:"subarray",value:function(t,n){return new e(this.buffer.subarray(t,n))}}]),e}(),dt=function(){function e(t){Object(x.a)(this,e),this.buffers=[],this.buffers=t}return Object(y.a)(e,[{key:"length",get:function(){var e,t=0,n=Object(r.a)(this.buffers);try{for(n.s();!(e=n.n()).done;){t+=e.value.length}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"at",value:function(e){var t,n=0,a=Object(r.a)(this.buffers);try{for(a.s();!(t=a.n()).done;){var i=t.value,o=e-n;if(o<i.length)return i.at(o);n+=i.length}}catch(c){a.e(c)}finally{a.f()}throw new Error("Out of bounds")}},{key:"subarray",value:function(t,n){var a,i=[],o=0,c=Object(r.a)(this.buffers);try{for(c.s();!(a=c.n()).done;){var s=a.value,u=Math.max(0,t-o),l=Math.min(s.length,n-o);l>0&&u<l&&i.push(s.subarray(u,l)),o+=s.length}}catch(d){c.e(d)}finally{c.f()}return new e(i)}}]),e}(),bt=function(){function e(){Object(x.a)(this,e),this.buffers=[]}return Object(y.a)(e,[{key:"add",value:function(e){this.buffers.push(e)}},{key:"length",get:function(){var e,t=0,n=Object(r.a)(this.buffers);try{for(n.s();!(e=n.n()).done;){t+=e.value.length}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"read",value:function(e){if(0===e)return new dt([]);for(var t=[],n=0;;){if(0===this.buffers.length)throw new Error("Trying to read more bytes than available");var a=this.buffers.shift(),r=e-n;if(a.length===r){t.push(a);break}if(a.length>r){t.push(a.subarray(0,r)),this.buffers.unshift(a.subarray(r,a.length));break}n+=a.length,t.push(a)}return new dt(t.map((function(e){return new lt(e)})))}}]),e}(),ft=function(){function e(t){Object(x.a)(this,e),this.stream=void 0,this.accumulatedBuffer=new bt,this.requestedBytes=0,this.stream=t}return Object(y.a)(e,[{key:"buffers",value:function(){var e=this;return Object(ut.a)(d.a.mark((function t(){var n,a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.stream.getReader();case 1:if(!(e.accumulatedBuffer.length>=e.requestedBytes)){t.next=7;break}return t.next=5,e.accumulatedBuffer.read(e.requestedBytes);case 5:t.next=13;break;case 7:return t.next=9,Object(st.a)(n.read());case 9:if(!(a=t.sent).done){t.next=12;break}return t.abrupt("break",15);case 12:e.accumulatedBuffer.add(a.value);case 13:t.next=1;break;case 15:case"end":return t.stop()}}),t)})))()}}]),e}(),ht=function(){function e(t){Object(x.a)(this,e),this.buffer=void 0,this._index=0,this.buffer=t}return Object(y.a)(e,[{key:"index",get:function(){return this._index}},{key:"hasNext",get:function(){return this._index<this.buffer.length}},{key:"readHex",value:function(e,t){if(void 0!==t&&this._index+e>t)return 0;for(var n=0,a=0,r=this._index,i=this._index+e-1;i>=r;--i)n+=this.buffer.at(i)<<8*a,++a;return this._index+=e,n}},{key:"readBuffer",value:function(e){var t=this.buffer.subarray(this.index,this.index+e);return this._index+=e,t}}]),e}();!function(e){e[e.pds=20]="pds",e[e.ods=21]="ods",e[e.pcs=22]="pcs",e[e.wds=23]="wds",e[e.end=128]="end"}(nt||(nt={}));var vt,pt=Object.values(nt);function gt(e){var t,n=Object(r.a)(pt);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(e===a)return a}}catch(i){n.e(i)}finally{n.f()}throw new Error("Invalid segment type byte: ".concat(e))}!function(e){e[e.normal=0]="normal",e[e.acquisitionState=64]="acquisitionState",e[e.epochStart=128]="epochStart"}(vt||(vt={}));var jt,mt=Object.values(vt);!function(e){e[e.lastInSequence=64]="lastInSequence",e[e.firstInSequence=128]="firstInSequence",e[e.firstAndLastInSequence=192]="firstAndLastInSequence"}(jt||(jt={}));var Ot=Object.values(jt);var kt=function(){function e(t){Object(x.a)(this,e),this.encodedBuffer=void 0,this.encodedBuffer=t}return Object(y.a)(e,[{key:"decode",value:function(e){for(var t=0,n=0,a=0,r=this.encodedBuffer.length;t<r;){var i=this.encodedBuffer.at(t),o=void 0,c=void 0,s=void 0;if(i>0)c=i,o=1,s=1;else{var u=this.encodedBuffer.at(t+1);if(0===u)c=0,o=0,s=2,n=0,++a;else if(u<64)c=0,o=u,s=2;else if(u<128){c=0,o=(u-64<<8)+this.encodedBuffer.at(t+2),s=3}else if(u<192){c=this.encodedBuffer.at(t+2),o=u-128,s=3}else{var l=this.encodedBuffer.at(t+2);c=this.encodedBuffer.at(t+3),o=(u-192<<8)+l,s=4}}if(o>0){for(var d=n;d<n+o;++d)e(d,a,c);n+=o}t+=s}}}]),e}(),xt=function(){function e(t,n,a,r,i,o){Object(x.a)(this,e),this.presentationCompositionSegment=void 0,this.windowDefinitionSegments=void 0,this.paletteDefinitionSegments=void 0,this.objectDefinitionSegments=void 0,this.endDefinitionSegment=void 0,this.previousDisplaySet=void 0,this.presentationCompositionSegment=t,this.windowDefinitionSegments=n,this.paletteDefinitionSegments=a,this.objectDefinitionSegments=r,this.endDefinitionSegment=i,this.previousDisplaySet=o}return Object(y.a)(e,[{key:"firstOds",get:function(){return this.objectDefinitionSegments.find((function(e){return e.lastInSequenceFlag===jt.firstInSequence||e.lastInSequenceFlag===jt.firstAndLastInSequence}))}},{key:"paletteDefinitionSegment",value:function(e){var t=this.paletteDefinitionSegments.find((function(t){return t.paletteId===e}));if(void 0===t){if(this.presentationCompositionSegment.compositionState!==vt.normal)throw new Error("PCS references invalid PDS and composition state is not 'normal'");if(void 0===this.previousDisplaySet)throw new Error("PCS references invalid PDS and no previous display set to fallback to");return this.previousDisplaySet.paletteDefinitionSegment(e)}return t}},{key:"imageData",value:function(e){var t=this,n=this.paletteDefinitionSegment(this.presentationCompositionSegment.paletteId);if(void 0===n)throw new Error("PCS references invalid PDS");var a=this.firstOds;if(void 0===a||void 0===a.width||void 0===a.height)throw new Error("Missing first ODS with defined width and height");var r=null!==e&&void 0!==e?e:new Uint8ClampedArray(a.width*a.height*4),i=n.paletteEntries.map((function(e){return t.ycrcbToRgba(e)})),o=a.width;return new kt(new dt(this.objectDefinitionSegments.map((function(e){return e.objectData})))).decode((function(e,t,n){var a=4*(t*o+e);if(n>=i.length)r[a]=0,r[a+1]=0,r[a+2]=0,r[a+3]=0;else{var c=i[n];r[a]=c.r,r[a+1]=c.g,r[a+2]=c.b,r[a+3]=c.a}})),new ImageData(r.subarray(0,4*a.width*a.height),a.width,a.height)}},{key:"ycrcbToRgba",value:function(e){var t=e.luminance,n=e.colorDifferenceBlue,a=e.colorDifferenceRed;return{r:this.clamp(Math.floor(t+1.4075*(a-128)),0,255),g:this.clamp(Math.floor(t-.3455*(n-128)-.7169*(a-128)),0,255),b:this.clamp(Math.floor(t+1.779*(n-128)),0,255),a:e.transparency}}},{key:"clamp",value:function(e,t,n){return Math.max(t,Math.min(n,e))}}]),e}();function yt(e){return wt.apply(this,arguments)}function wt(){return(wt=Object(ut.a)(d.a.mark((function e(t){var n,a,r,i,o,c,s,u,l,b,f,h,v,p,g,j,m,O,k,x;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=new ft(t)).requestedBytes=13,o=[],c=[],s=[],u=!1,l=!1,e.prev=7,f=Object(at.a)(n.buffers());case 9:return e.next=11,Object(st.a)(f.next());case 11:if(!(u=!(h=e.sent).done)){e.next=63;break}if(v=h.value,p=new ht(v),!a){e.next=51;break}e.t0=a.segmentType,e.next=e.t0===nt.pcs?18:e.t0===nt.wds?22:e.t0===nt.pds?26:e.t0===nt.ods?30:e.t0===nt.end?35:46;break;case 18:if(void 0===i){e.next=20;break}throw new Error("Unexpected PDS");case 20:return i=St(p,a),e.abrupt("break",47);case 22:if(void 0!==i){e.next=24;break}throw new Error("Unexpected WDS");case 24:return o.push(Ct(p,a)),e.abrupt("break",47);case 26:if(void 0!==i){e.next=28;break}throw new Error("Unexpected PDS");case 28:return c.push(Tt(p,a)),e.abrupt("break",47);case 30:if(void 0!==i){e.next=32;break}throw new Error("Unexpected ODS");case 32:return g=Ft(p,a),s.push(g),e.abrupt("break",47);case 35:if(void 0!==i){e.next=37;break}throw new Error("Unexpected end segment");case 37:return r=new xt(i,o,c,s,{header:a},r),e.next=41,r;case 41:return i=void 0,o=[],c=[],s=[],e.abrupt("break",47);case 46:throw new Error("Unknown segment type: ".concat(a.segmentType));case 47:a=void 0,n.requestedBytes=13,e.next=60;break;case 51:if(20551===(j=p.readHex(2))){e.next=54;break}throw new Error("Invalid magic number: ".concat(j));case 54:m=p.readHex(4),O=p.readHex(4),k=gt(p.readHex(1)),x=p.readHex(2),a={presentationTimestamp:m,decodingTimestamp:O,segmentType:k,segmentSize:x},n.requestedBytes=x;case 60:u=!1,e.next=9;break;case 63:e.next=69;break;case 65:e.prev=65,e.t1=e.catch(7),l=!0,b=e.t1;case 69:if(e.prev=69,e.prev=70,!u||null==f.return){e.next=74;break}return e.next=74,Object(st.a)(f.return());case 74:if(e.prev=74,!l){e.next=77;break}throw b;case 77:return e.finish(74);case 78:return e.finish(69);case 79:case"end":return e.stop()}}),e,null,[[7,65,69,79],[70,,74,78]])})))).apply(this,arguments)}function St(e,t){var n=e.index+t.segmentSize,a=e.readHex(2,n),i=e.readHex(2,n);return e.readHex(1),{header:t,width:a,height:i,compositionNumber:e.readHex(2,n),compositionState:function(e){var t,n=Object(r.a)(mt);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(e===a)return a}}catch(i){n.e(i)}finally{n.f()}throw new Error("Invalid composition state byte: ".concat(e))}(e.readHex(1,n)),paletteUpdateFlag:function(e){switch(e){case 0:return!1;case 128:return!0;default:throw new Error("Invalid palette update flag byte: ".concat(e))}}(e.readHex(1,n)),paletteId:e.readHex(1,n),compositionObjectCount:e.readHex(1,n),objectId:e.readHex(2,n),windowId:e.readHex(1,n),objectCroppedFlag:function(e){switch(e){case 0:return!1;case 64:return!0;default:throw new Error("Invalid object cropped flag byte: ".concat(e))}}(e.readHex(1,n)),objectHorizontalPosition:e.readHex(2,n),objectVerticalPosition:e.readHex(2,n),objectCroppingHorizontalPosition:e.readHex(2,n),objectCroppingVerticalPosition:e.readHex(2,n),objectCroppingWidth:e.readHex(2,n),objectCroppingHeightPosition:e.readHex(2,n)}}function Ct(e,t){for(var n=e.index+t.segmentSize,a=e.readHex(1,n),r=[],i=0;i<a;++i){var o=e.readHex(1,n),c=e.readHex(2,n),s=e.readHex(2,n),u=e.readHex(2,n),l=e.readHex(2,n);r.push({windowId:o,windowHorizontalPosition:c,windowVerticalPosition:s,windowWidth:u,windowHeight:l})}return{header:t,windowCount:a,windowDefinitions:r}}function Tt(e,t){for(var n=e.index+t.segmentSize,a=e.readHex(1,n),r=e.readHex(1,n),i=[];e.index<n;){var o=e.readHex(1,n),c=e.readHex(1,n),s=e.readHex(1,n),u=e.readHex(1,n),l=e.readHex(1,n);i.push({paletteEntryId:o,luminance:c,colorDifferenceRed:s,colorDifferenceBlue:u,transparency:l})}return{header:t,paletteId:a,paletteVersionNumber:r,paletteEntries:i}}function Ft(e,t){var n,a,i,o=e.readHex(2),c=e.readHex(1),s=function(e){var t,n=Object(r.a)(Ot);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(e===a)return a}}catch(i){n.e(i)}finally{n.f()}throw new Error("Invalid last in sequence flag byte: ".concat(e))}(e.readHex(1)),u=e.readHex(3);return s===jt.firstInSequence||s===jt.firstAndLastInSequence?(n=e.readHex(2),a=e.readHex(2),i=e.readBuffer(u-4)):i=e.readBuffer(u),{header:t,objectId:o,objectVersionNumber:c,lastInSequenceFlag:s,objectDataLength:u,width:n,height:a,objectData:i}}var Et=RegExp("</?([^>]*)>","ig"),Pt=RegExp(/\\[nN]/,"ig"),It=document.createElement("div"),Mt=document.createElement("canvas"),Rt=function(){function e(){Object(x.a)(this,e),this.xmlParser=void 0}return Object(y.a)(e,[{key:"subtitles",value:function(){var e=Object(c.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e,t){return n._subtitles(e,t)})));case 2:return e.abrupt("return",e.sent.flatMap((function(e){return e})).sort((function(e,t){return e.start-t.start})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_subtitles",value:function(){var e=Object(c.a)(d.a.mark((function e(t,n){var a,i,o,s,u,l,b,f,h,v,p,g,j,m,O,k,x,y,w,S,C,T,F,E=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.name.endsWith(".srt")){e.next=7;break}return e.t0=it.a,e.next=4,t.text();case 4:return e.t1=e.sent,a=(0,e.t0)(e.t1),e.abrupt("return",a.map((function(e){return{start:e.data.start,end:e.data.end,text:e.data.text.replace(Et,""),track:n}})));case 7:if(!t.name.endsWith(".vtt")&&!t.name.endsWith(".nfvtt")){e.next=9;break}return e.abrupt("return",new Promise(function(){var e=Object(c.a)(d.a.mark((function e(a,i){var o,c,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.name.endsWith(".nfvtt"),c=new ot.WebVTT.Parser(window,ot.WebVTT.StringDecoder()),s=[],c.oncue=function(e){if(o){e.text=e.text.replace(Et,"");var t,n=e.text.split("\n"),a=[],i=Object(r.a)(n);try{for(i.s();!(t=i.n()).done;){var c=t.value;a.push(E._fixRTL(c))}}catch(u){i.e(u)}finally{i.f()}e.text=a.join("\n")}s.push(e)},c.onflush=function(){return a(s.map((function(e){return{start:Math.floor(1e3*e.startTime),end:Math.floor(1e3*e.endTime),text:e.text,track:n}})))},e.t0=c,e.next=8,t.text();case 8:e.t1=e.sent,e.t0.parse.call(e.t0,e.t1),c.flush();case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 9:if(!t.name.endsWith(".ass")){e.next=17;break}return e.t2=rt.a,e.next=13,t.text();case 13:return e.t3=e.sent,e.t4={},i=(0,e.t2)(e.t3,e.t4),e.abrupt("return",i.dialogues.map((function(e){return{start:Math.round(1e3*e.start),end:Math.round(1e3*e.end),text:e.slices.flatMap((function(e){return e.fragments.map((function(e){return e.text}))})).join("").replace(Pt,"\n"),track:n}})));case 17:if(!t.name.endsWith(".ytxml")){e.next=37;break}return e.next=20,t.text();case 20:if(o=e.sent,s=this._xmlParser().parse(o),0!==Object.keys(s).length){e.next=24;break}return e.abrupt("return",[]);case 24:u=s.transcript.text,l=[],b=0,f=u.length;case 27:if(!(b<f)){e.next=36;break}if("#text"in(h=u[b])&&"@_dur"in h&&"@_start"in h){e.next=31;break}return e.abrupt("continue",33);case 31:v=parseFloat(h["@_start"]),l.push({start:Math.floor(1e3*v),end:Math.floor(1e3*(v+parseFloat(h["@_dur"]))),text:this._decodeHTML(String(h["#text"]).replace(Et,"")),track:n});case 33:b++,e.next=27;break;case 36:return e.abrupt("return",l);case 37:if(!t.name.endsWith(".sup")){e.next=68;break}g=[],m=!1,O=!1,e.prev=41,x=Object(at.a)(yt(t.stream()));case 43:return e.next=45,x.next();case 45:if(!(m=!(y=e.sent).done)){e.next=51;break}(w=y.value).objectDefinitionSegments.length>0?void 0===j&&(j=w):void 0!==j&&(C=j.presentationCompositionSegment.width,T=j.presentationCompositionSegment.height,p=void 0===p||p.length<T*C*4?new Uint8ClampedArray(C*T*4):p,F=j.imageData(p),Mt.width=F.width,Mt.height=F.height,Mt.getContext("2d").putImageData(F,0,0),g.push({start:null!==(S=j.objectDefinitionSegments[0].header.presentationTimestamp/90)&&void 0!==S?S:0,end:w.endDefinitionSegment.header.presentationTimestamp/90,text:"",textImage:{dataUrl:Mt.toDataURL("image/png"),image:{width:F.width,height:F.height},screen:{width:j.presentationCompositionSegment.width,height:j.presentationCompositionSegment.height}},track:n}),j=void 0);case 48:m=!1,e.next=43;break;case 51:e.next=57;break;case 53:e.prev=53,e.t5=e.catch(41),O=!0,k=e.t5;case 57:if(e.prev=57,e.prev=58,!m||null==x.return){e.next=62;break}return e.next=62,x.return();case 62:if(e.prev=62,!O){e.next=65;break}throw k;case 65:return e.finish(62);case 66:return e.finish(57);case 67:return e.abrupt("return",g);case 68:throw new Error("Unsupported subtitle file format");case 69:case"end":return e.stop()}}),e,this,[[41,53,57,67],[58,,62,66]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_fixRTL",value:function(e){var t=e.indexOf("&lrm;"),n=e.indexOf("&rlm;"),a="";return t>-1?(a=e.substring(0,t)+"\u202a"+e.substring(t+5)+"\u202c",this._fixRTL(a)):n>-1?(a=e.substring(0,n)+"\u202b"+e.substring(n+5)+"\u202c",this._fixRTL(a)):e}},{key:"_decodeHTML",value:function(e){return It.innerHTML=e,0===It.childNodes.length?"":It.childNodes[0].nodeValue}},{key:"_xmlParser",value:function(){return void 0===this.xmlParser&&(this.xmlParser=new ct.XMLParser({ignoreAttributes:!1})),this.xmlParser}}]),e}(),Dt=n(333),At=n(159),_t=n.n(At),Bt=n(158),Nt=n.n(Bt),Lt=n(160),Ht=n.n(Lt),Ut=n(157),Wt=n.n(Ut),qt=n(161),zt=n.n(qt),Vt=["show"],Gt=Object(p.a)((function(e){return{title:{flexGrow:1},leftButton:{marginRight:e.spacing(1)},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:function(e){var t=e.drawerWidth;return"calc(100% - ".concat(t,"px)")},transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:function(e){return e.drawerWidth}},copyHistoryButton:{transform:"scaleX(1)",width:48,padding:12,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},copyHistoryButtonShift:{transform:"scaleX(0)",width:0,padding:5,transition:e.transitions.create(["transform","padding","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},hide:{display:"none"}}})),Kt=Object(p.a)((function(e){return{tooltip:function(e){return{display:e.show?"block":"none"}}}}));function Xt(e){var t=e.show,n=Object(ce.a)(e,Vt),a=Kt({show:t});return Object(re.jsx)(Be.a,Object(o.a)({classes:a},n))}function Jt(e){var t,n=Gt(e);return Object(re.jsx)(Dt.a,{position:"static",elevation:0,className:Object(te.a)(n.appBar,(t={},Object(u.a)(t,n.appBarShift,e.drawerOpen),Object(u.a)(t,n.hide,e.hidden),t)),children:Object(re.jsxs)(_e.a,{children:[Object(re.jsx)(Be.a,{title:"Open Files",children:Object(re.jsx)(Ce.a,{edge:"start",color:"inherit",className:n.leftButton,onClick:e.onFileSelector,children:Object(re.jsx)(Wt.a,{})})}),Object(re.jsx)(Ne.a,{variant:"h6",className:n.title,children:e.title}),Object(re.jsx)(Be.a,{title:"Donate",children:Object(re.jsx)(Ce.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/sponsors/killergerbah?frequency=one-time",target:"_blank",rel:"noreferrer",children:Object(re.jsx)(Nt.a,{})})}),Object(re.jsx)(Be.a,{title:"Submit Issue",children:Object(re.jsx)(Ce.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/killergerbah/asbplayer/issues",target:"_blank",rel:"noreferrer",children:Object(re.jsx)(_t.a,{})})}),Object(re.jsx)(Be.a,{title:"Help",children:Object(re.jsx)(Ce.a,{edge:"end",color:"inherit",component:"a",href:"https://github.com/killergerbah/asbplayer#usage",target:"_blank",rel:"noreferrer",children:Object(re.jsx)(Ht.a,{})})}),Object(re.jsx)(Be.a,{title:"Settings",children:Object(re.jsx)(Ce.a,{edge:"end",color:"inherit",onClick:e.onOpenSettings,children:Object(re.jsx)(De.a,{})})}),Object(re.jsx)(Xt,{title:"Copy History",show:!e.drawerOpen,children:Object(re.jsx)(Ce.a,{edge:"end",color:"inherit","aria-label":"menu",className:Object(te.a)(n.copyHistoryButton,Object(u.a)({},n.copyHistoryButtonShift,e.drawerOpen)),onClick:e.onOpenCopyHistory,children:Object(re.jsx)(zt.a,{})})})]})})}var Yt=function(){function e(){var t=this;Object(x.a)(this,e),this.tabs=void 0,this.onMessageCallbacks=void 0,this.onTabsCallbacks=void 0,this.versionPromise=void 0,this.id=void 0,this.versionResolve=void 0,this.heartbeatStarted=!1,this.onMessageCallbacks=[],this.onTabsCallbacks=[],this.tabs=[],this.versionPromise=new Promise((function(e,n){t.versionResolve=e})),this.id=Object(ee.a)(),window.addEventListener("message",(function(e){if(e.source===window&&"asbplayer-extension-to-player"===e.data.sender&&e.data.message){if("tabs"===e.data.message.command){t.tabs=e.data.message.tabs;var n,a=Object(r.a)(t.onTabsCallbacks);try{for(a.s();!(n=a.n()).done;){(0,n.value)(t.tabs)}}catch(c){a.e(c)}finally{a.f()}return}if("version"===e.data.message.command)return void t.versionResolve(e.data.message.version);var i,o=Object(r.a)(t.onMessageCallbacks);try{for(o.s();!(i=o.n()).done;){(0,i.value)({data:e.data.message,tabId:e.data.tabId,src:e.data.src})}}catch(c){o.e(c)}finally{o.f()}}}))}return Object(y.a)(e,[{key:"startHeartbeat",value:function(){var e=this;this.heartbeatStarted||(this._sendHeartbeat(),setInterval((function(){return e._sendHeartbeat()}),1e3),this.heartbeatStarted=!0)}},{key:"_sendHeartbeat",value:function(){window.postMessage({sender:"asbplayerv2",message:{command:"heartbeat",id:this.id,receivedTabs:this.tabs}},"*")}},{key:"installedVersion",value:function(){var e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.versionPromise;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(e,t,n){var a={sender:"asbplayerv2",message:e,tabId:t,src:n};window.postMessage(a,"*")}},{key:"publishMessage",value:function(e){var t,n=Object(r.a)(this.tabs);try{for(n.s();!(t=n.n()).done;){var a=t.value,i={sender:"asbplayerv2",message:e,tabId:a.id,src:a.src};window.postMessage(i,"*")}}catch(o){n.e(o)}finally{n.f()}}},{key:"subscribeTabs",value:function(e){this.onTabsCallbacks.push(e)}},{key:"unsubscribeTabs",value:function(e){this._remove(e,this.onTabsCallbacks)}},{key:"subscribe",value:function(e){this.onMessageCallbacks.push(e)}},{key:"unsubscribe",value:function(e){this._remove(e,this.onMessageCallbacks)}},{key:"_remove",value:function(e,t){for(var n=t.length-1;n>=0;--n)if(e===t[n]){t.splice(n,1);break}}}]),e}();function Qt(e){var t=e.subtitleColor,n=e.subtitleSize,a=e.subtitleOutlineThickness,r=e.subtitleOutlineColor,i=e.subtitleBackgroundOpacity,o=e.subtitleBackgroundColor,c=e.subtitleFontFamily,s={color:t,fontSize:Number(n)};if(a>0){var u=a,l=r;s.textShadow="0 0 ".concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l,", 0 0 ").concat(u,"px ").concat(l)}if(i>0){var d=i,b=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}}(o),f=b.r,h=b.g,v=b.b;s.backgroundColor="rgba(".concat(f,", ").concat(h,", ").concat(v,", ").concat(d,")")}return c&&c.length>0&&(s.fontFamily=c),s}function $t(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e<0)return $t(0,t);var a=(e=Math.round(e))%1e3,r=(e=(e-a)/1e3)%60,i=(e=(e-r)/60)%60;if(t>=36e5){var o=(e-i)/60;return n?Zt(o)+":"+Zt(i)+":"+Zt(r)+"."+en(a):Zt(o)+":"+Zt(i)+":"+Zt(r)}return n?Zt(i)+":"+Zt(r)+"."+en(a):Zt(i)+":"+Zt(r)}function Zt(e){return String(e).padStart(2,"0")}function en(e){return String(e).padEnd(3,"0")}var tn=n(337),nn=n(356),an=n(164),rn=n.n(an),on=n(323),cn=n(273),sn=n(336),un=n(334),ln=n(335),dn=n(321),bn=n(163),fn=n.n(bn),hn=n(162),vn=n.n(hn),pn=Object(p.a)((function(e){return{drawer:{width:function(e){return e.drawerWidth},flexShrink:0},drawerPaper:{width:function(e){return e.drawerWidth}},drawerHeader:Object(o.a)(Object(o.a)({display:"flex",alignItems:"center",position:"static",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"}),listContainer:{position:"relative",height:"100%",overflowY:"auto",overflowX:"hidden"},listItem:{"&:hover":{backgroundColor:e.palette.action.hover}},listItemGutters:{paddingLeft:5,paddingRight:5},listItemIconRoot:{minWidth:20},emptyState:{display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",height:"100%",padding:15},text:{flexGrow:1},emptyText:{flexGrow:1,color:e.palette.text.secondary},timestamp:{paddingRight:15,paddingLeft:15,color:e.palette.text.secondary}}}));function gn(e){var t=e.open,n=e.anchorEl,a=e.onClose,r=e.onSelect,i=e.onClipAudio,o=e.onDownloadImage,c=e.onDelete,s=e.item,u=Object(b.useCallback)((function(){navigator.clipboard.writeText(s.text),a()}),[s,a]),l=Object(b.useCallback)((function(){r(s),a()}),[s,r,a]),d=Object(b.useCallback)((function(){i(s),a()}),[s,i,a]),f=Object(b.useCallback)((function(){o(s),a()}),[s,o,a]),h=Object(b.useCallback)((function(){c(s),a()}),[s,c,a]);return s?Object(re.jsx)(dn.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:a,anchorOrigin:{vertical:"center",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"},children:Object(re.jsxs)(on.a,{children:[Object(re.jsx)(cn.a,{button:!0,onClick:u,children:Object(re.jsx)(un.a,{primaryTypographyProps:{variant:"body2"},primary:"Copy"})}),Object(re.jsx)(cn.a,{button:!0,onClick:l,children:Object(re.jsx)(un.a,{primaryTypographyProps:{variant:"body2"},primary:"Jump To"})}),(s.videoFile||s.audioFile||s.audio)&&Object(re.jsx)(cn.a,{button:!0,onClick:d,children:Object(re.jsx)(un.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Audio"})}),(s.videoFile||s.image)&&Object(re.jsx)(cn.a,{button:!0,onClick:f,children:Object(re.jsx)(un.a,{primaryTypographyProps:{variant:"body2"},primary:"Download Image"})}),Object(re.jsx)(cn.a,{button:!0,onClick:h,children:Object(re.jsx)(un.a,{primaryTypographyProps:{variant:"body2"},primary:"Delete"})})]})}):null}function jn(e){var t,n=e.onDelete,a=pn(e),i=Object(b.useCallback)((function(e){e&&e.scrollIntoView()}),[]),o=Object(b.useState)(),c=Object(s.a)(o,2),u=c[0],l=c[1],d=Object(b.useState)(!1),h=Object(s.a)(d,2),v=h[0],p=h[1],g=Object(b.useState)(),j=Object(s.a)(g,2),m=j[0],O=j[1],k=Object(b.useCallback)((function(e,t){l(t),p(!0),O(e.currentTarget)}),[]),x=Object(b.useCallback)((function(){l(void 0),p(!1),O(void 0)}),[]),y=Object(b.useCallback)((function(e){n(e)}),[n]);if(e.items.length>0){var w,S=[],C=null,T=0,F={},E=Object(r.a)(e.items);try{var P=function(){var t=w.value;null!==C&&C===t.name||(t.name in F?F[t.name]++:F[t.name]=0,C=t.name,S.push(Object(re.jsx)(ln.a,{disableSticky:!0,children:t.name},t.name+"-"+F[t.name])));var n=T===e.items.length-1?i:null;S.push(Object(re.jsxs)(cn.a,{ref:n,className:a.listItem,classes:{gutters:a.listItemGutters},children:[Object(re.jsx)(sn.a,{classes:{root:a.listItemIconRoot},children:Object(re.jsx)(Be.a,{title:"Export to Anki",children:Object(re.jsx)(Ce.a,{onClick:function(){return e.onAnki(t)},children:Object(re.jsx)(vn.a,{fontSize:"small"})})})}),Object(re.jsx)(sn.a,{classes:{root:a.listItemIconRoot},children:Object(re.jsx)(Ce.a,{onClick:function(e){return k(e,t)},children:Object(re.jsx)(fn.a,{fontSize:"small"})})}),Object(re.jsx)(un.a,{primary:Object(re.jsxs)(Se.a,{wrap:"nowrap",container:!0,children:[Object(re.jsx)(Se.a,{item:!0,className:""===t.text?a.emptyText:a.text,children:""===t.text?"No text":t.text}),Object(re.jsx)(Se.a,{item:!0,className:a.timestamp,children:$t(t.start,t.start,!1)})]})})]},t.id)),++T};for(E.s();!(w=E.n()).done;)P()}catch(I){E.e(I)}finally{E.f()}t=Object(re.jsx)("div",{className:a.listContainer,children:Object(re.jsx)(on.a,{children:S})})}else t=Object(re.jsxs)("div",{className:a.emptyState,children:[Object(re.jsx)(Ne.a,{variant:"h6",children:"Copy history is empty."}),Object(re.jsx)(Ne.a,{variant:"caption",children:"See the help for keyboard shortcuts."})]});return Object(re.jsxs)(f.a.Fragment,{children:[Object(re.jsxs)(nn.a,{variant:"persistent",anchor:"right",open:e.open,className:a.drawer,classes:{paper:a.drawerPaper},children:[Object(re.jsx)("div",{className:a.drawerHeader,children:Object(re.jsx)(Ce.a,{onClick:e.onClose,children:Object(re.jsx)(rn.a,{})})}),Object(re.jsx)(tn.a,{}),t]}),Object(re.jsx)(gn,{open:e.open&&v,anchorEl:m,item:u,onClose:x,onSelect:e.onSelect,onClipAudio:e.onClipAudio,onDownloadImage:e.onDownloadImage,onDelete:y})]})}var mn=n(165),On=n.n(mn),kn=n(338),xn=Object(de.a)((function(e){return{background:function(e){return{position:"absolute",height:e.appBarHidden?"100vh":"calc(100vh - 64px)",width:"100%",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"}},browseLink:{cursor:"pointer"}}}));function yn(e){var t=e.extension,n=e.latestExtensionVersion,a=e.extensionUrl,r=e.loading,i=e.dragging,o=e.appBarHidden,u=e.onFileSelector,l=xn({appBarHidden:o}),h=Object(b.useState)(),v=Object(s.a)(h,2),p=v[0],g=v[1];Object(b.useEffect)((function(){function e(){return(e=Object(c.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=g,e.next=3,t.installedVersion();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]);var j=p&&On()(n,p),m=!p;return Object(re.jsx)(f.a.Fragment,{children:Object(re.jsx)($e.a,{in:!r&&!i,timeout:500,children:Object(re.jsx)("div",{className:l.background,children:Object(re.jsxs)(Ne.a,{variant:"h6",children:["Drag and drop subtitle and media files, or"," ",Object(re.jsx)(kn.a,{target:"#",className:l.browseLink,onClick:u,color:"secondary",component:"label",children:"browse"}),".",Object(re.jsx)("br",{}),m&&Object(re.jsxs)("span",{children:["Install the"," ",Object(re.jsx)(kn.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:a,children:"Chrome extension"})," ","to sync subtitles with streaming video."]}),j&&Object(re.jsxs)("span",{children:["An extension"," ",Object(re.jsx)(kn.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:a,children:"update"})," ","is available."]})]})})})})}var wn=function(){function e(t){Object(x.a)(this,e),this.channel=void 0,this.onMessage=void 0,this.channel=new BroadcastChannel(t);var n=this;this.channel.onmessage=function(e){var t;null===(t=n.onMessage)||void 0===t||t.call(n,e)}}return Object(y.a)(e,[{key:"postMessage",value:function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage(e)}},{key:"close",value:function(){var e;null===(e=this.channel)||void 0===e||e.close(),this.channel=void 0}}]),e}(),Sn=function(){function e(t,n,a){var r=this;Object(x.a)(this,e),this.tabId=void 0,this.src=void 0,this.extension=void 0,this.listener=void 0,this.onMessage=void 0,this.tabId=t,this.src=n,this.listener=function(e){var a;e.tabId!==t||e.src&&e.src!==n||(null===(a=r.onMessage)||void 0===a||a.call(r,{data:e.data}))},a.subscribe(this.listener),this.extension=a}return Object(y.a)(e,[{key:"postMessage",value:function(e){this.extension.sendMessage(e,this.tabId,this.src)}},{key:"close",value:function(){this.extension.unsubscribe(this.listener)}}]),e}(),Cn=function(){function e(){Object(x.a)(this,e),this.accumulated=void 0,this.started=void 0,this.startTime=void 0,this.accumulated=0,this.started=!1}return Object(y.a)(e,[{key:"time",value:function(e){return this.started?Math.min(e,this.accumulated+Date.now()-this.startTime):Math.min(e,this.accumulated)}},{key:"stop",value:function(){this.started&&(this.started=!1,this.accumulated+=Date.now()-this.startTime)}},{key:"start",value:function(){this.startTime=Date.now(),this.started=!0}},{key:"setTime",value:function(e){this.started?(this.startTime=Date.now(),this.accumulated=e):this.accumulated=e}},{key:"progress",value:function(e){return 0===e?0:Math.min(1,this.time(e)/e)}}]),e}(),Tn=n(168),Fn=n.n(Tn),En=n(169),Pn=n.n(En),In=n(175),Mn=n.n(In),Rn=n(166),Dn=n.n(Rn),An=n(266),_n=n(178),Bn=n.n(_n),Nn=n(180),Ln=n.n(Nn),Hn=n(167),Un=n.n(Hn),Wn=n(179),qn=n.n(Wn),zn=n(170),Vn=n.n(zn),Gn=n(171),Kn=n.n(Gn),Xn=n(176),Jn=n.n(Xn),Yn=n(177),Qn=n.n(Yn),$n=n(174),Zn=n.n($n),ea=n(105),ta=n.n(ea),na=n(172),aa=n.n(na),ra=n(173),ia=n.n(ra),oa=Object(p.a)((function(e){return{container:{position:"absolute",left:"50%",width:"50%",bottom:0,pointerEvents:"none",color:"#fff"},buttonContainer:{flexDirection:"row"},timeDisplay:{color:"#fff",display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",cursor:"default",fontSize:20,marginLeft:10},offsetInput:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",fontSize:20,marginLeft:10,width:100,color:"#fff",pointerEvents:"auto"},volumeInputContainerShown:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:5,pointerEvents:"auto"},volumeInputContainerHidden:{transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),marginRight:0,pointerEvents:"auto"},volumeInputHidden:{transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),width:0,pointerEvents:"auto"},volumeInputShown:{transition:e.transitions.create("width",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),width:100,pointerEvents:"auto"},volumeInputThumbHidden:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.short}),opacity:0,pointerEvents:"auto"},volumeInputThumbShown:{transition:e.transitions.create("visibility",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.short}),opacity:1,pointerEvents:"auto"},subContainer:{background:"linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, .4) 40%, rgba(0, 0, 0, 0.7))",position:"relative",left:"-100%",width:"200%",zIndex:10},button:{pointerEvents:"auto"},inactiveButton:{color:"rgba(72, 72, 72, 0.7)",pointerEvents:"auto"},inactiveTopButton:{color:"rgba(255, 255, 255, 0.5)",pointerEvents:"auto"},progress:{margin:5},topButton:{pointerEvents:"auto",color:"#fff"},gridContainer:{pointerEvents:"auto",padding:2}}})),ca=Object(p.a)((function(e){return{root:{height:10},container:{height:10,pointerEvents:"auto",display:"flex",justifyContent:"center",flexDirection:"column",position:"absolute",width:"calc(100% - 20px)",marginLeft:10},mouseEventListener:{zIndex:1,height:10,cursor:"pointer",pointerEvents:"auto",position:"absolute",width:"100%"},fillContainer:{background:"rgba(30,30,30,0.7)",width:"100%",height:5,position:"relative"},fillContainerThick:{transition:e.transitions.create("height",{easing:e.transitions.easing.easeInOut,duration:50}),height:8},fill:{background:"linear-gradient(to left, #ff1f62, #49007a)",height:"100%"},handleContainer:{position:"absolute",display:"flex",justifyContent:"center",flexDirection:"column",height:"100%",bottom:0},handle:{borderRadius:"50%",width:16,height:16,opacity:0,left:-8,background:"white",position:"absolute"},handleOn:{opacity:1,transition:e.transitions.create("opacity",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.shortest})}}})),sa=Object(ge.a)((function(e){return{root:{color:"white",verticalAlign:"middle"},thumb:{backgroundColor:"white",color:"white","&:focus":{boxShadow:"inherit"},"&:hover, &$active":{boxShadow:"0px 0px 0px 8px rgba(255, 255, 255, 0.1)"}},active:{color:"white"}}}))(Ae.a);function ua(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return String(n)+":"+String(a).padStart(2,"0")}function la(e){var t=e.onSeek,n=e.value,a=ca(),r=Object(b.useState)(!1),i=Object(s.a)(r,2),o=i[0],c=i[1],u=Object(b.useRef)(null),l=Object(b.useCallback)((function(e){var n=e.currentTarget.getBoundingClientRect(),a=n.right-n.left-20,r=Math.min(1,Math.max(0,(e.pageX-n.left-10)/a));t(r)}),[t]),d=Object(b.useCallback)((function(){return c(!0)}),[]),f=Object(b.useCallback)((function(){return c(!1)}),[]),h=u.current?function(e){var t=e.getBoundingClientRect();return t.right-t.left}(u.current)*n/100:0,v={width:h},p={marginLeft:h},g=o?a.fillContainer+" "+a.fillContainerThick:a.fillContainer,j=o?a.handle+" "+a.handleOn:a.handle;return Object(re.jsxs)("div",{className:a.root,children:[Object(re.jsx)("div",{ref:u,className:a.container,children:Object(re.jsxs)("div",{className:g,children:[Object(re.jsx)("div",{className:a.fill,style:v}),Object(re.jsx)("div",{className:a.handleContainer,children:Object(re.jsx)("div",{className:j,style:p})})]})}),Object(re.jsx)("div",{className:a.mouseEventListener,onClick:l,onMouseOver:d,onMouseOut:f})]})}function da(e){var t=e.open,n=e.anchorEl,a=e.audioTracks,r=e.selectedAudioTrack,i=e.onAudioTrackSelected,o=e.onClose;if(!a||0===a.length)return null;var c=a.map((function(e){return Object(re.jsxs)(cn.a,{selected:e.id===r,button:!0,onClick:function(){return i(e.id)},children:[e.language," ",e.label]},e.id)}));return Object(re.jsx)("div",{children:Object(re.jsx)(dn.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:o,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(re.jsx)(on.a,{children:c})})})}function ba(e){var t=e.open,n=e.anchorEl,a=e.onClose,r=e.tabs,i=e.selectedTab,o=e.onTabSelected;if(!r||0===r.length)return null;var c=r.map((function(e){return Object(re.jsxs)(cn.a,{selected:i&&e.id===i.id&&e.src===i.src,button:!0,onClick:function(){return o(e)},children:[e.id," ",e.title," ",e.src]},e.id)}));return Object(re.jsx)("div",{children:Object(re.jsx)(dn.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:a,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(re.jsx)(on.a,{children:c})})})}function fa(e){var t=e.open,n=e.anchorEl,a=e.onUnload,r=e.onClose,i=e.file;return Object(re.jsx)("div",{children:Object(re.jsx)(dn.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:r,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(re.jsx)(on.a,{children:Object(re.jsxs)(cn.a,{button:!0,onClick:function(e){return a()},children:["Unload ",i]})})})})}function ha(e){var t=e.open,n=e.anchorEl,a=e.selectedPlayMode,r=e.onPlayMode,i=e.onClose;return Object(re.jsx)("div",{children:Object(re.jsx)(dn.a,{disableEnforceFocus:!0,open:t,anchorEl:n,onClose:i,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:Object(re.jsxs)(on.a,{children:[Object(re.jsx)(cn.a,{selected:a===M.normal,button:!0,onClick:function(e){return r(M.normal)},children:"Normal"}),Object(re.jsx)(cn.a,{selected:a===M.condensed,button:!0,onClick:function(e){return r(M.condensed)},children:"Condensed"}),Object(re.jsx)(cn.a,{selected:a===M.autoPause,button:!0,onClick:function(e){return r(M.autoPause)},children:"Auto-pause"})]})})})}function va(e){var t=e.clock,n=e.playing,a=e.length,r=e.offsetEnabled,i=e.displayLength,o=e.offset,c=e.onAudioTrackSelected,u=e.onSeek,l=e.mousePositionRef,d=e.onShow,h=e.onPause,v=e.onPlay,p=e.onTabSelected,g=e.onUnloadAudio,j=e.onUnloadVideo,m=e.onOffsetChange,O=e.onVolumeChange,k=e.disableKeyEvents,x=e.settingsProvider,y=e.closeEnabled,w=e.onClose,S=e.volumeEnabled,C=e.playMode,T=e.playModeEnabled,F=e.onPlayMode,E=e.subtitlesEnabled,P=e.subtitlesToggle,I=e.onSubtitlesToggle,M=e.videoFile,R=e.audioFile,D=e.audioTracks,A=e.selectedAudioTrack,_=e.tabs,B=e.selectedTab,N=e.popOutEnabled,L=e.popOut,H=e.onPopOutToggle,U=e.fullscreenEnabled,W=e.fullscreen,q=e.onFullscreenToggle,z=e.hideSubtitlePlayerToggleEnabled,V=e.subtitlePlayerHidden,G=e.onHideSubtitlePlayerToggle,K=e.showOnMouseMovement,X=e.theaterModeToggleEnabled,J=e.theaterModeEnabled,Y=e.onTheaterModeToggle,Q=oa(),$=Object(b.useState)(!0),Z=Object(s.a)($,2),ee=Z[0],te=Z[1],ne=Object(b.useState)(!1),ae=Object(s.a)(ne,2),ie=ae[0],oe=ae[1],ce=Object(b.useState)(),se=Object(s.a)(ce,2),ue=se[0],le=se[1],de=Object(b.useState)(!1),be=Object(s.a)(de,2),fe=be[0],he=be[1],ve=Object(b.useState)(),pe=Object(s.a)(ve,2),ge=pe[0],je=pe[1],me=Object(b.useState)(!1),Oe=Object(s.a)(me,2),ke=Oe[0],xe=Oe[1],ye=Object(b.useState)(),we=Object(s.a)(ye,2),Te=we[0],Fe=we[1],Ee=Object(b.useState)(!1),Pe=Object(s.a)(Ee,2),Ie=Pe[0],Me=Pe[1],Re=Object(b.useState)(),De=Object(s.a)(Re,2),Ae=De[0],_e=De[1],Be=Object(b.useState)(!1),Ne=Object(s.a)(Be,2),Le=Ne[0],He=Ne[1],Ue=Object(b.useState)(),We=Object(s.a)(Ue,2),qe=We[0],ze=We[1],Ve=Object(b.useState)(!1),Ge=Object(s.a)(Ve,2),Ke=Ge[0],Xe=Ge[1],Je=Object(b.useState)(100),Ye=Object(s.a)(Je,2),Qe=Ye[0],Ze=Ye[1],et=Object(b.useState)(100),tt=Object(s.a)(et,2),nt=tt[0],at=tt[1],rt=Object(b.useRef)({x:0,y:0}),it=Object(b.useRef)(Date.now()),ot=Object(b.useRef)(Date.now()),ct=Object(b.useRef)(!0),st=Object(b.useRef)(!1),ut=Object(b.useRef)(),lt=Object(b.useRef)(null),dt=Object(b.useRef)(null),bt=Object(b.useState)(),ft=Object(s.a)(bt,2)[1],ht=Object(b.useCallback)((function(){return ft({})}),[]),vt=Object(b.useCallback)((function(e){u(e)}),[u]);function pt(){st.current=!0}function gt(){st.current=!1}Object(b.useEffect)((function(){var e=Number(x.volume);Ze(e),O(e/100),e>0&&at(e)}),[x,O]),Object(b.useEffect)((function(){var e=setInterval((function(){var e,t;K?e=Date.now()-it.current<2e3||Math.pow(l.current.x-rt.current.x,2)+Math.pow(l.current.y-rt.current.y,2)>100:e=null!==(t=lt.current&&l.current.y>lt.current.offsetTop-20||dt.current&&l.current.y<dt.current.offsetHeight+20)&&void 0!==t&&t;(e=e||st.current||ut.current===document.activeElement||Date.now()-ot.current<2e3)&&!ct.current?(it.current=Date.now(),te(e)):!e&&ct.current&&te(e),ct.current=e,rt.current.x=l.current.x,rt.current.y=l.current.y}),100);return function(){return clearInterval(e)}}),[l,K]),Object(b.useEffect)((function(){return null===d||void 0===d?void 0:d(ee)}),[d,ee]),Object(b.useEffect)((function(){if(!k)return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)};function e(e){if("Enter"===e.key&&ut.current===document.activeElement){var t=Number(ut.current.value);if(Number.isNaN(t))return;m(1e3*t),ut.current.blur()}}}),[m,k]);var jt=Object(b.useCallback)((function(e){var t,n=e.target;n.setSelectionRange(0,(null===(t=n.value)||void 0===t?void 0:t.length)||0)}),[]);Object(b.useEffect)((function(){var e=setInterval((function(){ht()}),100);return function(){return clearInterval(e)}}),[ht]),Object(b.useEffect)((function(){if(ut.current)if(0===o)ut.current.value="";else{var e=o/1e3,t=e>=0?"+"+e.toFixed(2):String(e.toFixed(2));ut.current.value=t,ot.current=Date.now()}}),[o]);var mt=Object(b.useCallback)((function(){le(void 0),oe(!1)}),[]),Ot=Object(b.useCallback)((function(e){le(e.currentTarget),oe(!0)}),[]),kt=Object(b.useCallback)((function(e){c(e),le(void 0),oe(!1)}),[c]),xt=Object(b.useCallback)((function(){je(void 0),he(!1)}),[]),yt=Object(b.useCallback)((function(e){je(e.currentTarget),he(!0)}),[]),wt=Object(b.useCallback)((function(e){null===p||void 0===p||p(e),je(void 0),he(!1)}),[p]),St=Object(b.useCallback)((function(){Fe(void 0),xe(!1)}),[]),Ct=Object(b.useCallback)((function(e){Fe(e.currentTarget),xe(!0)}),[]),Tt=Object(b.useCallback)((function(){null===g||void 0===g||g(),xe(!1)}),[g]),Ft=Object(b.useCallback)((function(){_e(void 0),Me(!1)}),[]),Et=Object(b.useCallback)((function(e){_e(e.currentTarget),Me(!0)}),[]),Pt=Object(b.useCallback)((function(){null===j||void 0===j||j(),Me(!1)}),[j]),It=Object(b.useCallback)((function(){ze(void 0),He(!1)}),[]),Mt=Object(b.useCallback)((function(e){ze(e.currentTarget),He(!0)}),[]),Rt=Object(b.useCallback)((function(e){null===F||void 0===F||F(e),ze(void 0),He(!1)}),[F]),Dt=Object(b.useCallback)((function(){return Xe(!1)}),[]),At=Object(b.useCallback)((function(){return Xe(!0)}),[]),_t=Object(b.useCallback)((function(e,t){"number"===typeof t&&(Ze(t),O(t/100))}),[O]),Bt=Object(b.useCallback)((function(e,t){"number"===typeof t&&(t>0&&at(t),x.volume=t)}),[x]),Nt=Object(b.useCallback)((function(){Ze((function(e){var t=e>0?0:nt;return O(t/100),t}))}),[O,nt]),Lt=t.progress(a);return Object(re.jsxs)(f.a.Fragment,{children:[Object(re.jsx)($e.a,{in:ee,timeout:200,children:Object(re.jsxs)(Se.a,{container:!0,style:{position:"absolute",top:0},children:[Object(re.jsx)(Se.a,{item:!0,style:{flexGrow:1},children:y&&Object(re.jsx)(Ce.a,{ref:dt,color:"inherit",className:Q.topButton,onClick:w,onMouseOver:pt,onMouseOut:gt,children:Object(re.jsx)(Dn.a,{})})}),Object(re.jsxs)(Se.a,{item:!0,children:[X&&Object(re.jsx)(Ce.a,{color:"inherit",className:J?Q.topButton:Q.inactiveTopButton,onClick:Y,onMouseOver:pt,onMouseOut:gt,children:Object(re.jsx)(Un.a,{})}),z&&Object(re.jsx)(Ce.a,{color:"inherit",className:Q.topButton,onClick:G,onMouseOver:pt,onMouseOut:gt,children:V?Object(re.jsx)(Fn.a,{}):Object(re.jsx)(Pn.a,{})})]})]})}),Object(re.jsxs)("div",{ref:lt,className:Q.container,onMouseOver:pt,onMouseOut:gt,children:[Object(re.jsx)($e.a,{in:ee,timeout:200,children:Object(re.jsxs)("div",{className:Q.subContainer,children:[Object(re.jsx)(la,{onSeek:vt,value:100*Lt}),Object(re.jsxs)(Se.a,{container:!0,className:Q.gridContainer,direction:"row",children:[Object(re.jsx)(Se.a,{item:!0,children:Object(re.jsx)(Ce.a,{color:"inherit",onClick:function(){return n?h():v()},children:n?Object(re.jsx)(Vn.a,{className:Q.button}):Object(re.jsx)(Kn.a,{className:Q.button})})}),S&&Object(re.jsxs)(Se.a,{item:!0,onMouseOver:At,onMouseOut:Dt,className:Ke?Q.volumeInputContainerShown:Q.volumeInputContainerHidden,children:[Object(re.jsx)(Ce.a,{color:"inherit",onClick:Nt,children:0===Qe?Object(re.jsx)(aa.a,{}):Object(re.jsx)(ia.a,{})}),Object(re.jsx)(sa,{onChange:_t,onChangeCommitted:Bt,value:Qe,defaultValue:100,classes:{root:Ke?Q.volumeInputShown:Q.volumeInputHidden,thumb:Ke?Q.volumeInputThumbShown:Q.volumeInputThumbHidden}})]}),Object(re.jsx)(Se.a,{item:!0,children:Object(re.jsxs)("div",{className:Q.timeDisplay,children:[ua(Lt*a)," / ",ua(i||a)]})}),r&&Object(re.jsx)(Se.a,{item:!0,children:Object(re.jsx)(An.a,{inputRef:ut,disableUnderline:!0,className:Q.offsetInput,placeholder:"\xb1"+Number(0).toFixed(2),onClick:jt})}),Object(re.jsx)(Se.a,{item:!0,style:{flexGrow:1}}),P&&Object(re.jsx)(Se.a,{item:!0,children:Object(re.jsx)(Ce.a,{color:"inherit",onClick:I,children:Object(re.jsx)(Zn.a,{className:E?Q.button:Q.inactiveButton})})}),M&&Object(re.jsx)(Se.a,{item:!0,children:Object(re.jsx)(Ce.a,{color:"inherit",onClick:Et,children:Object(re.jsx)(ta.a,{className:Q.button})})}),R&&Object(re.jsx)(Se.a,{item:!0,children:Object(re.jsx)(Ce.a,{color:"inherit",onClick:Ct,children:Object(re.jsx)(Mn.a,{className:Q.button})})}),D&&D.length>1&&Object(re.jsx)(Se.a,{item:!0,children:Object(re.jsx)(Ce.a,{color:"inherit",onClick:Ot,children:Object(re.jsx)(Jn.a,{className:Q.button})})}),_&&_.length>0&&Object(re.jsx)(Se.a,{item:!0,children:Object(re.jsx)(Ce.a,{color:"inherit",onClick:yt,children:Object(re.jsx)(ta.a,{className:B?Q.button:Q.inactiveButton})})}),T&&Object(re.jsx)(Se.a,{item:!0,children:Object(re.jsx)(Ce.a,{color:"inherit",onClick:Mt,children:Object(re.jsx)(Qn.a,{className:T?Q.button:Q.inactiveButton})})}),N&&Object(re.jsx)(Se.a,{item:!0,children:Object(re.jsx)(Ce.a,{color:"inherit",onClick:H,children:Object(re.jsx)(Bn.a,{className:Q.button,style:L?{transform:"rotateX(180deg)"}:{}})})}),U&&Object(re.jsx)(Se.a,{item:!0,children:Object(re.jsx)(Ce.a,{color:"inherit",onClick:q,children:W?Object(re.jsx)(qn.a,{className:Q.button}):Object(re.jsx)(Ln.a,{className:Q.button})})})]})]})}),Object(re.jsx)(ba,{open:fe&&ee,anchorEl:ge,tabs:_,selectedTab:B,onClose:xt,onTabSelected:wt}),Object(re.jsx)(da,{open:ie&&ee,anchorEl:ue,audioTracks:D,selectedAudioTrack:A,onClose:mt,onAudioTrackSelected:kt}),Object(re.jsx)(fa,{open:ke,anchorEl:Te,file:R,onClose:St,onUnload:Tt}),Object(re.jsx)(fa,{open:Ie,anchorEl:Ae,file:M,onClose:Ft,onUnload:Pt}),Object(re.jsx)(ha,{open:Le&&ee,anchorEl:qe,selectedPlayMode:C,onClose:It,onPlayMode:Rt})]})]})}var pa=function(){function e(t){Object(x.a)(this,e),this.ref=void 0,this.readyResolves=void 0,this.ref=t,this.readyResolves=[]}return Object(y.a)(e,[{key:"seek",value:function(){var e=Object(c.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){n.ref.current?(n.ref.current.currentTime=t,n._onMediaCanPlay((function(){return e(void 0)}))):e(void 0)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onReady",value:function(){var e=Object(c.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.ref.current?t._onMediaCanPlay((function(){return e(void 0)})):e(void 0)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_onMediaCanPlay",value:function(e){var t,n=this;4!==(null===(t=this.ref.current)||void 0===t?void 0:t.readyState)?(this.ref.current&&!this.ref.current.oncanplay&&(this.ref.current.oncanplay=function(e){var t,a=Object(r.a)(n.readyResolves);try{for(a.s();!(t=a.n()).done;){(0,t.value)()}}catch(i){a.e(i)}finally{a.f()}n.readyResolves.length=0,n.ref.current&&(n.ref.current.oncanplay=null)}),this.readyResolves.push(e)):e()}},{key:"play",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.play()}},{key:"pause",value:function(){var e;null===(e=this.ref.current)||void 0===e||e.pause()}}]),e}(),ga=n(342),ja=n(343),ma=n(340),Oa=n(341),ka=n(339),xa=["index","selected","subtitleRef","onClickSubtitle","onCopySubtitle","compressed","disabled","subtitle"],ya=Object(p.a)((function(e){return{container:{height:function(e){return e.appBarHidden?"100vh":"calc(100vh - 64px)"},position:"relative",overflowX:"hidden",backgroundColor:e.palette.background.default,width:function(e){var t=e.compressed,n=e.windowWidth;return t?Math.max(350,.25*n):"100%"}},table:{backgroundColor:e.palette.background.default,marginBottom:75},noSubtitles:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:15,textAlign:"center"}}})),wa=Object(p.a)((function(e){return{subtitleRow:{"&:hover":{backgroundColor:e.palette.action.hover}},subtitle:{fontSize:20,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere",whiteSpace:"pre-wrap"},compressedSubtitle:{fontSize:16,paddingRight:0,minWidth:200,width:"100%",overflowWrap:"anywhere",whiteSpace:"pre-wrap"},disabledSubtitle:{color:"transparent",backgroundColor:e.palette.action.disabledBackground,borderRadius:5},timestamp:{fontSize:14,color:"#aaaaaa",textAlign:"right",paddingRight:15,paddingLeft:5},copyButton:{textAlign:"right",padding:0}}})),Sa=f.a.memo((function(e){var t=e.index,n=e.selected,a=e.subtitleRef,r=e.onClickSubtitle,i=e.onCopySubtitle,c=e.compressed,u=e.disabled,l=e.subtitle,d=Object(ce.a)(e,xa),f=wa(),h=Object(b.useRef)(null),v=Object(b.useState)(!1),p=Object(s.a)(v,2),g=p[0],j=p[1],m=c?f.compressedSubtitle:f.subtitle,O=u?f.disabledSubtitle:"";if(l.start<0||l.end<0)return null;var k=l.textImage?Object(re.jsx)(Ue,{availableWidth:window.screen.availWidth/2,subtitle:l,scale:1}):Object(re.jsx)("span",{ref:h,className:O,children:l.text});return Object(re.jsxs)(ka.a,Object(o.a)(Object(o.a)({onClick:function(){return!g&&r(t)},onMouseUp:function(){var e,t,n,a=document.getSelection(),r="Range"===(null===a||void 0===a?void 0:a.type)&&(null===(e=h.current)||void 0===e?void 0:e.isSameNode(null!==(t=null===(n=a.anchorNode)||void 0===n?void 0:n.parentNode)&&void 0!==t?t:null));j(null!==r&&void 0!==r&&r)},ref:a,className:f.subtitleRow,selected:n},d),{},{children:[Object(re.jsx)(ma.a,{className:m,children:k}),Object(re.jsx)(ma.a,{className:f.copyButton,children:Object(re.jsx)(Ce.a,{onClick:function(e){return i(e,t)},children:Object(re.jsx)(Oe.a,{fontSize:c?"small":"medium"})})}),Object(re.jsx)(ma.a,{className:f.timestamp,children:l.displayTime})]}))}));function Ca(e){var t=e.clock,n=e.onSeek,a=e.onCopy,o=e.onOffsetChange,c=e.onToggleSubtitleTrack,u=e.onStartedShowing,l=e.onWillStopShowing,d=e.playing,f=e.subtitles,h=e.length,v=e.jumpToSubtitle,p=e.compressed,g=e.loading,j=e.drawerOpen,O=e.appBarHidden,k=e.displayHelp,x=e.disableKeyEvents,y=e.lastJumpToTopTimestamp,w=e.hidden,S=e.disabledSubtitleTracks,C=e.settingsProvider,F=Object(b.useRef)();F.current=d;var E=Object(b.useRef)(t);E.current=t;var I=Object(b.useRef)();I.current=f;var M=Object(b.useMemo)((function(){return f?Array(f.length).fill(void 0).map((function(e){return Object(b.createRef)()})):[]}),[f]),R=Object(b.useRef)([]);R.current=M;var D=Object(b.useRef)();D.current=x;var A=Object(b.useState)({}),_=Object(s.a)(A,2),B=_[0],N=_[1],L=Object(b.useRef)({}),H=Object(b.useRef)(0);H.current=h;var U=Object(b.useRef)(!1);U.current=w;var W=Object(b.useRef)(0),q=Object(b.useRef)(),z=Object(b.useRef)();Object(b.useRef)().current=j;var V=m(!0),G=Object(s.a)(V,1)[0],K=ya({compressed:p,windowWidth:G,appBarHidden:O}),X=Object(b.useRef)(),J=Object(b.useRef)();J.current=u;var Y=Object(b.useRef)(),$=Object(b.useRef)();$.current=l,Object(b.useEffect)((function(){return q.current=requestAnimationFrame((function e(){for(var t,n,a,r,i=I.current||[],o=R.current,c=H.current,s=E.current.progress(H.current),u=Number.MAX_SAFE_INTEGER,l=-1,d=!1,b=!1,f={},h=i.length-1;h>=0;--h){var v=i[h],p=v.start/c,g=v.end/c;if(s>=p){if(s<g)u=h<u?h:u,f[h]=!0,!b&&s+100/c>=g&&(b=!0,n=v),!d&&s>=p+100/c&&s<p+500/c&&(d=!0,t=v);-1===l&&(l=h)}else if(u!==Number.MAX_SAFE_INTEGER)break}if(u===Number.MAX_SAFE_INTEGER&&-1!==l&&(f[l]=!0),!function(e,t){for(var n in e)if(!(n in t))return!1;for(var a in t)if(!(a in e))return!1;return!0}(f,L.current)&&(L.current=f,N(f),u!==Number.MAX_SAFE_INTEGER)){var j=o[u],m=!U.current&&Date.now()-W.current>5e3;null!==j&&void 0!==j&&j.current&&m&&j.current.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}d&&X.current!==t&&(null===(a=J.current)||void 0===a||a.call(J),X.current=t);b&&Y.current!==n&&(null===(r=$.current)||void 0===r||r.call($),Y.current=n);q.current=requestAnimationFrame(e)})),function(){void 0!==q.current&&cancelAnimationFrame(q.current)}}),[]);var Z=Object(b.useCallback)((function(){var e,t=L.current;if(t){var n=Object.keys(t);if(0!==n.length){var a=M[Number(n[0])];null===a||void 0===a||null===(e=a.current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}}),[M]);Object(b.useEffect)((function(){if(!w)return document.addEventListener("visibilitychange",e),function(){return document.removeEventListener("visibilitychange",e)};function e(){"visible"===document.visibilityState&&Z()}}),[w,B,M,Z]),Object(b.useEffect)((function(){w||Z()}),[w,Z]),Object(b.useEffect)((function(){var e;if(!U.current){var t=R.current;if(t&&0!==t.length){var n=t[0];null===n||void 0===n||null===(e=n.current)||void 0===e||e.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}}),[y]),Object(b.useEffect)((function(){var e=T.bindAdjustOffset((function(e,t){e.preventDefault(),e.stopPropagation(),o(t)}),(function(){return x}),(function(){return f}));return function(){return e()}}),[o,x,f]),Object(b.useEffect)((function(){var e=T.bindOffsetToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),o(t)}),(function(){return x}),(function(){return t.time(h)}),(function(){return f}));return function(){return e()}}),[o,x,t,f,h]),Object(b.useEffect)((function(){var e=T.bindSeekToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),n(t.start,!1)}),(function(){return x}),(function(){return t.time(h)}),(function(){return f}));return function(){return e()}}),[n,f,x,t,h]),Object(b.useEffect)((function(){var e=T.bindSeekToBeginningOfCurrentSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),n(t.start,!1)}),(function(){return x}),(function(){return t.time(h)}),(function(){return f}));return function(){return e()}}),[n,f,x,t,h]),Object(b.useEffect)((function(){var e=T.bindSeekBackwardOrForward((function(e,a){e.stopPropagation(),e.preventDefault(),n(a?Math.min(h,t.time(h)+1e4):Math.max(0,t.time(h)-1e4),!1)}),(function(){return x}));return function(){return e()}}),[t,h,x,n]),Object(b.useEffect)((function(){function e(){W.current=Date.now()}var t=z.current;return null===t||void 0===t||t.addEventListener("wheel",e),function(){return null===t||void 0===t?void 0:t.removeEventListener("wheel",e)}}),[z,W]),Object(b.useEffect)((function(){if(!w&&v&&f){var e,t,n,a=-1,i=0,o=Object(r.a)(f);try{for(o.s();!(e=o.n()).done;){var c=e.value;if(c.originalStart===v.originalStart&&c.text===v.text){a=i;break}++i}}catch(s){o.e(s)}finally{o.f()}if(-1!==a)null===(t=M[a])||void 0===t||null===(n=t.current)||void 0===n||n.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}}),[w,v,f,M]);var ee=Object(b.useCallback)((function(e){return L.current&&f?Q(f,e,C.surroundingSubtitlesCountRadius,C.surroundingSubtitlesTimeRadius):[]}),[f,C.surroundingSubtitlesCountRadius,C.surroundingSubtitlesTimeRadius]),te=Object(b.useCallback)((function(){if(!L.current)return[];var e=Math.min.apply(Math,Object(i.a)(Object.keys(L.current).map((function(e){return Number(e)}))));return ee(e)}),[ee]);Object(b.useEffect)((function(){var e=T.bindCopy((function(e,t){e.preventDefault(),e.stopPropagation(),a(t,te(),P.none,!1)}),(function(){var e;return null!==(e=D.current)&&void 0!==e&&e}),(function(){var e=Object.keys(L.current).map((function(e){return Number(e)}));if(f&&e&&0!==e.length){var t=Math.min.apply(Math,Object(i.a)(e));return f[t]}}));return function(){return e()}}),[f,te,a]),Object(b.useEffect)((function(){var e=T.bindToggleSubtitleTrackInList((function(e,t){e.preventDefault(),e.stopPropagation(),c(t)}),(function(){}),(function(){return x}));return function(){return e()}}),[x,c]),Object(b.useEffect)((function(){var e=T.bindAnkiExport((function(e){e.preventDefault(),e.stopPropagation();var t=Object.keys(L.current).map((function(e){return Number(e)}));if(f&&t&&t.length>0){var n=Math.min.apply(Math,Object(i.a)(t));a(f[n],ee(n),P.showAnkiDialog,!0)}}),(function(){return!f||0===f.length||x}));return function(){return e()}}),[a,x,f,ee]),Object(b.useEffect)((function(){var e=T.bindUpdateLastCard((function(e){e.preventDefault(),e.stopPropagation();var t=Object.keys(L.current).map((function(e){return Number(e)}));if(f&&t&&t.length>0){var n=Math.min.apply(Math,Object(i.a)(t));a(f[n],ee(n),P.updateLastCard,!0)}}),(function(){return!f||0===f.length||x}));return function(){return e()}}),[a,x,f,ee]);var ne=Object(b.useCallback)((function(e){if(f){var t=L.current||{};n(f[e].start,!F.current&&e in t)}}),[f,n]),ae=Object(b.useCallback)((function(e,t){e.preventDefault(),e.stopPropagation(),f&&a(f[t],ee(t),P.none,!1)}),[f,ee,a]),ie=null;return f&&0!==f.length?ie=Object(re.jsx)(Oa.a,{className:K.table,children:Object(re.jsx)(ga.a,{children:Object(re.jsx)(ja.a,{children:f.map((function(e,t){var n=t in B;return Object(re.jsx)(Sa,{index:t,compressed:p,selected:n,disabled:S[e.track],subtitle:f[t],subtitleRef:M[t],onClickSubtitle:ne,onCopySubtitle:ae},t)}))})})}):!g&&k?ie=!g&&k&&Object(re.jsx)("div",{className:K.noSubtitles,children:Object(re.jsx)(Ne.a,{variant:"h6",children:k})}):f&&0===f.length&&(ie=Object(re.jsx)("div",{className:K.noSubtitles,children:Object(re.jsx)(Ne.a,{variant:"h6",children:"No subtitles"})})),Object(re.jsx)(Fe.a,{square:!0,elevation:0,ref:z,className:K.container,children:ie})}var Ta=function(){function e(t){Object(x.a)(this,e),this.protocol=void 0,this.time=void 0,this.isReady=void 0,this.readyCallbacks=void 0,this.playCallbacks=void 0,this.pauseCallbacks=void 0,this.audioTrackSelectedCallbacks=void 0,this.currentTimeCallbacks=void 0,this.exitCallbacks=void 0,this.offsetCallbacks=void 0,this.popOutToggleCallbacks=void 0,this.copyCallbacks=void 0,this.playModeCallbacks=void 0,this.hideSubtitlePlayerToggleCallbacks=void 0,this.appBarToggleCallbacks=void 0,this.ankiDialogRequestCallbacks=void 0,this.toggleSubtitleTrackInListCallbacks=void 0,this.readyState=void 0,this.oncanplay=null,this.audioTracks=void 0,this.selectedAudioTrack=void 0,this.duration=void 0,this.protocol=t,this.time=0,this.duration=0,this.isReady=!1,this.readyState=0,this.selectedAudioTrack=void 0,this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.toggleSubtitleTrackInListCallbacks=[];var n=this;this.protocol.onMessage=function(e){switch(e.data.command){case"ready":var t=e.data;n.duration=t.duration,n.isReady=!0,n.audioTracks=t.audioTracks,n.selectedAudioTrack=t.selectedAudioTrack,n.readyState=4,n.time=t.currentTime;var a,i=Object(r.a)(n.readyCallbacks);try{for(i.s();!(a=i.n()).done;){(0,a.value)(t.paused)}}catch(K){i.e(K)}finally{i.f()}break;case"readyState":var o,c=e.data;if(n.readyState=c.value,4===n.readyState)null===(o=n.oncanplay)||void 0===o||o.call(n,new Event("canplay"));break;case"play":var s,u=e.data,l=Object(r.a)(n.playCallbacks);try{for(l.s();!(s=l.n()).done;){(0,s.value)(u.echo)}}catch(K){l.e(K)}finally{l.f()}break;case"pause":var d,b=e.data,f=Object(r.a)(n.pauseCallbacks);try{for(f.s();!(d=f.n()).done;){(0,d.value)(b.echo)}}catch(K){f.e(K)}finally{f.f()}break;case"audioTrackSelected":var h,v=e.data,p=Object(r.a)(n.audioTrackSelectedCallbacks);try{for(p.s();!(h=p.n()).done;){var g=h.value;n.selectedAudioTrack=v.id,g(v.id)}}catch(K){p.e(K)}finally{p.f()}break;case"currentTime":var j,m=e.data,O=Object(r.a)(n.currentTimeCallbacks);try{for(O.s();!(j=O.n()).done;){(0,j.value)(m.value,m.echo)}}catch(K){O.e(K)}finally{O.f()}break;case"exit":var k,x=Object(r.a)(n.exitCallbacks);try{for(x.s();!(k=x.n()).done;){(0,k.value)()}}catch(K){x.e(K)}finally{x.f()}break;case"offset":var y,w=e.data,S=Object(r.a)(n.offsetCallbacks);try{for(S.s();!(y=S.n()).done;){(0,y.value)(w.value)}}catch(K){S.e(K)}finally{S.f()}break;case"popOutToggle":var C,T=Object(r.a)(n.popOutToggleCallbacks);try{for(T.s();!(C=T.n()).done;){(0,C.value)()}}catch(K){T.e(K)}finally{T.f()}break;case"copy":var F,E=Object(r.a)(n.copyCallbacks);try{for(E.s();!(F=E.n()).done;){var I,M,R=F.value,D=e.data;R(D.subtitle,D.surroundingSubtitles,D.audio,D.image,D.url,null!==(I=D.postMineAction)&&void 0!==I?I:P.none,!0,null!==(M=D.preventDuplicate)&&void 0!==M&&M,D.id)}}catch(K){E.e(K)}finally{E.f()}break;case"playMode":var A,_=Object(r.a)(n.playModeCallbacks);try{for(_.s();!(A=_.n()).done;){(0,A.value)(e.data.playMode)}}catch(K){_.e(K)}finally{_.f()}break;case"hideSubtitlePlayerToggle":var B,N=Object(r.a)(n.hideSubtitlePlayerToggleCallbacks);try{for(N.s();!(B=N.n()).done;){(0,B.value)()}}catch(K){N.e(K)}finally{N.f()}break;case"appBarToggle":var L,H=Object(r.a)(n.appBarToggleCallbacks);try{for(H.s();!(L=H.n()).done;){(0,L.value)()}}catch(K){H.e(K)}finally{H.f()}break;case"sync":case"syncv2":case"playbackRate":break;case"ankiDialogRequest":var U,W=e.data,q=Object(r.a)(n.ankiDialogRequestCallbacks);try{for(q.s();!(U=q.n()).done;){(0,U.value)(W.forwardToVideo)}}catch(K){q.e(K)}finally{q.f()}break;case"toggleSubtitleTrackInList":var z,V=e.data,G=Object(r.a)(n.toggleSubtitleTrackInListCallbacks);try{for(G.s();!(z=G.n()).done;){(0,z.value)(V.track)}}catch(K){G.e(K)}finally{G.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(y.a)(e,[{key:"currentTime",get:function(){return this.time},set:function(e){this.time=e,this.readyState=3;var t={command:"currentTime",value:this.time};this.protocol.postMessage(t)}},{key:"onReady",value:function(e){this.isReady&&e(!1),this.readyCallbacks.push(e)}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onExit",value:function(e){this.exitCallbacks.push(e)}},{key:"onOffset",value:function(e){this.offsetCallbacks.push(e)}},{key:"onPopOutToggle",value:function(e){this.popOutToggleCallbacks.push(e)}},{key:"onCopy",value:function(e){this.copyCallbacks.push(e)}},{key:"onPlayMode",value:function(e){this.playModeCallbacks.push(e)}},{key:"onHideSubtitlePlayerToggle",value:function(e){this.hideSubtitlePlayerToggleCallbacks.push(e)}},{key:"onAppBarToggle",value:function(e){this.appBarToggleCallbacks.push(e)}},{key:"onAnkiDialogRequest",value:function(e){this.ankiDialogRequestCallbacks.push(e)}},{key:"onToggleSubtitleTrackInList",value:function(e){this.toggleSubtitleTrackInListCallbacks.push(e)}},{key:"ready",value:function(e){var t={command:"ready",duration:e};this.protocol.postMessage(t)}},{key:"init",value:function(){this.protocol.postMessage({command:"init"})}},{key:"play",value:function(){return this.protocol.postMessage({command:"play"}),new Promise((function(e,t){return e()}))}},{key:"pause",value:function(){this.protocol.postMessage({command:"pause"})}},{key:"audioTrackSelected",value:function(e){var t={command:"audioTrackSelected",id:e};this.protocol.postMessage(t)}},{key:"subtitles",value:function(e,t){this.protocol.postMessage({command:"subtitles",value:e,name:t.length>0?t[0]:null,names:t})}},{key:"subtitleSettings",value:function(e){var t={command:"subtitleSettings",value:e};this.protocol.postMessage(t)}},{key:"playMode",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t={command:"playMode",playMode:e};this.protocol.postMessage(t)}))},{key:"hideSubtitlePlayerToggle",value:function(e){var t={command:"hideSubtitlePlayerToggle",value:e};this.protocol.postMessage(t)}},{key:"appBarToggle",value:function(e){var t={command:"appBarToggle",value:e};this.protocol.postMessage(t)}},{key:"ankiDialogRequest",value:function(){this.protocol.postMessage({command:"ankiDialogRequest"})}},{key:"finishedAnkiDialogRequest",value:function(e){var t={command:"finishedAnkiDialogRequest",resume:e};this.protocol.postMessage(t)}},{key:"ankiSettings",value:function(e){var t={command:"ankiSettings",value:e};this.protocol.postMessage(t)}},{key:"miscSettings",value:function(e){var t={command:"miscSettings",value:e};this.protocol.postMessage(t)}},{key:"close",value:function(){this.protocol.postMessage({command:"close"}),this.protocol.close(),this.readyCallbacks=[],this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.exitCallbacks=[],this.offsetCallbacks=[],this.popOutToggleCallbacks=[],this.copyCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.toggleSubtitleTrackInListCallbacks=[]}}]),e}(),Fa=Object(p.a)({root:function(e){return{height:e.appBarHidden?"100vh":"calc(100vh - 64px)",position:"relative",overflowX:"hidden"}},container:{width:"100%",height:"100%"},videoFrame:{width:"100%",height:"100%",border:0,display:"block"}});function Ea(e,t,n,a){var r;r=n&&n.length>0?a?n[n.length-1].end:n[n.length-1].originalEnd:0;var i=e.current&&e.current.duration?1e3*e.current.duration:0,o=t.current&&t.current.duration?1e3*t.current.duration:0;return Math.max(o,Math.max(r,i))}function Pa(e){var t,n=e.sources,a=n.subtitleFiles,r=n.audioFile,i=n.audioFileUrl,u=n.videoFile,l=n.videoFileUrl,f=e.subtitleReader,h=e.settingsProvider,v=e.extension,p=e.videoFrameRef,g=e.drawerOpen,j=e.appBarHidden,m=e.videoPopOut,O=e.tab,k=e.availableTabs,x=e.ankiDialogRequestToVideo,y=e.ankiDialogRequested,w=e.ankiDialogFinishedRequest,S=e.onError,C=e.onUnloadAudio,F=e.onUnloadVideo,E=e.onCopy,R=e.onLoaded,D=e.onTabSelected,A=e.onAnkiDialogRequest,_=e.onAppBarToggle,B=e.onVideoPopOut,N=e.onAutoPauseModeChangedViaBind,L=e.disableKeyEvents,H=e.jumpToSubtitle,U=e.rewindSubtitle,W=Object(b.useState)(),q=Object(s.a)(W,2),z=q[0],V=q[1],G=Object(b.useRef)();G.current=z;var K=Object(b.useState)(!1),X=Object(s.a)(K,2),J=X[0],Y=X[1],Q=Object(b.useState)(!1),Z=Object(s.a)(Q,2),te=Z[0],ne=Z[1],ae=Object(b.useState)(0),ie=Object(s.a)(ae,2),oe=ie[0],ce=ie[1],se=Object(b.useState)(0),ue=Object(s.a)(se,2),le=ue[0],de=ue[1],be=Object(b.useRef)();be.current=te;var fe=Object(b.useState)(),he=Object(s.a)(fe,2)[1],ve=Object(b.useState)(),pe=Object(s.a)(ve,2),ge=pe[0],je=pe[1],me=Object(b.useState)(),Oe=Object(s.a)(me,2),ke=Oe[0],xe=Oe[1],ye=Object(b.useState)(),we=Object(s.a)(ye,2),Ce=we[0],Te=we[1],Fe=Object(b.useState)(!1),Ee=Object(s.a)(Fe,2)[1],Pe=Object(b.useState)(!1),Ie=Object(s.a)(Pe,2),Me=Ie[0],Re=Ie[1],De=Object(b.useRef)();De.current=Me;var Ae=Object(b.useState)({}),_e=Object(s.a)(Ae,2),Be=_e[0],Ne=_e[1],Le=Object(b.useState)(M.normal),He=Object(s.a)(Le,2),Ue=He[0],We=He[1],qe=Object(b.useRef)();qe.current=Ue;var ze=Object(b.useCallback)((function(){return he({})}),[]),Ve=Object(b.useRef)({x:0,y:0}),Ge=Object(b.useRef)(null),Ke=Object(b.useRef)(),Xe=Object(b.useMemo)((function(){return new pa(i?Ge:l||O?Ke:{current:null})}),[i,l,O]),Je=Object(b.useMemo)((function(){return new Cn}),[]),Ye=Fa({appBarHidden:j}),Qe=Object(b.useRef)(0);Qe.current=Ea(Ge,Ke,z,!0);var $e=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(t,n,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.setTime(t),ze(),!a){e.next=5;break}return e.next=5,Xe.seek(t/1e3);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),[ze,Xe]),Ze=Object(b.useCallback)((function(e,t){de(e),V((function(n){if(n){var r=n.length>0?n[n.length-1].end+e:0,i=n.map((function(t){return{text:t.text,textImage:t.textImage,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd,displayTime:$t(t.originalStart+e,r),track:t.track}}));return t&&Ke.current instanceof Ta&&Ke.current.subtitles(i,a.map((function(e){return e.name}))),i}}))}),[a]);function et(e,t,n){ne(!0),e.start(),n&&t.play()}function tt(e,t,n){ne(!1),e.stop(),n&&t.pause()}Object(b.useEffect)((function(){var e=void 0,t=!1;function n(){return n=Object(c.a)(d.a.mark((function n(){var s,b,p,g,j;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Ke.current instanceof Ta&&Ke.current.close(),Ke.current=void 0,Je.setTime(0),Je.stop(),de(0),ne(!1),je(void 0),xe(void 0),We(M.normal),Ge.current&&(Ge.current.currentTime=0,Ge.current.pause()),!(a.length>0)){n.next=30;break}return Y(!0),n.prev=12,n.next=15,f.subtitles(a);case 15:b=n.sent,p=b.length>0?b[b.length-1].end:0,s=b.map((function(e){return{text:e.text,textImage:e.textImage,start:e.start,originalStart:e.start,end:e.end,originalEnd:e.end,displayTime:$t(e.start,p),track:e.track}})),V(s),ce(Date.now()),n.next=25;break;case 22:n.prev=22,n.t0=n.catch(12),n.t0 instanceof Error?S(n.t0.message):S(String(n.t0));case 25:return n.prev=25,Y(!1),n.finish(25);case 28:n.next=31;break;case 30:s=void 0;case 31:if(!i){n.next=37;break}return n.next=34,Xe.onReady();case 34:ze(),n.next=59;break;case 37:if(!l&&!O){n.next=59;break}if(!t){n.next=40;break}return n.abrupt("return");case 40:if(!l){n.next=46;break}g=Object(ee.a)(),e=new Ta(new wn(g)),Te(g),n.next=52;break;case 46:if(!O){n.next=51;break}(e=new Ta(new Sn(O.id,O.src,v))).init(),n.next=52;break;case 51:throw new Error("Unreachable code");case 52:Ke.current=e,j=!1,e.onExit((function(){return l&&F(l)})),e.onPopOutToggle((function(){return B()})),e.onHideSubtitlePlayerToggle((function(){Re((function(t){var n;return null===(n=e)||void 0===n||n.hideSubtitlePlayerToggle(!t),!t}))})),e.onAppBarToggle((function(){_()})),e.onReady((function(t){var n,i,s,l,b,f,v,p,g,m,O,k,x,y,w,S,C,T,F,P,I,M;(Qe.current=Ea(Ge,Ke,G.current),null===(n=e)||void 0===n||n.ready(Qe.current),G.current)&&(null===(m=e)||void 0===m||m.subtitleSettings(h.subtitleSettings),null===(O=e)||void 0===O||O.subtitles(G.current,a.map((function(e){return e.name}))));(null===(i=e)||void 0===i||i.ankiSettings(h.ankiSettings),null===(s=e)||void 0===s||s.miscSettings(h.miscSettings),null===(l=e)||void 0===l||l.playMode(qe.current),null===(b=e)||void 0===b||b.hideSubtitlePlayerToggle(null!==(f=De.current)&&void 0!==f&&f),null!==(v=e)&&void 0!==v&&v.audioTracks&&(null===(p=e)||void 0===p||null===(g=p.audioTracks)||void 0===g?void 0:g.length)>1)?(je(null===(k=e)||void 0===k?void 0:k.audioTracks),xe(null===(x=e)||void 0===x?void 0:x.selectedAudioTrack)):(je(void 0),xe(void 0));(Ke.current&&Je.setTime(1e3*Ke.current.currentTime),t?Je.stop():Je.start(),ne(!t),j)||(null===(y=e)||void 0===y||y.onPlay((function(e){return et(Je,Xe,e)})),null===(w=e)||void 0===w||w.onPause((function(e){return tt(Je,Xe,e)})),null===(S=e)||void 0===S||S.onOffset((function(e){var t;return Ze(Math.max(null!==(t=-Qe.current)&&void 0!==t?t:0,e),!1)})),null===(C=e)||void 0===C||C.onCopy((function(t,n,i,o,c,s,l,d,b){var f;return E(t,n,r,u,t?a[t.track]:void 0,Je.time(Qe.current),null===(f=e)||void 0===f?void 0:f.selectedAudioTrack,i,o,c,s,l,d,b)})),null===(T=e)||void 0===T||T.onPlayMode((function(t){var n;We(t),null===(n=e)||void 0===n||n.playMode(t)})),null===(F=e)||void 0===F||F.onCurrentTime(function(){var e=Object(c.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return be.current&&Je.stop(),e.next=3,$e(1e3*t,Je,n);case 3:be.current&&Je.start();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),null===(P=e)||void 0===P||P.onAudioTrackSelected(function(){var e=Object(c.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return be.current&&Je.stop(),e.next=3,Xe.onReady();case 3:be.current&&Je.start(),xe(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),null===(I=e)||void 0===I||I.onAnkiDialogRequest((function(e){return A(e)})),null===(M=e)||void 0===M||M.onToggleSubtitleTrackInList((function(e){return Ne((function(t){var n=Object(o.a)({},t);return n[e]=!t[e],n}))})),j=!0)}));case 59:case"end":return n.stop()}}),n,null,[[12,22,25,28]])}))),n.apply(this,arguments)}return function(){return n.apply(this,arguments)}().then((function(){return R()})),function(){var n;null===(n=e)||void 0===n||n.close(),t=!0}}),[f,v,h,Je,Xe,$e,R,S,F,E,A,_,B,a,r,i,u,l,O,ze,p,Ze]),Object(b.useEffect)((function(){x&&Ke.current instanceof Ta&&Ke.current.ankiDialogRequest()}),[x]),Object(b.useEffect)((function(){w&&w.timestamp>0&&(Ke.current instanceof Ta&&Ke.current.finishedAnkiDialogRequest(w.resume),Ee((function(e){return e&&w.resume&&et(Je,Xe,!0),!1})))}),[w,Je,Xe]),Object(b.useEffect)((function(){y&&be.current&&(tt(Je,Xe,!0),Ee(!0))}),[y,Je,Xe]),Object(b.useEffect)((function(){if(Ue===M.condensed&&z&&0!==z.length){var e=!1,t=1e3,n=setInterval(Object(c.a)(d.a.mark((function n(){var a,r,i,o,c,s,u,l,b,f;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=Qe.current){n.next=3;break}return n.abrupt("return");case 3:r=Je.progress(a),i=0,o=-1,c=z.length-1;case 7:if(!(c>=0)){n.next=17;break}if(s=z[c],u=s.start/a,l=s.end/a,!(r>=u)){n.next=14;break}return r<l?(o=c,i=c):i=Math.min(z.length-1,c+1),n.abrupt("break",17);case 14:--c,n.next=7;break;case 17:if(o===i){n.next=30;break}if(!((b=z[i]).start-r*a<t+500)){n.next=21;break}return n.abrupt("return");case 21:if(be.current&&Je.stop(),e){n.next=29;break}return e=!0,f=Date.now(),n.next=27,$e(b.start,Je,!0);case 27:t=Date.now()-f,e=!1;case 29:be.current&&Je.start();case 30:case"end":return n.stop()}}),n)}))),100);return function(){return clearInterval(n)}}}),[z,Ue,Je,$e]);var nt=Object(b.useCallback)((function(){Ue===M.autoPause&&h.autoPausePreference===I.atStart&&tt(Je,Xe,!0)}),[Ue,Je,Xe,h]),at=Object(b.useCallback)((function(){Ue===M.autoPause&&h.autoPausePreference===I.atEnd&&tt(Je,Xe,!0)}),[Ue,Je,Xe,h]);Object(b.useEffect)((function(){m&&Ce&&l&&window.open("/asbplayer-staging/?video="+encodeURIComponent(l)+"&channel="+Ce+"&popout=true","asbplayer-video-"+l,"resizable,width=800,height=450"),ce(Date.now())}),[m,Ce,l,p]);var rt=Object(b.useCallback)((function(){return et(Je,Xe,!0)}),[Je,Xe]),it=Object(b.useCallback)((function(){return tt(Je,Xe,!0)}),[Je,Xe]),ot=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Qe.current){e.next=2;break}return e.abrupt("return");case 2:return be.current&&Je.stop(),e.next=5,$e(t*Qe.current,Je,!0);case 5:be.current&&Je.start();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Je,$e]),ct=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n||tt(Je,Xe,!0),be.current&&Je.stop(),e.next=4,$e(t,Je,!0);case 4:n&&!be.current&&et(Je,Xe,!0);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[Je,$e,Xe]),st=Object(b.useCallback)((function(e,t,n,i){E(e,t,r,u,a[e.track],Je.time(Qe.current),ke,void 0,void 0,void 0,n,!1,i,void 0)}),[Je,E,r,u,a,ke]),ut=Object(b.useCallback)((function(e){Ve.current.x=e.screenX,Ve.current.y=e.screenY}),[]),lt=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ke.current instanceof Ta&&Ke.current.audioTrackSelected(t),tt(Je,Xe,!0),e.next=4,$e(0,Je,!0);case 4:be.current&&et(Je,Xe,!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Je,Xe,$e]),dt=Object(b.useCallback)((function(e){var t;Ze(Math.max(null!==(t=-Qe.current)&&void 0!==t?t:0,e),!0)}),[Ze]),bt=Object(b.useCallback)((function(e){Ge.current instanceof HTMLMediaElement&&(Ge.current.volume=e)}),[]),ft=Object(b.useCallback)((function(e){return We(e)}),[]),ht=Object(b.useCallback)((function(e){return Ne((function(t){var n=Object(o.a)({},t);return n[e]=!t[e],n}))}),[]);Object(b.useEffect)((function(){if(!O){var e=setInterval(Object(c.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Qe.current,!(Je.progress(t)>=1)){e.next=7;break}return tt(Je,Xe,!0),e.next=6,$e(0,Je,!0);case 6:ce(Date.now());case 7:case"end":return e.stop()}}),e)}))),1e3);return function(){return clearInterval(e)}}}),[Je,z,Xe,$e,O]),Object(b.useEffect)((function(){var e=T.bindPlay((function(e){e.preventDefault(),te?tt(Je,Xe,!0):et(Je,Xe,!0)}),(function(){return L}));return function(){return e()}}),[te,Je,Xe,L]),Object(b.useEffect)((function(){return T.bindAutoPause((function(e){if(!O){e.preventDefault();var t=Ue===M.autoPause?M.normal:M.autoPause;We(t),N(t)}}),(function(){return L}))}),[L,h,Ue,O,N]),Object(b.useEffect)((function(){if((r||u)&&(!z||0===z.length)){var e=T.bindCopy((function(e,t){e.preventDefault(),e.stopPropagation();var n=$(t,Qe.current,5e3);E(t,n,r,u,void 0,Je.time(Qe.current),ke,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}),(function(){return L}),(function(){if(Qe.current){var e=Je.time(Qe.current),t=Math.min(e+5e3,Qe.current);return{text:"",start:e,originalStart:e,end:t,originalEnd:t,track:0}}})),t=T.bindAnkiExport((function(e){e.preventDefault(),e.stopPropagation();var t=Je.time(Qe.current),n=Math.min(t+5e3,Qe.current),a={text:"",start:t,originalStart:t,end:n,originalEnd:n,track:0},i=$(a,Qe.current,5e3);E(a,i,r,u,void 0,t,ke,void 0,void 0,void 0,P.showAnkiDialog,!1,void 0,void 0)}),(function(){return!1}));return function(){e(),t()}}}),[r,u,z,Je,ke,L,E,A]),Object(b.useEffect)((function(){Ke.current instanceof Ta&&Ke.current.appBarToggle(j)}),[j]),Object(b.useEffect)((function(){U&&(be.current&&Je.stop(),ct(U.start,!1))}),[Je,U,ct]);var vt=Qe.current,pt=i||l||z,gt=Boolean(pt&&l&&!m);return Object(re.jsxs)("div",{onMouseMove:ut,className:Ye.root,children:[Object(re.jsxs)(Se.a,{container:!0,direction:"row",wrap:"nowrap",className:Ye.container,children:[gt&&Object(re.jsx)(Se.a,{item:!0,style:{flexGrow:1,minWidth:600},children:Object(re.jsx)("iframe",{ref:p,className:Ye.videoFrame,src:"/asbplayer-staging/?video="+encodeURIComponent(l)+"&channel="+Ce+"&popout=false",title:"asbplayer"})}),(!gt||z&&(null===(t=z)||void 0===t?void 0:t.length)>0)&&Object(re.jsxs)(Se.a,{item:!0,style:{flexGrow:gt?0:1,width:gt&&Me?0:"auto"},children:[pt&&!(l&&!m)&&Object(re.jsx)(va,{mousePositionRef:Ve,playing:te,clock:Je,length:vt,displayLength:Ea(Ge,Ke,z,!1),audioTracks:ge,selectedAudioTrack:ke,tabs:!l&&!i&&k||void 0,selectedTab:O,audioFile:null===r||void 0===r?void 0:r.name,videoFile:null===u||void 0===u?void 0:u.name,offsetEnabled:!0,offset:le,volumeEnabled:Boolean(i),playModeEnabled:Boolean(l||i),playMode:Ue,onPlay:rt,onPause:it,onSeek:ot,onAudioTrackSelected:lt,onTabSelected:D,onUnloadAudio:function(){return i&&C(i)},onUnloadVideo:function(){return l&&F(l)},onOffsetChange:dt,onVolumeChange:bt,onPlayMode:ft,disableKeyEvents:L,settingsProvider:h,showOnMouseMovement:!0}),Object(re.jsx)(Ca,{playing:te,subtitles:z,clock:Je,length:vt,jumpToSubtitle:H,drawerOpen:g,appBarHidden:j,compressed:Boolean(l&&!m),loading:J,displayHelp:(null===r||void 0===r?void 0:r.name)||m&&(null===u||void 0===u?void 0:u.name)||void 0,disableKeyEvents:L,lastJumpToTopTimestamp:oe,hidden:gt&&Me,disabledSubtitleTracks:Be,onSeek:ct,onCopy:st,onOffsetChange:dt,onToggleSubtitleTrack:ht,onStartedShowing:nt,onWillStopShowing:at,settingsProvider:h})]})]}),Object(re.jsx)("audio",{ref:Ge,src:i})]})}var Ia=n(354),Ma=n(344);function Ra(e){var t=e.open,n=e.onProceed,a=e.onCancel,r=e.existingCustomFieldNames,o=Object(b.useState)(""),c=Object(s.a)(o,2),u=c[0],l=c[1];Object(b.useEffect)((function(){l("")}),[t]);var d=[].concat(Object(i.a)(r),["Sentence","Word","Definition","Source","Image","Audio"]).includes(u);return Object(re.jsxs)(he.a,{open:t,disableEnforceFocus:!0,fullWidth:!0,maxWidth:"xs",onClose:a,children:[Object(re.jsx)(Ma.a,{children:"New Custom Field"}),Object(re.jsx)(xe.a,{children:Object(re.jsx)("form",{children:Object(re.jsx)(se.a,{error:d,helperText:d&&"Field ".concat(u," already exists"),variant:"filled",fullWidth:!0,label:"Field Name",value:u,color:"secondary",onChange:function(e){return l(e.target.value)}})})}),Object(re.jsxs)(ke.a,{children:[Object(re.jsx)(je.a,{onClick:function(){return a()},children:"Cancel"}),Object(re.jsx)(je.a,{disabled:d||""===u.trim(),onClick:function(){return n(u.trim())},children:"Create"})]})]})}var Da=n(268),Aa=n(347),_a=n(346),Ba=n(271),Na=n(270),La=n(269),Ha=n(345),Ua=n(181),Wa=n.n(Ua),qa=n(352),za=n(182),Va=n.n(za),Ga=n(275),Ka=Object(de.a)((function(e){return{root:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitleSetting:{"& .MuiTextField-root":{marginTop:e.spacing(1),marginBottom:e.spacing(1)}},subtitlePreview:{backgroundImage:"linear-gradient(45deg, ".concat(e.palette.action.disabledBackground," 25%, transparent 25%), linear-gradient(-45deg, ").concat(e.palette.action.disabledBackground," 25%, transparent 25%), linear-gradient(45deg, transparent 75%, ").concat(e.palette.action.disabledBackground," 75%), linear-gradient(-45deg, transparent 75%,").concat(e.palette.action.disabledBackground," 75%)"),backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px",marginTop:e.spacing(1),marginBottom:e.spacing(1),maxWidth:"100%",padding:10},subtitlePreviewInput:{border:"none",width:"100%",textAlign:"center",backgroundColor:"rgba(0,0,0,0)","&:focus":{outline:"none"}},addFieldButton:{width:"100%"}}})),Xa=Object(de.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120},root:{display:"flex",flexDirection:"row",justifyContent:"end",alignItems:"flex-end"}}}));function Ja(e){var t=e.label,n=e.value,a=e.selections,r=e.removable,i=e.onChange,o=e.onSelectionChange,c=e.onRemoval,s=Xa();return Object(re.jsxs)("div",{className:s.root,children:[Object(re.jsx)(se.a,{label:t,value:n,onChange:i,fullWidth:!0,color:"secondary",InputProps:{endAdornment:r&&Object(re.jsx)(Te.a,{position:"end",children:Object(re.jsx)(Ce.a,{onClick:function(e){return null===c||void 0===c?void 0:c()},children:Object(re.jsx)(Wa.a,{})})})}}),Object(re.jsxs)(Da.a,{className:s.formControl,children:[Object(re.jsx)(La.a,{}),Object(re.jsx)(Ga.a,{value:n,disabled:!a,color:"secondary",onChange:o,children:a&&a.map((function(e){return Object(re.jsx)(Ha.a,{value:e,children:e},e)}))})]})]})}function Ya(e){var t=e.anki,n=e.open,a=e.settings,r=e.onClose,o=Ka(),u=Object(b.useState)(a.ankiConnectUrl),l=Object(s.a)(u,2),h=l[0],v=l[1],p=Object(b.useState)(),g=Object(s.a)(p,2),j=g[0],m=g[1],O=Object(b.useState)(0),k=Object(s.a)(O,2),x=k[0],y=k[1],w=Object(b.useState)(a.deck||""),S=Object(s.a)(w,2),C=S[0],T=S[1],F=Object(b.useState)(),E=Object(s.a)(F,2),P=E[0],M=E[1],R=Object(b.useState)(a.noteType||""),D=Object(s.a)(R,2),A=D[0],_=D[1],B=Object(b.useState)(),N=Object(s.a)(B,2),L=N[0],H=N[1],U=Object(b.useState)(a.sentenceField||""),W=Object(s.a)(U,2),q=W[0],z=W[1],V=Object(b.useState)(a.definitionField||""),G=Object(s.a)(V,2),K=G[0],X=G[1],J=Object(b.useState)(a.audioField||""),Y=Object(s.a)(J,2),Q=Y[0],$=Y[1],Z=Object(b.useState)(a.imageField||""),ee=Object(s.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(b.useState)(a.wordField||""),ie=Object(s.a)(ae,2),oe=ie[0],ce=ie[1],ue=Object(b.useState)(a.sourceField||""),de=Object(s.a)(ue,2),be=de[0],fe=de[1],ve=Object(b.useState)(a.urlField||""),pe=Object(s.a)(ve,2),ge=pe[0],me=pe[1],Oe=Object(b.useState)(a.customAnkiFields),ye=Object(s.a)(Oe,2),we=ye[0],Fe=ye[1],Ee=Object(b.useState)(a.tags),Pe=Object(s.a)(Ee,2),Ie=Pe[0],Me=Pe[1],Re=Object(b.useState)(a.preferMp3),De=Object(s.a)(Re,2),Ae=De[0],_e=De[1],Be=Object(b.useState)(),Ne=Object(s.a)(Be,2),Le=Ne[0],He=Ne[1],Ue=Object(b.useState)(!1),We=Object(s.a)(Ue,2),qe=We[0],ze=We[1],Ve=Object(b.useState)(a.audioPaddingStart),Ge=Object(s.a)(Ve,2),Ke=Ge[0],Xe=Ge[1],Je=Object(b.useState)(a.audioPaddingEnd),Ye=Object(s.a)(Je,2),Qe=Ye[0],$e=Ye[1],Ze=Object(b.useState)(a.maxImageWidth),et=Object(s.a)(Ze,2),tt=et[0],nt=et[1],at=Object(b.useState)(a.maxImageHeight),rt=Object(s.a)(at,2),it=rt[0],ot=rt[1],ct=Object(b.useState)(a.subtitleColor),st=Object(s.a)(ct,2),ut=st[0],lt=st[1],dt=Object(b.useState)(a.subtitleSize),bt=Object(s.a)(dt,2),ft=bt[0],ht=bt[1],vt=Object(b.useState)(a.subtitleOutlineColor),pt=Object(s.a)(vt,2),gt=pt[0],jt=pt[1],mt=Object(b.useState)(a.subtitleOutlineThickness),Ot=Object(s.a)(mt,2),kt=Ot[0],xt=Ot[1],yt=Object(b.useState)(a.subtitleBackgroundColor),wt=Object(s.a)(yt,2),St=wt[0],Ct=wt[1],Tt=Object(b.useState)(a.subtitleBackgroundOpacity),Ft=Object(s.a)(Tt,2),Et=Ft[0],Pt=Ft[1],It=Object(b.useState)(a.subtitleFontFamily),Mt=Object(s.a)(It,2),Rt=Mt[0],Dt=Mt[1],At=Object(b.useState)(a.imageBasedSubtitleScaleFactor),_t=Object(s.a)(At,2),Bt=_t[0],Nt=_t[1],Lt=Object(b.useState)(a.subtitlePreview),Ht=Object(s.a)(Lt,2),Ut=Ht[0],Wt=Ht[1],qt=Object(b.useState)(a.themeType),zt=Object(s.a)(qt,2),Vt=zt[0],Gt=zt[1],Kt=Object(b.useState)(a.copyToClipboardOnMine),Xt=Object(s.a)(Kt,2),Jt=Xt[0],Yt=Xt[1],$t=Object(b.useState)(a.autoPausePreference),Zt=Object(s.a)($t,2),en=Zt[0],tn=Zt[1],nn=Object(b.useCallback)((function(e){v(e.target.value),y(Date.now())}),[]),an=Object(b.useCallback)((function(e){return y(Date.now())}),[]),rn=Object(b.useCallback)((function(e){return T(e.target.value)}),[]),on=Object(b.useCallback)((function(e){return T(e.target.value)}),[]),cn=Object(b.useCallback)((function(e){return _(e.target.value)}),[]),sn=Object(b.useCallback)((function(e){return _(e.target.value)}),[]),un=Object(b.useCallback)((function(e){return z(e.target.value)}),[]),ln=Object(b.useCallback)((function(e){return z(e.target.value)}),[]),dn=Object(b.useCallback)((function(e){return X(e.target.value)}),[]),bn=Object(b.useCallback)((function(e){return X(e.target.value)}),[]),fn=Object(b.useCallback)((function(e){return $(e.target.value)}),[]),hn=Object(b.useCallback)((function(e){return $(e.target.value)}),[]),vn=Object(b.useCallback)((function(e){return ne(e.target.value)}),[]),pn=Object(b.useCallback)((function(e){return ne(e.target.value)}),[]),gn=Object(b.useCallback)((function(e){return ce(e.target.value)}),[]),jn=Object(b.useCallback)((function(e){return ce(e.target.value)}),[]),mn=Object(b.useCallback)((function(e){return fe(e.target.value)}),[]),On=Object(b.useCallback)((function(e){return fe(e.target.value)}),[]),xn=Object(b.useCallback)((function(e){return me(e.target.value)}),[]),yn=Object(b.useCallback)((function(e){return me(e.target.value)}),[]),wn=Object(b.useCallback)((function(e){return Xe(Number(e.target.value))}),[]),Sn=Object(b.useCallback)((function(e){return $e(Number(e.target.value))}),[]),Cn=Object(b.useCallback)((function(e){return nt(Number(e.target.value))}),[]),Tn=Object(b.useCallback)((function(e){return ot(Number(e.target.value))}),[]),Fn=Object(b.useCallback)((function(e){return lt(e.target.value)}),[]),En=Object(b.useCallback)((function(e){return ht(Number(e.target.value))}),[]),Pn=Object(b.useCallback)((function(e){return jt(e.target.value)}),[]),In=Object(b.useCallback)((function(e){return xt(Number(e.target.value))}),[]),Mn=Object(b.useCallback)((function(e){return Ct(e.target.value)}),[]),Rn=Object(b.useCallback)((function(e){return Pt(Number(e.target.value))}),[]),Dn=Object(b.useCallback)((function(e){return Dt(e.target.value)}),[]),An=Object(b.useCallback)((function(e){return Wt(e.target.value)}),[]),_n=Object(b.useCallback)((function(e){return Nt(Number(e.target.value))}),[]),Bn=Object(b.useCallback)((function(e){Fe((function(t){var n={};return Object.assign(n,t),n[e]="",n})),ze(!1)}),[]),Nn=Object(b.useCallback)((function(e,t){Fe((function(n){var a={};return Object.assign(a,n),a[e]=t,a}))}),[]),Ln=Object(b.useCallback)((function(e){return Fe((function(t){var n={};return Object.assign(n,t),delete n[e],n}))}),[]),Hn=Object(b.useCallback)((function(e){Me(e)}),[]),Un=Object(b.useCallback)((function(e){return _e(e.target.checked)}),[]),Wn=Object(b.useCallback)((function(e){if("dark"!==e.target.value&&"light"!==e.target.value)throw new Error("Invalid theme type ".concat(e.target.value));Gt(e.target.value)}),[]),qn=Object(b.useCallback)((function(e){return Yt(e.target.checked)}),[]),zn=Object(b.useCallback)((function(e){tn(Number(e.target.value))}),[]),Vn=Object(b.useMemo)((function(){return Qt({subtitleColor:ut,subtitleSize:ft,subtitleOutlineThickness:kt,subtitleOutlineColor:gt,subtitleBackgroundOpacity:Et,subtitleBackgroundColor:St,subtitleFontFamily:Rt})}),[ut,ft,kt,gt,Et,St,Rt]);Object(b.useEffect)((function(){var e=!1,n=setTimeout(Object(c.a)(d.a.mark((function n(){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,t.requestPermission(h);case 5:return n.t0=M,n.next=8,t.deckNames(h);case 8:return n.t1=n.sent,(0,n.t0)(n.t1),n.t2=H,n.next=13,t.modelNames(h);case 13:n.t3=n.sent,(0,n.t2)(n.t3),m(void 0),n.next=26;break;case 18:if(n.prev=18,n.t4=n.catch(0),!e){n.next=22;break}return n.abrupt("return");case 22:console.error(n.t4),M(void 0),H(void 0),n.t4 instanceof Error?m(n.t4.message):"string"===typeof n.t4?m(n.t4):m(String(n.t4));case 26:case"end":return n.stop()}}),n,null,[[0,18]])}))),1e3);return function(){e=!0,clearTimeout(n)}}),[t,h,x]),Object(b.useEffect)((function(){if(A&&!j){var e=!1;return function(){n.apply(this,arguments)}(),function(){e=!0}}function n(){return(n=Object(c.a)(d.a.mark((function n(){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!e){n.next=3;break}return n.abrupt("return");case 3:return n.t0=He,n.t1=[""],n.t2=i.a,n.next=8,t.modelFieldNames(A,h);case 8:n.t3=n.sent,n.t4=(0,n.t2)(n.t3),n.t5=n.t1.concat.call(n.t1,n.t4),(0,n.t0)(n.t5),m(void 0),n.next=22;break;case 15:if(n.prev=15,n.t6=n.catch(0),!e){n.next=19;break}return n.abrupt("return");case 19:console.error(n.t6),He(void 0),n.t6 instanceof Error?m(n.t6.message):"string"===typeof n.t6?m(n.t6):m(String(n.t6));case 22:case"end":return n.stop()}}),n,null,[[0,15]])})))).apply(this,arguments)}}),[t,A,h,j,x]);var Gn=Object(b.useCallback)((function(){r({ankiConnectUrl:h,deck:C,noteType:A,sentenceField:q,definitionField:K,audioField:Q,imageField:te,wordField:oe,sourceField:be,urlField:ge,tags:Ie.filter((function(e){return""!==e})),subtitleSize:Number(ft),subtitleColor:ut,subtitleOutlineThickness:Number(kt),subtitleOutlineColor:gt,subtitleBackgroundColor:St,subtitleBackgroundOpacity:Number(Et),subtitleFontFamily:Rt,subtitlePreview:Ut,imageBasedSubtitleScaleFactor:Bt,customAnkiFields:we,preferMp3:Ae,themeType:Vt,audioPaddingStart:Ke,audioPaddingEnd:Qe,maxImageWidth:tt,maxImageHeight:it,surroundingSubtitlesCountRadius:a.surroundingSubtitlesCountRadius,surroundingSubtitlesTimeRadius:a.surroundingSubtitlesTimeRadius,volume:a.volume,theaterMode:a.theaterMode,copyToClipboardOnMine:Jt,autoPausePreference:en})}),[r,h,C,A,q,K,Q,te,oe,be,ge,we,Ie,Ae,ft,ut,kt,gt,St,Et,Rt,Ut,Bt,Vt,Ke,Qe,tt,it,a.surroundingSubtitlesCountRadius,a.surroundingSubtitlesTimeRadius,a.volume,a.theaterMode,Jt,en]),Kn=Object.keys(we).map((function(e){return Object(re.jsx)(Ja,{label:"".concat(e," Field"),value:we[e],selections:Le,onChange:function(t){return Nn(e,t.target.value)},onSelectionChange:function(t){return Nn(e,t.target.value)},onRemoval:function(){return Ln(e)},removable:!0},e)}));return Object(re.jsxs)(f.a.Fragment,{children:[Object(re.jsx)(Ra,{open:qe,existingCustomFieldNames:Object.keys(we),onProceed:Bn,onCancel:function(){return ze(!1)}}),Object(re.jsxs)(he.a,{open:n,maxWidth:"xs",fullWidth:!0,onClose:Gn,children:[Object(re.jsx)(Ma.a,{children:"Settings"}),Object(re.jsx)(xe.a,{children:Object(re.jsxs)(Se.a,{container:!0,direction:"column",spacing:3,children:[Object(re.jsxs)(Se.a,{item:!0,children:[Object(re.jsx)(Na.a,{children:"Anki"}),Object(re.jsxs)(_a.a,{className:o.root,children:[Object(re.jsx)(se.a,{label:"Anki Connect URL",value:h,error:Boolean(j),helperText:j,color:"secondary",onChange:nn,InputProps:{endAdornment:Object(re.jsx)(Te.a,{position:"end",children:Object(re.jsx)(Ce.a,{onClick:an,children:Object(re.jsx)(Va.a,{})})})}}),Object(re.jsxs)(Ba.a,{children:["Ensure that ",window.location.protocol+"//"+window.location.hostname," is in the webCorsOriginList in your AnkiConnect settings as in this"," ",Object(re.jsx)(kn.a,{color:"secondary",target:"_blank",rel:"noreferrer",href:"https://youtu.be/Mv7fEVb6PHo?t=44",children:"video"}),"."]}),Object(re.jsx)(Ja,{label:"Deck",value:C,selections:P,onChange:rn,onSelectionChange:on}),Object(re.jsx)(Ja,{label:"Note Type",value:A,selections:L,onChange:cn,onSelectionChange:sn}),Object(re.jsx)(Ja,{label:"Sentence Field",value:q,selections:Le,onChange:un,onSelectionChange:ln}),Object(re.jsx)(Ja,{label:"Definition Field",value:K,selections:Le,onChange:dn,onSelectionChange:bn}),Object(re.jsx)(Ja,{label:"Word Field",value:oe,selections:Le,onChange:gn,onSelectionChange:jn}),Object(re.jsx)(Ja,{label:"Audio Field",value:Q,selections:Le,onChange:fn,onSelectionChange:hn}),Object(re.jsx)(Ja,{label:"Image Field",value:te,selections:Le,onChange:vn,onSelectionChange:pn}),Object(re.jsx)(Ja,{label:"Source Field",value:be,selections:Le,onChange:mn,onSelectionChange:On}),Object(re.jsx)(Ja,{label:"URL Field",value:ge,selections:Le,onChange:xn,onSelectionChange:yn}),Kn,Object(re.jsx)(je.a,{className:o.addFieldButton,onClick:function(e){return ze(!0)},children:"Add Custom Field"}),Object(re.jsx)(le,{label:"Tags",helperText:"Comma-separated list of strings",fullWidth:!0,color:"secondary",tags:Ie,onTagsChange:Hn})]})]}),Object(re.jsxs)(Se.a,{item:!0,children:[Object(re.jsx)(Na.a,{children:"Mining"}),Object(re.jsxs)(_a.a,{className:o.root,children:[Object(re.jsx)(Aa.a,{control:Object(re.jsx)(Ia.a,{checked:Ae,onChange:Un}),label:"Re-encode audio as mp3 (slower)"}),Object(re.jsx)(Aa.a,{control:Object(re.jsx)(Ia.a,{checked:Jt,onChange:qn}),label:"Copy mined subtitles to clipboard"}),Object(re.jsx)(se.a,{type:"number",label:"Audio Padding Start",fullWidth:!0,value:Ke,color:"secondary",onChange:wn,inputProps:{min:0,step:1},InputProps:{endAdornment:Object(re.jsx)(Te.a,{position:"end",children:"ms"})}}),Object(re.jsx)(se.a,{type:"number",label:"Audio Padding End",fullWidth:!0,value:Qe,color:"secondary",onChange:Sn,inputProps:{min:0,step:1},InputProps:{endAdornment:Object(re.jsx)(Te.a,{position:"end",children:"ms"})}}),Object(re.jsx)(se.a,{type:"number",label:"Max Image Width",fullWidth:!0,value:tt,color:"secondary",onChange:Cn,inputProps:{min:0,step:1}}),Object(re.jsx)(se.a,{type:"number",label:"Max Image Height",fullWidth:!0,value:it,color:"secondary",onChange:Tn,inputProps:{min:0,step:1}})]})]}),Object(re.jsxs)(Se.a,{item:!0,children:[Object(re.jsx)(Na.a,{children:"Auto-pause Preference"}),Object(re.jsxs)("div",{children:[Object(re.jsx)(Aa.a,{control:Object(re.jsx)(qa.a,{checked:en===I.atStart,value:I.atStart,onChange:zn}),label:"At Subtitle Start"}),Object(re.jsx)(Aa.a,{control:Object(re.jsx)(qa.a,{checked:en===I.atEnd,value:I.atEnd,onChange:zn}),label:"At Subtitle End"})]})]}),Object(re.jsxs)(Se.a,{item:!0,children:[Object(re.jsx)(Na.a,{children:"Video Subtitle Appearance"}),Object(re.jsxs)(_a.a,{children:[Object(re.jsx)("div",{className:o.subtitleSetting,children:Object(re.jsx)(se.a,{type:"color",label:"Subtitle Color",fullWidth:!0,value:ut,color:"secondary",onChange:Fn})}),Object(re.jsx)("div",{className:o.subtitleSetting,children:Object(re.jsx)(se.a,{type:"number",label:"Subtitle Size",fullWidth:!0,value:ft,color:"secondary",onChange:En,inputProps:{min:1,step:1}})}),Object(re.jsx)("div",{className:o.subtitleSetting,children:Object(re.jsx)(se.a,{type:"color",label:"Subtitle Outline Color",fullWidth:!0,value:gt,color:"secondary",onChange:Pn})}),Object(re.jsx)("div",{className:o.subtitleSetting,children:Object(re.jsx)(se.a,{type:"number",label:"Subtitle Outline Thickness",fullWidth:!0,value:kt,onChange:In,inputProps:{min:0,step:1},color:"secondary"})}),Object(re.jsx)("div",{className:o.subtitleSetting,children:Object(re.jsx)(se.a,{type:"color",label:"Subtitle Background Color",fullWidth:!0,value:St,color:"secondary",onChange:Mn})}),Object(re.jsx)("div",{className:o.subtitleSetting,children:Object(re.jsx)(se.a,{type:"number",label:"Subtitle Background Opacity",fullWidth:!0,inputProps:{min:0,max:1,step:.1},value:Et,color:"secondary",onChange:Rn})}),Object(re.jsx)("div",{className:o.subtitleSetting,children:Object(re.jsx)(se.a,{type:"text",label:"Subtitle Font Family",placeholder:"Inherited",fullWidth:!0,value:Rt,color:"secondary",onChange:Dn})}),Object(re.jsx)("div",{className:o.subtitleSetting,children:Object(re.jsx)(se.a,{type:"number",label:"Image-based Subtitle Scale Factor",placeholder:"Inherited",fullWidth:!0,inputProps:{min:0,max:1,step:.1},value:Bt,color:"secondary",onChange:_n})}),Object(re.jsx)("div",{className:o.subtitlePreview,children:Object(re.jsx)("input",{value:Ut,className:o.subtitlePreviewInput,onChange:An,style:Vn})})]})]}),Object(re.jsxs)(Se.a,{item:!0,children:[Object(re.jsx)(Na.a,{children:"Theme"}),Object(re.jsxs)("div",{children:[Object(re.jsx)(Aa.a,{control:Object(re.jsx)(qa.a,{checked:"light"===Vt,value:"light",onChange:Wn}),label:"Light"}),Object(re.jsx)(Aa.a,{control:Object(re.jsx)(qa.a,{checked:"dark"===Vt,value:"dark",onChange:Wn}),label:"Dark"})]})]})]})}),Object(re.jsx)(ke.a,{children:Object(re.jsx)(je.a,{onClick:Gn,children:"OK"})})]})]})}var Qa=I.atEnd,$a="ankiConnectUrl",Za="deck",er="noteType",tr="sentenceField",nr="definitionField",ar="audioField",rr="imageField",ir="wordField",or="sourceField",cr="urlField",sr="customAnkiFields",ur="tags",lr="subtitleSize",dr="subtitleColor",br="subtitleOutlineThickness",fr="subtitleOutlineColor",hr="subtitleBackgroundColor",vr="subtitleBackgroundOpacity",pr="subtitleFontFamily",gr="subtitlePreview",jr="imageBasedSubtitleScaleFactor",mr="audioPaddingStart",Or="audioPaddingEnd",kr="maxImageWidth",xr="maxImageHeight",yr="volume",wr="theaterMode",Sr="preferMp3",Cr="themeType",Tr="copyToClipboardOnMine",Fr="autoPausePreference",Er=function(){function e(){Object(x.a)(this,e),this._tags=void 0,this._tags=this.tags}return Object(y.a)(e,[{key:"settings",get:function(){return{ankiConnectUrl:this.ankiConnectUrl,deck:this.deck,noteType:this.noteType,sentenceField:this.sentenceField,definitionField:this.definitionField,audioField:this.audioField,imageField:this.imageField,wordField:this.wordField,urlField:this.urlField,customAnkiFields:this.customAnkiFields,tags:this.tags,sourceField:this.sourceField,subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity,subtitleFontFamily:this.subtitleFontFamily,subtitlePreview:this.subtitlePreview,imageBasedSubtitleScaleFactor:this.imageBasedSubtitleScaleFactor,preferMp3:this.preferMp3,themeType:this.themeType,audioPaddingStart:this.audioPaddingStart,audioPaddingEnd:this.audioPaddingEnd,maxImageWidth:this.maxImageWidth,maxImageHeight:this.maxImageHeight,surroundingSubtitlesCountRadius:this.surroundingSubtitlesCountRadius,surroundingSubtitlesTimeRadius:this.surroundingSubtitlesTimeRadius,volume:this.volume,theaterMode:this.theaterMode,copyToClipboardOnMine:this.copyToClipboardOnMine,autoPausePreference:this.autoPausePreference}},set:function(e){this.ankiConnectUrl=e.ankiConnectUrl,this.deck=e.deck,this.noteType=e.noteType,this.sentenceField=e.sentenceField,this.definitionField=e.definitionField,this.audioField=e.audioField,this.imageField=e.imageField,this.wordField=e.wordField,this.sourceField=e.sourceField,this.urlField=e.urlField,this.tags=e.tags,this.subtitleSize=e.subtitleSize,this.subtitleColor=e.subtitleColor,this.subtitleOutlineThickness=e.subtitleOutlineThickness,this.subtitleOutlineColor=e.subtitleOutlineColor,this.subtitleBackgroundColor=e.subtitleBackgroundColor,this.subtitleBackgroundOpacity=e.subtitleBackgroundOpacity,this.subtitleFontFamily=e.subtitleFontFamily,this.subtitlePreview=e.subtitlePreview,this.imageBasedSubtitleScaleFactor=e.imageBasedSubtitleScaleFactor,this.customAnkiFields=e.customAnkiFields,this.preferMp3=e.preferMp3,this.themeType=e.themeType,this.audioPaddingStart=e.audioPaddingStart,this.audioPaddingEnd=e.audioPaddingEnd,this.maxImageWidth=e.maxImageWidth,this.maxImageHeight=e.maxImageHeight,this.volume=e.volume,this.theaterMode=e.theaterMode,this.copyToClipboardOnMine=e.copyToClipboardOnMine,this.autoPausePreference=e.autoPausePreference}},{key:"subtitleSettings",get:function(){return{subtitleSize:this.subtitleSize,subtitleColor:this.subtitleColor,subtitleOutlineThickness:this.subtitleOutlineThickness,subtitleOutlineColor:this.subtitleOutlineColor,subtitleBackgroundColor:this.subtitleBackgroundColor,subtitleBackgroundOpacity:this.subtitleBackgroundOpacity,subtitleFontFamily:this.subtitleFontFamily,imageBasedSubtitleScaleFactor:this.imageBasedSubtitleScaleFactor}}},{key:"ankiSettings",get:function(){return{ankiConnectUrl:this.ankiConnectUrl,deck:this.deck,noteType:this.noteType,sentenceField:this.sentenceField,definitionField:this.definitionField,audioField:this.audioField,imageField:this.imageField,wordField:this.wordField,sourceField:this.sourceField,urlField:this.urlField,customAnkiFields:this.customAnkiFields,tags:this.tags,preferMp3:this.preferMp3,audioPaddingStart:this.audioPaddingStart,audioPaddingEnd:this.audioPaddingEnd,maxImageWidth:this.maxImageWidth,maxImageHeight:this.maxImageHeight,surroundingSubtitlesCountRadius:this.surroundingSubtitlesCountRadius,surroundingSubtitlesTimeRadius:this.surroundingSubtitlesTimeRadius}}},{key:"miscSettings",get:function(){return{themeType:this.themeType,copyToClipboardOnMine:this.copyToClipboardOnMine,autoPausePreference:this.autoPausePreference}}},{key:"_getNumberItem",value:function(e,t){var n=localStorage.getItem(e);return null===n?t:Number(n)}},{key:"_setOptionalItem",value:function(e,t){"undefined"===typeof t?localStorage.removeItem(e):localStorage.setItem(e,t)}},{key:"ankiConnectUrl",get:function(){return localStorage.getItem($a)||"http://127.0.0.1:8765"},set:function(e){localStorage.setItem($a,e)}},{key:"deck",get:function(){var e;return null!==(e=localStorage.getItem(Za))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(Za,e)}},{key:"noteType",get:function(){var e;return null!==(e=localStorage.getItem(er))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(er,e)}},{key:"sentenceField",get:function(){var e;return null!==(e=localStorage.getItem(tr))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(tr,e)}},{key:"definitionField",get:function(){var e;return null!==(e=localStorage.getItem(nr))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(nr,e)}},{key:"audioField",get:function(){var e;return null!==(e=localStorage.getItem(ar))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(ar,e)}},{key:"imageField",get:function(){var e;return null!==(e=localStorage.getItem(rr))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(rr,e)}},{key:"wordField",get:function(){var e;return null!==(e=localStorage.getItem(ir))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(ir,e)}},{key:"sourceField",get:function(){var e;return null!==(e=localStorage.getItem(or))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(or,e)}},{key:"urlField",get:function(){var e;return null!==(e=localStorage.getItem(cr))&&void 0!==e?e:void 0},set:function(e){this._setOptionalItem(cr,e)}},{key:"customAnkiFields",get:function(){var e=localStorage.getItem(sr);return e?JSON.parse(e):{}},set:function(e){localStorage.setItem(sr,JSON.stringify(e))}},{key:"tags",get:function(){if("undefined"!==typeof this._tags)return this._tags;var e=localStorage.getItem(ur);return e?(this._tags=JSON.parse(e),this._tags):[]},set:function(e){localStorage.setItem(ur,JSON.stringify(e)),this._tags=void 0}},{key:"subtitleColor",get:function(){return localStorage.getItem(dr)||"#ffffff"},set:function(e){localStorage.setItem(dr,e)}},{key:"subtitleSize",get:function(){return this._getNumberItem(lr,36)},set:function(e){localStorage.setItem(lr,String(e))}},{key:"subtitleOutlineColor",get:function(){return localStorage.getItem(fr)||"#000000"},set:function(e){localStorage.setItem(fr,e)}},{key:"subtitleOutlineThickness",get:function(){return this._getNumberItem(br,0)},set:function(e){localStorage.setItem(br,String(e))}},{key:"subtitleBackgroundColor",get:function(){return localStorage.getItem(hr)||"#000000"},set:function(e){localStorage.setItem(hr,e)}},{key:"subtitleBackgroundOpacity",get:function(){return this._getNumberItem(vr,.5)},set:function(e){localStorage.setItem(vr,String(e))}},{key:"subtitleFontFamily",get:function(){return localStorage.getItem(pr)||""},set:function(e){localStorage.setItem(pr,e)}},{key:"subtitlePreview",get:function(){return localStorage.getItem(gr)||"\u30a2\u3042\u5b89"},set:function(e){localStorage.setItem(gr,e)}},{key:"imageBasedSubtitleScaleFactor",get:function(){return this._getNumberItem(jr,1)},set:function(e){localStorage.setItem(jr,String(e))}},{key:"volume",get:function(){return this._getNumberItem(yr,100)},set:function(e){localStorage.setItem(yr,String(e))}},{key:"theaterMode",get:function(){return"true"===localStorage.getItem(wr)||!1},set:function(e){localStorage.setItem(wr,String(e))}},{key:"preferMp3",get:function(){return"true"===localStorage.getItem(Sr)||!1},set:function(e){localStorage.setItem(Sr,String(e))}},{key:"themeType",get:function(){var e=localStorage.getItem(Cr);return null===e?"dark":e},set:function(e){localStorage.setItem(Cr,e)}},{key:"audioPaddingStart",get:function(){var e=localStorage.getItem(mr);return e?Number(e):0},set:function(e){localStorage.setItem(mr,String(e))}},{key:"audioPaddingEnd",get:function(){return this._getNumberItem(Or,500)},set:function(e){localStorage.setItem(Or,String(e))}},{key:"maxImageWidth",get:function(){var e=localStorage.getItem(kr);return e?Number(e):0},set:function(e){localStorage.setItem(kr,String(e))}},{key:"maxImageHeight",get:function(){return this._getNumberItem(xr,0)},set:function(e){localStorage.setItem(xr,String(e))}},{key:"surroundingSubtitlesCountRadius",get:function(){return 1}},{key:"surroundingSubtitlesTimeRadius",get:function(){return 5e3}},{key:"copyToClipboardOnMine",get:function(){return"true"===localStorage.getItem(Tr)||!1},set:function(e){localStorage.setItem(Tr,String(e))}},{key:"autoPausePreference",get:function(){return this._getNumberItem(Fr,Qa)},set:function(e){localStorage.setItem(Fr,String(e))}}]),e}(),Pr=n(183),Ir=function(){function e(t){Object(x.a)(this,e),this.channel=void 0,this.time=void 0,this.duration=void 0,this.readyCallbacks=void 0,this.playCallbacks=void 0,this.pauseCallbacks=void 0,this.currentTimeCallbacks=void 0,this.audioTrackSelectedCallbacks=void 0,this.closeCallbacks=void 0,this.subtitlesCallbacks=void 0,this.playModeCallbacks=void 0,this.hideSubtitlePlayerToggleCallbacks=void 0,this.appBarToggleCallbacks=void 0,this.ankiDialogRequestCallbacks=void 0,this.finishedAnkiDialogRequestCallbacks=void 0,this.channel=new BroadcastChannel(t),this.time=0,this.duration=0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.finishedAnkiDialogRequestCallbacks=[];var n=this;this.channel.onmessage=function(e){switch(e.data.command){case"init":case"subtitleSettings":case"ankiSettings":case"miscSettings":break;case"ready":var t,a=e.data,i=Object(r.a)(n.readyCallbacks);try{for(i.s();!(t=i.n()).done;){(0,t.value)(a.duration)}}catch(A){i.e(A)}finally{i.f()}break;case"play":var o,c=Object(r.a)(n.playCallbacks);try{for(c.s();!(o=c.n()).done;){(0,o.value)()}}catch(A){c.e(A)}finally{c.f()}break;case"pause":var s,u=Object(r.a)(n.pauseCallbacks);try{for(u.s();!(s=u.n()).done;){(0,s.value)()}}catch(A){u.e(A)}finally{u.f()}break;case"currentTime":var l,d=e.data,b=Object(r.a)(n.currentTimeCallbacks);try{for(b.s();!(l=b.n()).done;){(0,l.value)(d.value)}}catch(A){b.e(A)}finally{b.f()}break;case"audioTrackSelected":var f,h=e.data,v=Object(r.a)(n.audioTrackSelectedCallbacks);try{for(v.s();!(f=v.n()).done;){(0,f.value)(h.id)}}catch(A){v.e(A)}finally{v.f()}break;case"close":var p,g=Object(r.a)(n.closeCallbacks);try{for(g.s();!(p=g.n()).done;){(0,p.value)()}}catch(A){g.e(A)}finally{g.f()}break;case"subtitles":var j,m=e.data,O=Object(r.a)(n.subtitlesCallbacks);try{for(O.s();!(j=O.n()).done;){(0,j.value)(m.value)}}catch(A){O.e(A)}finally{O.f()}break;case"playMode":var k,x=e.data,y=Object(r.a)(n.playModeCallbacks);try{for(y.s();!(k=y.n()).done;){(0,k.value)(x.playMode)}}catch(A){y.e(A)}finally{y.f()}break;case"hideSubtitlePlayerToggle":var w,S=e.data,C=Object(r.a)(n.hideSubtitlePlayerToggleCallbacks);try{for(C.s();!(w=C.n()).done;){(0,w.value)(S.value)}}catch(A){C.e(A)}finally{C.f()}break;case"appBarToggle":var T,F=e.data,E=Object(r.a)(n.appBarToggleCallbacks);try{for(E.s();!(T=E.n()).done;){(0,T.value)(F.value)}}catch(A){E.e(A)}finally{E.f()}break;case"ankiDialogRequest":var P,I=Object(r.a)(n.ankiDialogRequestCallbacks);try{for(I.s();!(P=I.n()).done;){(0,P.value)()}}catch(A){I.e(A)}finally{I.f()}break;case"finishedAnkiDialogRequest":var M,R=e.data,D=Object(r.a)(n.finishedAnkiDialogRequestCallbacks);try{for(D.s();!(M=D.n()).done;){(0,M.value)(R.resume)}}catch(A){D.e(A)}finally{D.f()}break;default:console.error("Unrecognized event "+e.data.command)}}}return Object(y.a)(e,[{key:"currentTime",set:function(e){var t;this.time=e,null===(t=this.channel)||void 0===t||t.postMessage({command:"currentTime",value:this.time,echo:!0})}},{key:"onPlay",value:function(e){this.playCallbacks.push(e)}},{key:"onPause",value:function(e){this.pauseCallbacks.push(e)}},{key:"onCurrentTime",value:function(e){this.currentTimeCallbacks.push(e)}},{key:"onAudioTrackSelected",value:function(e){this.audioTrackSelectedCallbacks.push(e)}},{key:"onClose",value:function(e){this.closeCallbacks.push(e)}},{key:"onReady",value:function(e){this.readyCallbacks.push(e)}},{key:"onSubtitles",value:function(e){this.subtitlesCallbacks.push(e)}},{key:"onPlayMode",value:function(e){this.playModeCallbacks.push(e)}},{key:"onHideSubtitlePlayerToggle",value:function(e){this.hideSubtitlePlayerToggleCallbacks.push(e)}},{key:"onAppBarToggle",value:function(e){this.appBarToggleCallbacks.push(e)}},{key:"onAnkiDialogRequest",value:function(e){this.ankiDialogRequestCallbacks.push(e)}},{key:"onFinishedAnkiDialogRequest",value:function(e){this.finishedAnkiDialogRequestCallbacks.push(e)}},{key:"ready",value:function(e,t,n,a){var r,i={command:"ready",duration:e,paused:t,currentTime:0,audioTracks:n,selectedAudioTrack:a,playbackRate:1};null===(r=this.channel)||void 0===r||r.postMessage(i)}},{key:"readyState",value:function(e){var t,n={command:"readyState",value:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"play",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"play",echo:!0})}},{key:"pause",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"pause",echo:!0})}},{key:"audioTrackSelected",value:function(e){var t,n={command:"audioTrackSelected",id:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"offset",value:function(e){var t,n={command:"offset",value:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"popOutToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"popOutToggle"})}},{key:"copy",value:function(e,t,n,a){var r,i={command:"copy",subtitle:e,surroundingSubtitles:t,preventDuplicate:a,postMineAction:n};null===(r=this.channel)||void 0===r||r.postMessage(i)}},{key:"playMode",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t;null===(t=this.channel)||void 0===t||t.postMessage({command:"playMode",playMode:e})}))},{key:"hideSubtitlePlayerToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"hideSubtitlePlayerToggle"})}},{key:"appBarToggle",value:function(){var e;null===(e=this.channel)||void 0===e||e.postMessage({command:"appBarToggle"})}},{key:"ankiDialogRequest",value:function(e){var t,n={command:"ankiDialogRequest",forwardToVideo:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"toggleSubtitleTrackInList",value:function(e){var t,n={command:"toggleSubtitleTrackInList",track:e};null===(t=this.channel)||void 0===t||t.postMessage(n)}},{key:"close",value:function(){this.channel&&(this.channel.postMessage({command:"exit"}),this.channel.close(),this.channel=void 0,this.playCallbacks=[],this.pauseCallbacks=[],this.currentTimeCallbacks=[],this.audioTrackSelectedCallbacks=[],this.closeCallbacks=[],this.readyCallbacks=[],this.subtitlesCallbacks=[],this.playModeCallbacks=[],this.hideSubtitlePlayerToggleCallbacks=[],this.appBarToggleCallbacks=[],this.ankiDialogRequestCallbacks=[],this.finishedAnkiDialogRequestCallbacks=[])}}]),e}(),Mr=Object(p.a)({root:{position:"relative",backgroundColor:"black",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},video:{margin:"auto"},cursorHidden:{cursor:"none"},subtitleContainer:{position:"absolute",paddingLeft:20,paddingRight:20,bottom:100,textAlign:"center",whiteSpace:"pre-wrap",lineHeight:"normal"}});function Rr(e,t,n,a){if(window.outerWidth&&e.videoWidth>0&&e.videoHeight>0){var i=window.screen.availWidth-(window.outerWidth-window.innerWidth),o=window.screen.availHeight-(window.outerHeight-window.innerHeight),c=Math.min(1,Math.min(i/e.videoWidth,o/e.videoHeight));window.resizeTo(c*e.videoWidth+(window.outerWidth-window.innerWidth),c*e.videoHeight+(window.outerHeight-window.innerHeight))}var s,u;if(e.audioTracks){s=[];var l,d=Object(r.a)(e.audioTracks);try{for(d.s();!(l=d.n()).done;){var b=l.value;s.push({id:b.id,label:b.label,language:b.language}),b.enabled&&(u=b.id)}}catch(f){d.e(f)}finally{d.f()}}else s=void 0,u=void 0;n(s),a(u),t.ready(e.duration,e.paused,s,u)}function Dr(e){var t=Mr(),n=e.settingsProvider,a=e.videoFile,i=e.channel,u=e.popOut,l=e.onError,h=e.onAutoPauseModeChangedViaBind,v=Object(b.useRef)(),p=Object(b.useRef)(),g=m(!0),j=Object(s.a)(g,2),O=j[0],k=j[1];p.current&&(p.current.width=O,p.current.height=k);var x=Object(b.useMemo)((function(){return new Ir(i)}),[i]),y=Object(b.useState)(!1),w=Object(s.a)(y,2),S=w[0],C=w[1],F=function(){var e=Object(b.useState)(Boolean(document.fullscreenElement)),t=Object(s.a)(e,2),n=t[0],a=t[1];return Object(b.useEffect)((function(){var e=function(){return a(Boolean(document.fullscreenElement))};return document.addEventListener("fullscreenchange",e),function(){return document.removeEventListener("fullscreenchange",e)}}),[]),n}(),E=Object(b.useRef)();E.current=F;var I=Object(b.useRef)();I.current=S;var R=Object(b.useState)(0),D=Object(s.a)(R,2),A=D[0],_=D[1],B=Object(b.useState)(0),N=Object(s.a)(B,2),L=N[0],H=N[1],U=Object(b.useState)(),W=Object(s.a)(U,2),q=W[0],z=W[1],V=Object(b.useState)(),G=Object(s.a)(V,2),K=G[0],X=G[1],J=Object(b.useState)([]),Z=Object(s.a)(J,2),ee=Z[0],te=Z[1],ne=Object(b.useState)([]),ae=Object(s.a)(ne,2),ie=ae[0],ce=ae[1],se=Object(b.useState)(!0),ue=Object(s.a)(se,2),le=ue[0],de=ue[1],be=Object(b.useState)({}),fe=Object(s.a)(be,2),he=fe[0],ve=fe[1],pe=Object(b.useState)(M.normal),ge=Object(s.a)(pe,2),je=ge[0],me=ge[1],Oe=Object(b.useState)(!1),ke=Object(s.a)(Oe,2),xe=ke[0],ye=ke[1],we=Object(b.useState)(n.theaterMode),Se=Object(s.a)(we,2),Ce=Se[0],Te=Se[1],Fe=Object(b.useRef)([]);Fe.current=ie;var Ee=Object(b.useMemo)((function(){return new Cn}),[]),Pe=Object(b.useRef)({x:0,y:0}),Ie=Object(b.useState)(!1),Me=Object(s.a)(Ie,2),Re=Me[0],De=Me[1],Ae=Object(b.useRef)(0),_e=Object(b.useRef)(null),Be=Object(b.useState)(),Ne=Object(s.a)(Be,2),Le=Ne[0],He=Ne[1],We=Object(b.useState)(!1),qe=Object(s.a)(We,2),ze=qe[0],Ve=qe[1],Ge=Object(b.useState)(!1),Ke=Object(s.a)(Ge,2),Xe=Ke[0],Je=Ke[1],Ye=Object(b.useRef)();Ye.current=Xe;var Qe=Object(b.useCallback)((function(e){if(e){var t=e;p.current=t,4===t.readyState?Rr(t,x,z,X):t.onloadeddata=function(e){Rr(t,x,z,X)},t.oncanplay=function(e){x.readyState(4),I.current&&Ee.start()},t.ontimeupdate=function(t){return Ee.setTime(1e3*e.currentTime)},t.onerror=function(t){return l(function(e){var t,n,a;switch(null===(t=e.error)||void 0===t?void 0:t.code){case 1:a="Aborted";break;case 2:a="Network error";break;case 3:a="Decoding error";break;case 4:a="Source not supported";break;default:a="Unknown error"}return a+": "+((null===(n=e.error)||void 0===n?void 0:n.message)||"<details missing>")}(e))}}}),[Ee,x,l]);function $e(e){var t,n=null===(t=p.current)||void 0===t?void 0:t.audioTracks;if(n){var a,i=Object(r.a)(n);try{for(i.s();!(a=i.n()).done;){var o=a.value;o.id===e?o.enabled=!0:o.enabled=!1}}catch(c){i.e(c)}finally{i.f()}}}Object(b.useEffect)((function(){return x.onReady((function(e){return _(e)})),x.onPlay(Object(c.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=p.current)||void 0===t?void 0:t.play();case 2:Ee.start(),C(!0);case 4:case"end":return e.stop()}}),e)})))),x.onPause((function(){var e;null===(e=p.current)||void 0===e||e.pause(),Ee.stop(),C(!1)})),x.onCurrentTime((function(e){var t;p.current&&(p.current.currentTime=e),4===(null===(t=p.current)||void 0===t?void 0:t.readyState)&&x.readyState(4),Ee.stop(),Ee.setTime(1e3*e)})),x.onAudioTrackSelected((function(e){$e(e),X(e),x.audioTrackSelected(e)})),x.onClose((function(){x.close(),window.close()})),x.onSubtitles((function(e){if(te(e),e&&e.length>0){var t=e[0],n=t.start-t.originalStart;H(n)}})),x.onPlayMode((function(e){return me(e)})),x.onHideSubtitlePlayerToggle((function(e){return ye(e)})),x.onAppBarToggle((function(e){return Te(e)})),x.onAnkiDialogRequest((function(){E.current&&!u&&(document.exitFullscreen(),Je(!0))})),x.onFinishedAnkiDialogRequest(function(){var e=Object(c.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ye.current){e.next=11;break}if(!t){e.next=10;break}return e.prev=2,e.next=5,null===(n=_e.current)||void 0===n?void 0:n.requestFullscreen();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.error(e.t0);case 10:Je(!1);case 11:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()),window.onbeforeunload=function(e){v.current||x.close()},function(){return x.close()}}),[Ee,x,u]);var Ze=Object(b.useCallback)((function(){p.current&&x.play()}),[x]),et=Object(b.useCallback)((function(){return x.pause()}),[x]),tt=Object(b.useCallback)((function(e){I.current&&Ee.stop();var t=e*A;x.currentTime=t/1e3}),[A,Ee,x]);var nt=Object(b.useCallback)((function(e){I.current&&(Ee.stop(),x.pause()),$e(e),X(e),x.currentTime=0,x.audioTrackSelected(e)}),[x,Ee]);Object(b.useEffect)((function(){if(ee&&0!==ee.length){var e=setInterval((function(){for(var e=Ee.time(A),t=[],n=0;n<ee.length;++n){var a=ee[n];if(e>=a.start&&e<a.end&&!he[a.track]&&t.push(Object(o.a)(Object(o.a)({},a),{},{index:n})),e<a.start)break}(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e.length!==t.length)return!1;for(var a=0;a<e.length;++a)if(!n(e[a],t[a]))return!1;return!0})(t=t.sort((function(e,t){return e.track-t.track})),Fe.current,(function(e,t){return e.index===t.index}))||ce(t)}),50);return function(){return clearTimeout(e)}}}),[ee,he,Ee,A]);var at=Object(b.useCallback)((function(e){H(e),te((function(t){return t.map((function(t){return{text:t.text,textImage:t.textImage,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd,track:t.track}}))})),x.offset(e)}),[x]);Object(b.useEffect)((function(){var e=T.bindSeekToSubtitle((function(e,t){e.stopPropagation(),e.preventDefault(),x.currentTime=t.start/1e3}),(function(){return!p.current}),(function(){return Ee.time(A)}),(function(){return ee}));return function(){return e()}}),[x,ee,A,Ee]),Object(b.useEffect)((function(){var e=T.bindSeekToBeginningOfCurrentSubtitle((function(e,t){e.stopPropagation(),e.preventDefault(),x.currentTime=t.start/1e3}),(function(){return!p.current}),(function(){return Ee.time(A)}),(function(){return ee}));return function(){return e()}}),[x,ee,A,Ee]),Object(b.useEffect)((function(){var e=T.bindSeekBackwardOrForward((function(e,t){e.stopPropagation(),e.preventDefault();var n=Ee.time(A);x.currentTime=t?Math.min(A/1e3,(n+1e4)/1e3):Math.max(0,(n-1e4)/1e3)}),(function(){return!p.current}));return function(){return e()}}),[x,A,Ee]);var rt=Object(b.useCallback)((function(e){return Q(ee,e,n.surroundingSubtitlesCountRadius,n.surroundingSubtitlesTimeRadius)}),[ee,n.surroundingSubtitlesCountRadius,n.surroundingSubtitlesTimeRadius]);Object(b.useEffect)((function(){var e=T.bindCopy((function(e,t){e.stopPropagation(),e.preventDefault();var n=!ee||0===ee.length;x.copy(t,n?$(t,A,5e3):rt(t.index),P.none),F&&(He(""===t.text?"Saved ".concat(Y(t.start)):'Copied: "'.concat(t.text,'"')),Ve(!0))}),(function(){return!1}),(function(){if(!ee||0===ee.length){var e=Ee.time(A),t=Math.min(e+5e3,A);return{text:"",start:e,originalStart:e,end:t,originalEnd:t,track:0,index:0}}if(Fe.current&&0!==Fe.current.length)return Fe.current[0]}));return function(){return e()}}),[x,Ee,A,ee,rt,F]),Object(b.useEffect)((function(){var e=T.bindAdjustOffset((function(e,t){e.preventDefault(),e.stopPropagation(),at(t)}),(function(){return!1}),(function(){return ee}));return function(){return e()}}),[at,ee]),Object(b.useEffect)((function(){var e=T.bindToggleSubtitles((function(e){e.preventDefault(),e.stopPropagation(),de((function(e){return!e}))}),(function(){}),(function(){return!1}));return function(){return e()}}),[]),Object(b.useEffect)((function(){var e=T.bindToggleSubtitleTrackInVideo((function(e,t){e.preventDefault(),e.stopPropagation(),ve((function(e){var n=Object(o.a)({},e);return n[t]=!e[t],n}))}),(function(){}),(function(){return!1}));return function(){return e()}}),[]),Object(b.useEffect)((function(){var e=T.bindToggleSubtitleTrackInList((function(e,t){e.preventDefault(),e.stopPropagation(),x.toggleSubtitleTrackInList(t)}),(function(){}),(function(){return!1}));return function(){return e()}}),[x]),Object(b.useEffect)((function(){var e=T.bindOffsetToSubtitle((function(e,t){e.preventDefault(),e.stopPropagation(),at(t)}),(function(){return!1}),(function(){return Ee.time(A)}),(function(){return ee}));return function(){return e()}}),[at,ee,Ee,A]);var it=Object(b.useCallback)((function(e,t){if(ee&&0!==ee.length){if(Fe.current&&Fe.current.length>0){var n=Fe.current[0];t(n,rt(n.index))}}else{var a=Ee.time(A),r=Math.min(a+5e3,A),i={text:"",start:a,originalStart:a,end:r,originalEnd:r,track:0};e(i,$(i,A,5e3))}}),[ee,rt,A,Ee]);Object(b.useEffect)((function(){return T.bindAnkiExport((function(e){e.preventDefault(),e.stopPropagation(),it((function(e,t){return x.copy(e,t,P.showAnkiDialog,!1)}),(function(e,t){return x.copy(e,t,P.showAnkiDialog,!0)}))}),(function(){return!1}))}),[x,it,F]),Object(b.useEffect)((function(){return T.bindUpdateLastCard((function(e){e.preventDefault(),e.stopPropagation(),it((function(e,t){return x.copy(e,t,P.updateLastCard,!1)}),(function(e,t){return x.copy(e,t,P.updateLastCard,!0)}))}),(function(){return!1}))}),[x,it]),Object(b.useEffect)((function(){var e=T.bindPlay((function(e){e.preventDefault(),S?x.pause():x.play()}),(function(){return!1}));return function(){return e()}}),[S,x]),Object(b.useEffect)((function(){return T.bindAutoPause((function(e){e.preventDefault();var t=je===M.autoPause?M.normal:M.autoPause;x.playMode(t),h(t)}),(function(){return!1}))}),[x,je,h]);var ot=Object(b.useCallback)((function(){return de((function(e){return!e}))}),[]),ct=Object(b.useCallback)((function(){var e;F?document.exitFullscreen():null===(e=_e.current)||void 0===e||e.requestFullscreen()}),[F]),st=Object(b.useCallback)((function(e){p.current&&(p.current.volume=e)}),[]),ut=Object(b.useCallback)((function(){x.popOutToggle(),u&&(v.current=!0,window.close())}),[x,u]),lt=Object(b.useCallback)((function(e){x.playMode(e)}),[x]),dt=Object(b.useCallback)((function(){x.close(),window.close()}),[x]),bt=Object(b.useCallback)((function(){x.hideSubtitlePlayerToggle()}),[x]),ft=Object(b.useCallback)((function(){x.appBarToggle()}),[x]),ht=Object(b.useCallback)((function(){S?x.pause():x.play()}),[x,S]),vt=Object(b.useCallback)((function(){return ct()}),[ct]),pt=Object(b.useCallback)((function(){return Ve(!1)}),[]),gt=n.subtitleSettings,jt=gt.subtitleSize,mt=gt.subtitleColor,Ot=gt.subtitleOutlineThickness,kt=gt.subtitleOutlineColor,xt=gt.subtitleBackgroundColor,yt=gt.subtitleBackgroundOpacity,wt=gt.subtitleFontFamily,St=gt.imageBasedSubtitleScaleFactor,Ct=Object(b.useMemo)((function(){return Qt({subtitleSize:jt,subtitleColor:mt,subtitleOutlineThickness:Ot,subtitleOutlineColor:kt,subtitleBackgroundColor:xt,subtitleBackgroundOpacity:yt,subtitleFontFamily:wt})}),[jt,mt,Ot,kt,xt,yt,wt]);return Object(b.useEffect)((function(){var e=setInterval((function(){Date.now()-Ae.current>300?Re&&De(!1):Re||De(!0)}),100);return function(){return clearInterval(e)}}),[Re]),Object(re.jsxs)("div",{ref:_e,onMouseMove:function(e){if(Ae.current=Date.now(),_e.current){var t=_e.current.getBoundingClientRect();Pe.current.x=e.clientX-t.left,Pe.current.y=e.clientY-t.top}},className:t.root,children:[Object(re.jsx)("video",{preload:"auto",controls:!1,onClick:ht,onDoubleClick:vt,className:Re?t.video:"".concat(t.cursorHidden," ").concat(t.video),ref:Qe,src:a}),le&&Object(re.jsx)("div",{className:t.subtitleContainer,children:ie.map((function(e,t){var n,a,r;e.textImage?n=Object(re.jsx)(Ue,{availableWidth:null!==(a=null===(r=p.current)||void 0===r?void 0:r.width)&&void 0!==a?a:window.screen.availWidth,subtitle:e,scale:St}):n=Object(re.jsx)("span",{style:Ct,children:e.text});return t<ie.length-1?Object(re.jsxs)(f.a.Fragment,{children:[n,Object(re.jsx)("br",{})]},e.index):Object(re.jsx)(f.a.Fragment,{children:n},e.index)}))}),F&&Object(re.jsx)(oe,{open:ze,onClose:pt,autoHideDuration:3e3,severity:"success",children:Le}),Object(re.jsx)(va,{mousePositionRef:Pe,playing:S,clock:Ee,length:A,audioTracks:q,selectedAudioTrack:K,subtitlesToggle:ee&&ee.length>0,subtitlesEnabled:le,offsetEnabled:!0,offset:L,fullscreenEnabled:!0,fullscreen:F,closeEnabled:!u,popOut:u,volumeEnabled:!0,popOutEnabled:!Pr.isMobile,playModeEnabled:!0,playMode:je,hideSubtitlePlayerToggleEnabled:(null===ee||void 0===ee?void 0:ee.length)>0&&!u&&!F,subtitlePlayerHidden:xe,onPlay:Ze,onPause:et,onSeek:tt,onAudioTrackSelected:nt,onSubtitlesToggle:ot,onFullscreenToggle:ct,onVolumeChange:st,onOffsetChange:at,onPopOutToggle:ut,onPlayMode:lt,onClose:dt,onHideSubtitlePlayerToggle:bt,settingsProvider:n,showOnMouseMovement:!1,theaterModeToggleEnabled:!u,theaterModeEnabled:Ce,onTheaterModeToggle:ft})]})}var Ar=Object(p.a)((function(e){return{content:{flexGrow:1,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginRight:0},contentShift:function(t){var n=t.drawerWidth;return{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:n}}}}));function _r(e,t,n,a){if(e.audio){var r,i,o,c,s=null!==(r=e.audio.start)&&void 0!==r?r:e.start,u=null!==(i=e.audio.end)&&void 0!==i?i:e.end;return U.fromBase64(e.subtitleFile.name,Math.max(0,s-(null!==(o=e.audio.paddingStart)&&void 0!==o?o:0)),u+(null!==(c=e.audio.paddingEnd)&&void 0!==c?c:0),e.audio.base64,e.audio.extension)}var l,d;if(e.audioFile||e.videoFile)return t?(l=t.subtitleStart,d=t.subtitleEnd):(l=e.start,d=e.end),U.fromFile(e.audioFile||e.videoFile,Math.max(0,l-n),d+a,e.audioTrack)}function Br(e,t,n){return e.image?V.fromBase64(e.subtitleFile.name,e.start,e.image.base64,e.image.extension):e.videoFile?V.fromFile(e.videoFile,null!==(a=e.mediaTimestamp)&&void 0!==a?a:e.start,t,n):void 0;var a}function Nr(e){var t,n,a,r,i;if(e){var o=null!==(t=null!==(n=null===(a=e.subtitleFile)||void 0===a?void 0:a.name)&&void 0!==n?n:null===(r=e.audioFile)||void 0===r?void 0:r.name)&&void 0!==t?t:null===(i=e.videoFile)||void 0===i?void 0:i.name;if(o)return"".concat(o," (").concat(Y(e.start),")")}}function Lr(e){var t=e.searchParams,n=t.get("video"),a=t.get("channel"),r=t.get("popout");return Object(re.jsx)(h.a,{to:"/video?video="+encodeURIComponent(n)+"&channel="+a+"&popout="+r})}function Hr(e){var t=e.searchParams,n=e.settingsProvider,a=e.onError,r=e.onAutoPauseModeChangedViaBind,i=t.get("video"),o=t.get("channel"),c="true"===t.get("popout");return Object(re.jsx)(Dr,{settingsProvider:n,videoFile:i,popOut:c,channel:o,onError:a,onAutoPauseModeChangedViaBind:r})}function Ur(e){var t=Ar(e);return Object(re.jsx)("main",{className:Object(te.a)(t.content,Object(u.a)({},t.contentShift,e.drawerOpen)),children:e.children})}var Wr=function(){var e=Object(b.useMemo)((function(){return new Rt}),[]),t=Object(b.useMemo)((function(){return new Er}),[]),n=Object(b.useMemo)((function(){return Object(g.a)({palette:{primary:{main:"#49007a"},secondary:{main:"#ff1f62"},error:{main:k.a.A400},type:t.themeType}})}),[t.themeType]),a=Object(b.useMemo)((function(){return new J(t)}),[t]),u=Object(h.f)(),l=Object(v.b)(),f=Object(s.a)(l,1)[0],p="/video"===u.pathname||null!==f.get("video"),O=Object(b.useMemo)((function(){return new Yt}),[]),x=Object(b.useRef)(null),y=m(!p),w=Object(s.a)(y,1)[0],S=x.current?.2:.3,C=x.current?150:300,T=Math.max(C,w*S),F=Object(b.useState)([]),E=Object(s.a)(F,2),I=E[0],R=E[1],D=Object(b.useRef)([]);D.current=I;var A=Object(b.useState)(!1),_=Object(s.a)(A,2),B=_[0],N=_[1],L=Object(b.useState)(t.theaterMode),H=Object(s.a)(L,2),U=H[0],W=H[1],q=Object(b.useState)(!1),z=Object(s.a)(q,2),V=z[0],G=z[1],K=Object(b.useState)(),X=Object(s.a)(K,2),Q=X[0],$=X[1],Z=Object(b.useState)(!1),te=Object(s.a)(Z,2),ne=te[0],ae=te[1],ie=Object(b.useState)(),ce=Object(s.a)(ie,2),se=ce[0],ue=ce[1],le=Object(b.useState)(),de=Object(s.a)(le,2),be=de[0],fe=de[1],he=Object(b.useState)(),ve=Object(s.a)(he,2),ge=ve[0],je=ve[1],me=Object(b.useState)({subtitleFiles:[]}),Oe=Object(s.a)(me,2),ke=Oe[0],xe=Oe[1],ye=Object(b.useState)(!1),we=Object(s.a)(ye,2),Se=we[0],Ce=we[1],Te=Object(b.useState)(!1),Fe=Object(s.a)(Te,2),Ee=Fe[0],Pe=Fe[1],Ie=Object(b.useRef)(null),Me=Object(b.useState)(),Re=Object(s.a)(Me,2),De=Re[0],Ae=Re[1],_e=Object(b.useState)(!1),Be=Object(s.a)(_e,2),Ne=Be[0],Le=Be[1],He=Object(b.useState)(!1),Ue=Object(s.a)(He,2),We=Ue[0],qe=Ue[1],ze=Object(b.useState)(),Ve=Object(s.a)(ze,2),Ge=Ve[0],Ke=Ve[1],Xe=Object(b.useMemo)((function(){return Ge&&function(e){if(e)return{subtitleStart:e.start,subtitleEnd:e.end,subtitles:e.surroundingSubtitles||[{start:e.start,end:e.end,text:e.text,track:e.track}]}}(Ge)}),[Ge]),Je=Object(b.useMemo)((function(){return Ge&&_r(Ge,Xe,t.audioPaddingStart,t.audioPaddingEnd)}),[Ge,Xe,t.audioPaddingStart,t.audioPaddingEnd]),$e=Object(b.useMemo)((function(){return Ge&&Br(Ge,t.maxImageWidth,t.maxImageHeight)}),[Ge,t.maxImageWidth,t.maxImageHeight]),Ze=Object(b.useState)(),et=Object(s.a)(Ze,2),nt=et[0],at=et[1],rt=Object(b.useState)(!1),it=Object(s.a)(rt,2),ot=it[0],ct=it[1],st=Object(b.useState)({timestamp:0,resume:!1}),ut=Object(s.a)(st,2),lt=ut[0],dt=ut[1],bt=Object(b.useState)(!1),ft=Object(s.a)(bt,2),ht=ft[0],vt=ft[1],pt=Object(b.useState)(!1),gt=Object(s.a)(pt,2),jt=gt[0],mt=gt[1],Ot=Object(b.useState)(!1),kt=Object(s.a)(Ot,2),xt=kt[0],yt=kt[1],wt=Object(b.useState)(),St=Object(s.a)(wt,2),Ct=St[0],Tt=St[1],Ft=Object(b.useState)(),Et=Object(s.a)(Ft,2),Pt=Et[0],It=Et[1],Mt=Object(b.useState)([]),Dt=Object(s.a)(Mt,2),At=Dt[0],_t=Dt[1],Bt=Object(b.useRef)(null),Nt=Object(b.useRef)(!1);Nt.current=ot;var Lt=ke.subtitleFiles,Ht=Object(b.useCallback)((function(e){ue("error"),$(e),ae(!0)}),[]),Ut=Object(b.useCallback)((function(e,t){if(t||0!==D.current.length){var n=null!==t&&void 0!==t?t:D.current[D.current.length-1];Ke(n),Le(!0),qe(!1),yt(!0),ct(!0),e&&at(Date.now())}}),[]),Wt=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(t,n,r,i,o,c,s,u,l,b){var f;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return qe(!0),e.prev=1,e.next=4,a.export(t,n,r,i,o,c,s,u,l,b);case 4:f=e.sent,"gui"!==b&&("default"===b?(ue("success"),$("Exported card: "+f),ae(!0)):"updateLast"===b&&(ue("success"),$("Updated card: "+f),ae(!0)),Le(!1),Nt.current&&(dt({timestamp:Date.now(),resume:!0}),ct(!1))),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0),e.t0 instanceof Error?Ht(e.t0.message):Ht(String(e.t0));case 12:return e.prev=12,qe(!1),yt(!1),e.finish(12);case 16:case"end":return e.stop()}}),e,null,[[1,8,12,16]])})));return function(t,n,a,r,i,o,c,s,u,l){return e.apply(this,arguments)}}(),[a,Ht]),qt=Object(b.useCallback)((function(e,n,a,r,c,s,u,l,d,b,f,h,v,p){var g;e&&t.copyToClipboardOnMine&&navigator.clipboard.writeText(e.text);var j=Object(o.a)(Object(o.a)({},e),{},{surroundingSubtitles:n,timestamp:Date.now(),id:p||Object(ee.a)(),name:De,subtitleFile:c,audioFile:a,videoFile:r,mediaTimestamp:s,audioTrack:u,audio:l,image:d,url:b});switch(R((function(t){if(v&&t.length>0){var n,a=t[t.length-1];if(e.start===a.start&&e.end===a.end&&e.text===a.text&&(null===c||void 0===c?void 0:c.name)===(null===(n=a.subtitleFile)||void 0===n?void 0:n.name)){if(void 0!==s&&s!==a.mediaTimestamp){var r=Object(i.a)(t);return r[r.length-1]=j,r}return t}}return[].concat(Object(i.a)(t),[j])})),null!==f&&void 0!==f?f:P.none){case P.none:break;case P.showAnkiDialog:Ut(h,j);break;case P.updateLastCard:ct(!0),Wt(e.text,"",_r(j,void 0,t.audioPaddingStart,t.audioPaddingEnd),Br(j,t.maxImageWidth,t.maxImageHeight),"",null!==(g=Nr(j))&&void 0!==g?g:"","",{},t.tags,"updateLast");break;default:throw new Error("Unknown post mine action: "+f)}e&&(ue("success"),$(""===e.text?"Saved ".concat(Y(e.start)):'Copied: "'.concat(e.text,'"')),ae(!0))}),[De,t,Wt,Ut]),zt=Object(b.useCallback)((function(){return N((function(e){return!e}))}),[]),Vt=Object(b.useCallback)((function(){return N(!1)}),[]),Gt=Object(b.useCallback)((function(){t.theaterMode=!t.theaterMode,W(t.theaterMode)}),[t]),Kt=Object(b.useCallback)((function(){G((function(e){return!e}))}),[]),Xt=Object(b.useCallback)((function(){yt(!0),vt(!0)}),[]),Qt=Object(b.useCallback)((function(){return ae(!1)}),[]),$t=Object(b.useCallback)((function(){return mt(!1)}),[]),Zt=Object(b.useCallback)((function(e){t.settings=e,vt(!1),yt(Ne);var n={command:"subtitleSettings",value:t.subtitleSettings},a={command:"ankiSettings",value:t.ankiSettings},r={command:"miscSettings",value:t.miscSettings};O.publishMessage(n),O.publishMessage(a),O.publishMessage(r)}),[O,t,Ne]),en=Object(b.useCallback)((function(e){var t,n=[],a=Object(r.a)(I);try{for(a.s();!(t=a.n()).done;){var i=t.value;e.id!==i.id&&n.push(i)}}catch(o){a.e(o)}finally{a.f()}R(n)}),[I]),tn=Object(b.useCallback)((function(e){e===ke.audioFileUrl&&xe((function(t){return URL.revokeObjectURL(e),{subtitleFiles:t.subtitleFiles,audioFile:void 0,audioFileUrl:void 0,videoFile:t.videoFile,videoFileUrl:t.videoFileUrl}}))}),[ke]),nn=Object(b.useCallback)((function(e){e===ke.videoFileUrl&&xe((function(t){return URL.revokeObjectURL(e),{subtitleFiles:t.subtitleFiles,audioFile:t.audioFile,audioFileUrl:t.audioFileUrl,videoFile:void 0,videoFileUrl:void 0}}))}),[ke]),an=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(n){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_r(n,void 0,t.audioPaddingStart,t.audioPaddingEnd);case 3:a=e.sent,t.preferMp3?a.toMp3().download():a.download(),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.t0 instanceof Error?Ht(e.t0.message):Ht(String(e.t0));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),[Ht,t]),rn=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Br(n,t.maxImageWidth,t.maxImageHeight);case 3:e.sent.download(),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0),e.t0 instanceof Error?Ht(e.t0.message):Ht(String(e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),[Ht,t]),on=Object(b.useCallback)((function(e){var t;Lt.find((function(t){var n;return t.name===(null===(n=e.subtitleFile)||void 0===n?void 0:n.name)}))?fe({text:e.text,start:e.start,end:e.end,originalStart:e.originalStart,originalEnd:e.originalEnd,track:e.track}):Ht("Subtitle file "+(null===(t=e.subtitleFile)||void 0===t?void 0:t.name)+" is not open.")}),[Lt,Ht]),cn=Object(b.useCallback)((function(e){Ke(e),Le(!0),qe(!1),yt(!0)}),[]),sn=Object(b.useCallback)((function(){Le(!1),qe(!1),yt(!1),ot&&(dt({timestamp:Date.now(),resume:!0}),ct(!1))}),[ot]),un=Object(b.useCallback)((function(){if(Ge)if(Lt.find((function(e){var t;return e.name===(null===(t=Ge.subtitleFile)||void 0===t?void 0:t.name)}))){var e={text:Ge.text,start:Ge.start,end:Ge.end,originalStart:Ge.originalStart,originalEnd:Ge.originalEnd,track:Ge.track};je(e),fe(e),sn()}else{var t;Ht("Subtitle file "+(null===(t=Ge.subtitleFile)||void 0===t?void 0:t.name)+" is not open.")}}),[Ge,Lt,sn,Ht]),ln=Object(b.useCallback)((function(e){Tt(e),mt(!0)}),[]);Object(b.useEffect)((function(){function e(e){if(e.length!==At.length)_t(e);else{for(var t=!1,n=0;n<At.length;++n){var a=At[n],r=e[n];if(a.id!==r.id||a.title!==r.title||a.src!==r.src){t=!0;break}}t&&_t(e)}Pt&&0===e.filter((function(e){return e.id===Pt.id&&e.src===Pt.src})).length&&(It(void 0),Ht("Lost connection with tab "+Pt.id+" "+Pt.title))}return O.subscribeTabs(e),function(){return O.unsubscribeTabs(e)}}),[At,Pt,O,Ht]);var dn=Object(b.useCallback)((function(e){return It(e)}),[]),bn=Object(b.useCallback)((function(e){try{var t=function(e){for(var t=[],n=void 0,a=void 0,r=0;r<e.length;++r){var i=e[r],o=i.name.lastIndexOf(".");if(-1===o)throw new Error("Unable to determine extension of "+i.name);var c=i.name.substring(o+1,i.name.length);switch(c){case"ass":case"srt":case"vtt":case"sup":t.push(i);break;case"mkv":case"mp4":case"avi":if(a)throw new Error("Cannot open two video files simultaneously");a=i;break;case"mp3":case"m4a":case"aac":case"flac":case"ogg":case"wav":case"opus":if(n)throw new Error("Cannot open two audio files simultaneously");n=i;break;default:throw new Error("Unsupported extension "+c)}}if(a&&n)throw new Error("Cannot load both an audio and video file simultaneously");return{subtitleFiles:t,audioFile:n,videoFile:a}}(e),n=t.subtitleFiles,a=t.audioFile,r=t.videoFile;if(xe((function(e){Ce(!0);var t=void 0,i=void 0;return r||a?(!function(e){e.audioFileUrl&&URL.revokeObjectURL(e.audioFileUrl),e.videoFileUrl&&URL.revokeObjectURL(e.videoFileUrl)}(e),r?t=URL.createObjectURL(r):a&&(i=URL.createObjectURL(a)),It(void 0)):(r=e.videoFile,t=e.videoFileUrl,a=e.audioFile,i=e.audioFileUrl),{subtitleFiles:0===n.length?e.subtitleFiles:n,audioFile:a,audioFileUrl:i,videoFile:r,videoFileUrl:t}})),n.length>0){var i=n[0].name;Ae(i.substring(0,i.lastIndexOf(".")))}}catch(o){console.error(o),o instanceof Error?Ht(o.message):Ht(String(o))}}),[Ht]),fn=Object(b.useCallback)(function(){var e=Object(c.a)(d.a.mark((function e(t){var n,a,i,o,c,s,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1===t.length){e.next=3;break}return Ht("Cannot load more than one directory at a time"),e.abrupt("return");case 3:if((n=t[0].webkitGetAsEntry())&&n.isDirectory){e.next=7;break}return Ht("Failed to load directory"),e.abrupt("return");case 7:return a=n,e.prev=8,e.next=11,new Promise((function(e,t){return a.createReader().readEntries(e,t)}));case 11:if(!(i=e.sent).find((function(e){return e.isDirectory}))){e.next=15;break}return Ht("Cannot load a directory with subdirectories"),e.abrupt("return");case 15:o=i.map((function(e){return new Promise((function(t,n){return e.file(t,n)}))})),c=[],s=Object(r.a)(o),e.prev=18,s.s();case 20:if((u=s.n()).done){e.next=29;break}return l=u.value,e.t0=c,e.next=25,l;case 25:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 27:e.next=20;break;case 29:e.next=34;break;case 31:e.prev=31,e.t2=e.catch(18),s.e(e.t2);case 34:return e.prev=34,s.f(),e.finish(34);case 37:bn(c),e.next=44;break;case 40:e.prev=40,e.t3=e.catch(8),console.error(e.t3),e.t3 instanceof Error?Ht(e.t3.message):Ht(String(e.t3));case 44:case"end":return e.stop()}}),e,null,[[8,40],[18,31,34,37]])})));return function(t){return e.apply(this,arguments)}}(),[Ht,bn]);Object(b.useEffect)((function(){if(!p)return O.subscribe(e),O.startHeartbeat(),function(){return O.unsubscribe(e)};function e(e){return t.apply(this,arguments)}function t(){return t=Object(c.a)(d.a.mark((function e(t){var n,a,r,i,o,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("sync"!==t.data.command&&"syncv2"!==t.data.command){e.next=33;break}if(0!==(n=O.tabs.filter((function(e){return e.id===t.tabId&&(!t.src||e.src===t.src)}))).length){e.next=5;break}return t.src?console.error("Received sync request but the requesting tab ID "+t.tabId+" with src "+t.src+" was not found"):console.error("Received sync request but the requesting tab ID "+t.tabId+" was not found"),e.abrupt("return");case 5:if(a=n[0],"sync"!==t.data.command){e.next=20;break}return i=t.data,e.t0=File,e.next=11,fetch("data:text/plain;base64,"+i.subtitles.base64);case 11:return e.next=13,e.sent.blob();case 13:e.t1=e.sent,e.t2=[e.t1],e.t3=i.subtitles.name,e.t4=new e.t0(e.t2,e.t3),r=[e.t4],e.next=29;break;case 20:if("syncv2"!==t.data.command){e.next=27;break}return o=t.data,e.next=24,Promise.all(o.subtitles.map(function(){var e=Object(c.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=File,e.next=3,fetch("data:text/plain;base64,"+t.base64);case 3:return e.next=5,e.sent.blob();case 5:return e.t1=e.sent,e.t2=[e.t1],e.t3=t.name,e.abrupt("return",new e.t0(e.t2,e.t3));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 24:r=e.sent,e.next=29;break;case 27:return console.error("Unknown message "+t.data.command),e.abrupt("return");case 29:s=r[0].name,Ae(s.substring(0,s.lastIndexOf("."))),xe({subtitleFiles:r,audioFile:void 0,audioFileUrl:void 0,videoFile:void 0,videoFileUrl:void 0}),It(a);case 33:case"end":return e.stop()}}),e)}))),t.apply(this,arguments)}}),[O,p]);var hn=Object(b.useCallback)((function(e){switch(e){case M.autoPause:$("Auto-pause: On"),ue("info"),ae(!0);break;case M.normal:$("Auto-pause: Off"),ue("info"),ae(!0)}}),[]),vn=Object(b.useCallback)((function(e){Ne||(e.preventDefault(),p?Ht("Video player cannot receive dropped files. Drop outside of the video frame instead."):(Pe(!1),Ie.current=null,e.dataTransfer.items&&e.dataTransfer.items.length>0&&function(e){for(var t=0;t<e.length;++t){var n;if(null===(n=e[t].webkitGetAsEntry())||void 0===n||!n.isDirectory)return!1}return!0}(e.dataTransfer.items)?fn(e.dataTransfer.items):e.dataTransfer.files&&e.dataTransfer.files.length>0&&bn(e.dataTransfer.files)))}),[p,Ht,bn,fn,Ne]),pn=Object(b.useCallback)((function(){var e,t=null===(e=Bt.current)||void 0===e?void 0:e.files;t&&t.length>0&&bn(t)}),[bn]),gn=Object(b.useCallback)((function(){var e;return null===(e=Bt.current)||void 0===e?void 0:e.click()}),[]),mn=Object(b.useCallback)((function(e){Ne||e.preventDefault()}),[Ne]),On=Object(b.useCallback)((function(e){Ne||(e.preventDefault(),e.stopPropagation(),p||(Ie.current=e.target,Pe(!0)))}),[p,Ne]),kn=Object(b.useCallback)((function(e){e.nativeEvent.preventDefault(),e.nativeEvent.stopPropagation(),p||Ie.current!==e.target||Pe(!1)}),[p]),xn=Object(b.useCallback)((function(){return Ce(!1)}),[]);if("/"===u.pathname&&f.get("video"))return Object(re.jsx)(Lr,{searchParams:f});var wn=Se&&!x.current||0===ke.subtitleFiles.length&&!ke.audioFile&&!ke.videoFile,Sn=void 0!==ke.videoFile&&U&&!V;return Object(re.jsxs)(j.a,{theme:n,children:[Object(re.jsx)(Qe.a,{}),Object(re.jsxs)("div",{onDrop:vn,onDragOver:mn,onDragEnter:On,onDragLeave:kn,children:[Object(re.jsx)(oe,{open:ne,onClose:Qt,autoHideDuration:3e3,severity:se,children:Q}),Object(re.jsxs)(h.d,{children:[Object(re.jsx)(h.b,{path:"/video",element:Object(re.jsx)(Hr,{searchParams:f,settingsProvider:t,onError:Ht,onAutoPauseModeChangedViaBind:hn})}),Object(re.jsx)(h.b,{path:"/",element:Object(re.jsxs)("div",{children:[Object(re.jsx)(jn,{items:I,open:B,drawerWidth:T,onClose:Vt,onDelete:en,onClipAudio:an,onDownloadImage:rn,onSelect:on,onAnki:cn}),Object(re.jsx)(Ye,{open:Ne,disabled:We,text:null===Ge||void 0===Ge?void 0:Ge.text,audioClip:Je,image:$e,source:Nr(Ge),url:null===Ge||void 0===Ge?void 0:Ge.url,sliderContext:Xe,customFields:t.customAnkiFields,anki:a,settingsProvider:t,onCancel:sn,onRewind:un,onProceed:Wt,onViewImage:ln,onOpenSettings:Xt}),Object(re.jsx)(pe,{open:jt,image:Ct,onClose:$t}),Object(re.jsx)(Ya,{anki:a,open:ht,onClose:Zt,settings:t.settings}),Object(re.jsx)(Jt,{title:De||"asbplayer",drawerWidth:T,drawerOpen:B,hidden:Sn,onOpenCopyHistory:zt,onOpenSettings:Xt,onFileSelector:gn}),Object(re.jsx)("input",{ref:Bt,onChange:pn,type:"file",accept:".srt,.ass,.vtt,.sup,.mp3,.m4a,.aac,.flac,.ogg,.wav,.opus,.mkv,.mp4,.avi",multiple:!0,hidden:!0}),Object(re.jsxs)(Ur,{drawerWidth:T,drawerOpen:B,children:[wn&&Object(re.jsx)(yn,{latestExtensionVersion:"0.18.2",extensionUrl:"https://github.com/killergerbah/asbplayer/releases/latest",extension:O,loading:Se,dragging:Ee,appBarHidden:Sn,onFileSelector:gn}),Object(re.jsx)(tt,{dragging:Ee,appBarHidden:Sn,loading:Se}),Object(re.jsx)(Pa,{subtitleReader:e,settingsProvider:t,onCopy:qt,onError:Ht,onUnloadAudio:tn,onUnloadVideo:nn,onLoaded:xn,onTabSelected:dn,onAnkiDialogRequest:Ut,onAppBarToggle:Gt,onVideoPopOut:Kt,onAutoPauseModeChangedViaBind:hn,tab:Pt,availableTabs:At,sources:ke,jumpToSubtitle:be,rewindSubtitle:ge,videoFrameRef:x,extension:O,drawerOpen:B,appBarHidden:Sn,videoPopOut:V,disableKeyEvents:xt,ankiDialogRequested:ot,ankiDialogRequestToVideo:nt,ankiDialogFinishedRequest:lt})]})]})})]})]})]})},qr=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,358)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),i(e),o(e)}))};Object(a.createRoot)(document.querySelector("#root")).render(Object(re.jsx)(v.a,{basename:"/asbplayer-staging",children:Object(re.jsx)(Wr,{})})),qr()}},[[263,1,2]]]);
//# sourceMappingURL=main.0bcd1da3.chunk.js.map